import{Constants as t}from"../../../dex-constants/dist/src/index.js";import o from"./cookies.js";import a from"./user-agent/index.js";class l{static _info=this.staticInitialise();static _fingerprint=this.getFingerprint();static _country=this.getGeolocation();static _locale=this.getUserLocale();static async staticInitialise(){if(!o.has(t.LOGIN_LOGGED_USER_EXPIRY_COOKIE_NAME))return null;try{const e=await fetch(`${t.PUBLIC_URL_ORIGIN}/bin/login/userInfo.json`);return e.ok?(await e.json()).result:null}catch{return null}}static async getFingerprint(){const e=localStorage.getItem(t.FINGERPRINT_LOCAL_STORAGE_NAME);if(e)return e;const r=await this._info;if(r)return localStorage.setItem(t.FINGERPRINT_LOCAL_STORAGE_NAME,r.fingerprint),r.fingerprint;if(!o.has(t.NO_FINGERPRINT_COOKIE_NAME)&&a.isWindows)try{const n=await fetch(`${t.WWW_ONLY_ORIGIN}/site/Main/dummyPost?${Math.random()}`,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Pragma:"no-cache","Cache-Control":"no-store, no-cache, must-revalidate, max-age=0",Expires:"Tue, 01 Jan 1971 02:00:00 GMT",BDUS_A312C09A2666456D9F2B2AA5D6B463D6:"check.bitdefender"}});if(n.ok&&n.headers.has(t.FINGERPRINT_HEADER)){const s=n.headers.get(t.FINGERPRINT_HEADER);return localStorage.setItem(t.FINGERPRINT_LOCAL_STORAGE_NAME,s),s}else o.set(t.NO_FINGERPRINT_COOKIE_NAME,"true",{expires:1})}catch{}return null}static async getGeolocation(){try{const e=await fetch(`${t.PUBLIC_URL_ORIGIN}/geoip`);if(!e.ok)return"us";const r=await e.json();return r.error_code?"us":r.country.toLowerCase()}catch{return"us"}}static async getUserLocale(){const e=await this._country;try{return(await(await fetch(`${t.WWW_ONLY_ORIGIN}/p-api/v1/countries/${e.toUpperCase()}/locales`)).json())[0].locale.toLowerCase()}catch{return"en-us"}}static async login(){const e=sessionStorage.getItem(t.LOGIN_ATTEMPT_SESSION_STORAGE_KEY),r=await this._info,i=Number(o.get(t.LOGIN_LOGGED_USER_EXPIRY_COOKIE_NAME))||0;if(!e&&!r&&i>Date.now()){sessionStorage.setItem(t.LOGIN_ATTEMPT_SESSION_STORAGE_KEY,"true");const n=new URL(`${t.PUBLIC_URL_ORIGIN}${t.LOGIN_ENDPOINT}`);n.searchParams.set("origin",`${window.location.pathname}${window.location.search}`),window.location.href=n.href}}static get info(){return this._info}static get fingerprint(){return this._fingerprint}static get country(){return this._country}static get locale(){return this._locale}}export{l as default};
//# sourceMappingURL=user.js.map
