{"version":3,"file":"backgroundtab.js","sources":["../../../../../../../../node_modules/@sentry/browser/build/npm/esm/tracing/backgroundtab.js"],"sourcesContent":["import { getActiveSpan, getRootSpan, spanToJSON, logger, SPAN_STATUS_ERROR } from '@sentry/core';\nimport { DEBUG_BUILD } from '../debug-build.js';\nimport { WINDOW } from '../helpers.js';\n\n/**\n * Add a listener that cancels and finishes a transaction when the global\n * document is hidden.\n */\nfunction registerBackgroundTabDetection() {\n  if (WINDOW.document) {\n    WINDOW.document.addEventListener('visibilitychange', () => {\n      const activeSpan = getActiveSpan();\n      if (!activeSpan) {\n        return;\n      }\n\n      const rootSpan = getRootSpan(activeSpan);\n\n      if (WINDOW.document.hidden && rootSpan) {\n        const cancelledStatus = 'cancelled';\n\n        const { op, status } = spanToJSON(rootSpan);\n\n        if (DEBUG_BUILD) {\n          logger.log(`[Tracing] Transaction: ${cancelledStatus} -> since tab moved to the background, op: ${op}`);\n        }\n\n        // We should not set status if it is already set, this prevent important statuses like\n        // error or data loss from being overwritten on transaction.\n        if (!status) {\n          rootSpan.setStatus({ code: SPAN_STATUS_ERROR, message: cancelledStatus });\n        }\n\n        rootSpan.setAttribute('sentry.cancellation_reason', 'document.hidden');\n        rootSpan.end();\n      }\n    });\n  } else {\n    DEBUG_BUILD && logger.warn('[Tracing] Could not set up background tab detection due to lack of global document');\n  }\n}\n\nexport { registerBackgroundTabDetection };\n//# sourceMappingURL=backgroundtab.js.map\n"],"names":["registerBackgroundTabDetection","WINDOW","activeSpan","getActiveSpan","rootSpan","getRootSpan","cancelledStatus","op","status","spanToJSON","DEBUG_BUILD","logger","SPAN_STATUS_ERROR"],"mappings":"8WAQA,SAASA,GAAiC,CACpCC,EAAO,SACTA,EAAO,SAAS,iBAAiB,mBAAoB,IAAM,CACzD,MAAMC,EAAaC,EAAe,EAClC,GAAI,CAACD,EACH,OAGF,MAAME,EAAWC,EAAYH,CAAU,EAEvC,GAAID,EAAO,SAAS,QAAUG,EAAU,CACtC,MAAME,EAAkB,YAElB,CAAE,GAAAC,EAAI,OAAAC,GAAWC,EAAWL,CAAQ,EAEtCM,GACFC,EAAO,IAAI,0BAA0BL,CAAe,8CAA8CC,CAAE,EAAE,EAKnGC,GACHJ,EAAS,UAAU,CAAE,KAAMQ,EAAmB,QAASN,EAAiB,EAG1EF,EAAS,aAAa,6BAA8B,iBAAiB,EACrEA,EAAS,IAAK,CACtB,CACA,CAAK,EAEDM,GAAeC,EAAO,KAAK,oFAAoF,CAEnH","x_google_ignoreList":[0]}