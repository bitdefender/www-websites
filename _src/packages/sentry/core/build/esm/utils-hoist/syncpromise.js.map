{"version":3,"file":"syncpromise.js","sources":["../../../../../../../node_modules/@sentry/core/build/esm/utils-hoist/syncpromise.js"],"sourcesContent":["import { isThenable } from './is.js';\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/** SyncPromise internal states */\nvar States; (function (States) {\n  /** Pending */\n  const PENDING = 0; States[States[\"PENDING\"] = PENDING] = \"PENDING\";\n  /** Resolved / OK */\n  const RESOLVED = 1; States[States[\"RESOLVED\"] = RESOLVED] = \"RESOLVED\";\n  /** Rejected / Error */\n  const REJECTED = 2; States[States[\"REJECTED\"] = REJECTED] = \"REJECTED\";\n})(States || (States = {}));\n\n// Overloads so we can call resolvedSyncPromise without arguments and generic argument\n\n/**\n * Creates a resolved sync promise.\n *\n * @param value the value to resolve the promise with\n * @returns the resolved sync promise\n */\nfunction resolvedSyncPromise(value) {\n  return new SyncPromise(resolve => {\n    resolve(value);\n  });\n}\n\n/**\n * Creates a rejected sync promise.\n *\n * @param value the value to reject the promise with\n * @returns the rejected sync promise\n */\nfunction rejectedSyncPromise(reason) {\n  return new SyncPromise((_, reject) => {\n    reject(reason);\n  });\n}\n\n/**\n * Thenable class that behaves like a Promise and follows it's interface\n * but is not async internally\n */\nclass SyncPromise {\n\n   constructor(executor) {\n    this._state = States.PENDING;\n    this._handlers = [];\n\n    this._runExecutor(executor);\n  }\n\n  /** @inheritdoc */\n   then(\n    onfulfilled,\n    onrejected,\n  ) {\n    return new SyncPromise((resolve, reject) => {\n      this._handlers.push([\n        false,\n        result => {\n          if (!onfulfilled) {\n            // TODO: ¯\\_(ツ)_/¯\n            // TODO: FIXME\n            resolve(result );\n          } else {\n            try {\n              resolve(onfulfilled(result));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n        reason => {\n          if (!onrejected) {\n            reject(reason);\n          } else {\n            try {\n              resolve(onrejected(reason));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n      ]);\n      this._executeHandlers();\n    });\n  }\n\n  /** @inheritdoc */\n   catch(\n    onrejected,\n  ) {\n    return this.then(val => val, onrejected);\n  }\n\n  /** @inheritdoc */\n   finally(onfinally) {\n    return new SyncPromise((resolve, reject) => {\n      let val;\n      let isRejected;\n\n      return this.then(\n        value => {\n          isRejected = false;\n          val = value;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n        reason => {\n          isRejected = true;\n          val = reason;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n      ).then(() => {\n        if (isRejected) {\n          reject(val);\n          return;\n        }\n\n        resolve(val );\n      });\n    });\n  }\n\n  /** Excute the resolve/reject handlers. */\n   _executeHandlers() {\n    if (this._state === States.PENDING) {\n      return;\n    }\n\n    const cachedHandlers = this._handlers.slice();\n    this._handlers = [];\n\n    cachedHandlers.forEach(handler => {\n      if (handler[0]) {\n        return;\n      }\n\n      if (this._state === States.RESOLVED) {\n        handler[1](this._value );\n      }\n\n      if (this._state === States.REJECTED) {\n        handler[2](this._value);\n      }\n\n      handler[0] = true;\n    });\n  }\n\n  /** Run the executor for the SyncPromise. */\n   _runExecutor(executor) {\n    const setResult = (state, value) => {\n      if (this._state !== States.PENDING) {\n        return;\n      }\n\n      if (isThenable(value)) {\n        void (value ).then(resolve, reject);\n        return;\n      }\n\n      this._state = state;\n      this._value = value;\n\n      this._executeHandlers();\n    };\n\n    const resolve = (value) => {\n      setResult(States.RESOLVED, value);\n    };\n\n    const reject = (reason) => {\n      setResult(States.REJECTED, reason);\n    };\n\n    try {\n      executor(resolve, reject);\n    } catch (e) {\n      reject(e);\n    }\n  }\n}\n\nexport { SyncPromise, rejectedSyncPromise, resolvedSyncPromise };\n//# sourceMappingURL=syncpromise.js.map\n"],"names":["States","RESOLVED","REJECTED","resolvedSyncPromise","value","SyncPromise","resolve","rejectedSyncPromise","reason","_","reject","executor","onfulfilled","onrejected","result","e","val","onfinally","isRejected","cachedHandlers","handler","setResult","state","isThenable"],"mappings":"qCAKA,IAAIA,GAAS,SAAUA,EAAQ,CAEVA,EAAOA,EAAO,QAAa,CAAO,EAAI,UAEzD,MAAMC,EAAW,EAAGD,EAAOA,EAAO,SAAcC,CAAQ,EAAI,WAE5D,MAAMC,EAAW,EAAGF,EAAOA,EAAO,SAAcE,CAAQ,EAAI,UAC9D,GAAGF,IAAWA,EAAS,CAAA,EAAG,EAU1B,SAASG,EAAoBC,EAAO,CAClC,OAAO,IAAIC,EAAYC,GAAW,CAChCA,EAAQF,CAAK,CACjB,CAAG,CACH,CAQA,SAASG,EAAoBC,EAAQ,CACnC,OAAO,IAAIH,EAAY,CAACI,EAAGC,IAAW,CACpCA,EAAOF,CAAM,CACjB,CAAG,CACH,CAMA,MAAMH,CAAY,CAEf,YAAYM,EAAU,CACrB,KAAK,OAASX,EAAO,QACrB,KAAK,UAAY,CAAE,EAEnB,KAAK,aAAaW,CAAQ,CAC9B,CAGG,KACCC,EACAC,EACA,CACA,OAAO,IAAIR,EAAY,CAACC,EAASI,IAAW,CAC1C,KAAK,UAAU,KAAK,CAClB,GACAI,GAAU,CACR,GAAI,CAACF,EAGHN,EAAQQ,CAAQ,MAEhB,IAAI,CACFR,EAAQM,EAAYE,CAAM,CAAC,CAC5B,OAAQC,EAAG,CACVL,EAAOK,CAAC,CACtB,CAES,EACDP,GAAU,CACR,GAAI,CAACK,EACHH,EAAOF,CAAM,MAEb,IAAI,CACFF,EAAQO,EAAWL,CAAM,CAAC,CAC3B,OAAQO,EAAG,CACVL,EAAOK,CAAC,CACtB,CAES,CACT,CAAO,EACD,KAAK,iBAAkB,CAC7B,CAAK,CACL,CAGG,MACCF,EACA,CACA,OAAO,KAAK,KAAKG,GAAOA,EAAKH,CAAU,CAC3C,CAGG,QAAQI,EAAW,CAClB,OAAO,IAAIZ,EAAY,CAACC,EAASI,IAAW,CAC1C,IAAIM,EACAE,EAEJ,OAAO,KAAK,KACVd,GAAS,CACPc,EAAa,GACbF,EAAMZ,EACFa,GACFA,EAAW,CAEd,EACDT,GAAU,CACRU,EAAa,GACbF,EAAMR,EACFS,GACFA,EAAW,CAEd,CACF,EAAC,KAAK,IAAM,CACX,GAAIC,EAAY,CACdR,EAAOM,CAAG,EACV,MACV,CAEQV,EAAQU,CAAK,CACrB,CAAO,CACP,CAAK,CACL,CAGG,kBAAmB,CAClB,GAAI,KAAK,SAAWhB,EAAO,QACzB,OAGF,MAAMmB,EAAiB,KAAK,UAAU,MAAO,EAC7C,KAAK,UAAY,CAAE,EAEnBA,EAAe,QAAQC,GAAW,CAC5BA,EAAQ,CAAC,IAIT,KAAK,SAAWpB,EAAO,UACzBoB,EAAQ,CAAC,EAAE,KAAK,MAAQ,EAGtB,KAAK,SAAWpB,EAAO,UACzBoB,EAAQ,CAAC,EAAE,KAAK,MAAM,EAGxBA,EAAQ,CAAC,EAAI,GACnB,CAAK,CACL,CAGG,aAAaT,EAAU,CACtB,MAAMU,EAAY,CAACC,EAAOlB,IAAU,CAClC,GAAI,KAAK,SAAWJ,EAAO,QAI3B,IAAIuB,EAAWnB,CAAK,EAAG,CACfA,EAAQ,KAAKE,EAASI,CAAM,EAClC,MACR,CAEM,KAAK,OAASY,EACd,KAAK,OAASlB,EAEd,KAAK,iBAAkB,EACxB,EAEKE,EAAWF,GAAU,CACzBiB,EAAUrB,EAAO,SAAUI,CAAK,CACjC,EAEKM,EAAUF,GAAW,CACzBa,EAAUrB,EAAO,SAAUQ,CAAM,CAClC,EAED,GAAI,CACFG,EAASL,EAASI,CAAM,CACzB,OAAQK,EAAG,CACVL,EAAOK,CAAC,CACd,CACA,CACA","x_google_ignoreList":[0]}