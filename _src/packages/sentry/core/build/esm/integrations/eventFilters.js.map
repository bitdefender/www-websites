{"version":3,"file":"eventFilters.js","sources":["../../../../../../../node_modules/@sentry/core/build/esm/integrations/eventFilters.js"],"sourcesContent":["import { DEBUG_BUILD } from '../debug-build.js';\nimport { defineIntegration } from '../integration.js';\nimport { getPossibleEventMessages } from '../utils/eventUtils.js';\nimport { logger } from '../utils-hoist/logger.js';\nimport { getEventDescription } from '../utils-hoist/misc.js';\nimport { stringMatchesSomePattern } from '../utils-hoist/string.js';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nconst DEFAULT_IGNORE_ERRORS = [\n  /^Script error\\.?$/,\n  /^Javascript error: Script error\\.? on line 0$/,\n  /^ResizeObserver loop completed with undelivered notifications.$/, // The browser logs this when a ResizeObserver handler takes a bit longer. Usually this is not an actual issue though. It indicates slowness.\n  /^Cannot redefine property: googletag$/, // This is thrown when google tag manager is used in combination with an ad blocker\n  /^Can't find variable: gmo$/, // Error from Google Search App https://issuetracker.google.com/issues/396043331\n  /^undefined is not an object \\(evaluating 'a\\.[A-Z]'\\)$/, // Random error that happens but not actionable or noticeable to end-users.\n  'can\\'t redefine non-configurable property \"solana\"', // Probably a browser extension or custom browser (Brave) throwing this error\n  \"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)\", // Error thrown by GTM, seemingly not affecting end-users\n  \"Can't find variable: _AutofillCallbackHandler\", // Unactionable error in instagram webview https://developers.facebook.com/community/threads/320013549791141/\n  /^Non-Error promise rejection captured with value: Object Not Found Matching Id:\\d+, MethodName:simulateEvent, ParamCount:\\d+$/, // unactionable error from CEFSharp, a .NET library that embeds chromium in .NET apps\n  /^Java exception was raised during method invocation$/, // error from Facebook Mobile browser (https://github.com/getsentry/sentry-javascript/issues/15065)\n];\n\n/** Options for the EventFilters integration */\n\nconst INTEGRATION_NAME = 'EventFilters';\n\n/**\n * An integration that filters out events (errors and transactions) based on:\n *\n * - (Errors) A curated list of known low-value or irrelevant errors (see {@link DEFAULT_IGNORE_ERRORS})\n * - (Errors) A list of error messages or urls/filenames passed in via\n *   - Top level Sentry.init options (`ignoreErrors`, `denyUrls`, `allowUrls`)\n *   - The same options passed to the integration directly via @param options\n * - (Transactions/Spans) A list of root span (transaction) names passed in via\n *   - Top level Sentry.init option (`ignoreTransactions`)\n *   - The same option passed to the integration directly via @param options\n *\n * Events filtered by this integration will not be sent to Sentry.\n */\nconst eventFiltersIntegration = defineIntegration((options = {}) => {\n  let mergedOptions;\n  return {\n    name: INTEGRATION_NAME,\n    setup(client) {\n      const clientOptions = client.getOptions();\n      mergedOptions = _mergeOptions(options, clientOptions);\n    },\n    processEvent(event, _hint, client) {\n      if (!mergedOptions) {\n        const clientOptions = client.getOptions();\n        mergedOptions = _mergeOptions(options, clientOptions);\n      }\n      return _shouldDropEvent(event, mergedOptions) ? null : event;\n    },\n  };\n});\n\n/**\n * An integration that filters out events (errors and transactions) based on:\n *\n * - (Errors) A curated list of known low-value or irrelevant errors (see {@link DEFAULT_IGNORE_ERRORS})\n * - (Errors) A list of error messages or urls/filenames passed in via\n *   - Top level Sentry.init options (`ignoreErrors`, `denyUrls`, `allowUrls`)\n *   - The same options passed to the integration directly via @param options\n * - (Transactions/Spans) A list of root span (transaction) names passed in via\n *   - Top level Sentry.init option (`ignoreTransactions`)\n *   - The same option passed to the integration directly via @param options\n *\n * Events filtered by this integration will not be sent to Sentry.\n *\n * @deprecated this integration was renamed and will be removed in a future major version.\n * Use `eventFiltersIntegration` instead.\n */\nconst inboundFiltersIntegration = defineIntegration(((options = {}) => {\n  return {\n    ...eventFiltersIntegration(options),\n    name: 'InboundFilters',\n  };\n}) );\n\nfunction _mergeOptions(\n  internalOptions = {},\n  clientOptions = {},\n) {\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [\n      ...(internalOptions.ignoreErrors || []),\n      ...(clientOptions.ignoreErrors || []),\n      ...(internalOptions.disableErrorDefaults ? [] : DEFAULT_IGNORE_ERRORS),\n    ],\n    ignoreTransactions: [...(internalOptions.ignoreTransactions || []), ...(clientOptions.ignoreTransactions || [])],\n  };\n}\n\nfunction _shouldDropEvent(event, options) {\n  if (!event.type) {\n    // Filter errors\n    if (_isIgnoredError(event, options.ignoreErrors)) {\n      DEBUG_BUILD &&\n        logger.warn(\n          `Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`,\n        );\n      return true;\n    }\n    if (_isUselessError(event)) {\n      DEBUG_BUILD &&\n        logger.warn(\n          `Event dropped due to not having an error message, error type or stacktrace.\\nEvent: ${getEventDescription(\n            event,\n          )}`,\n        );\n      return true;\n    }\n    if (_isDeniedUrl(event, options.denyUrls)) {\n      DEBUG_BUILD &&\n        logger.warn(\n          `Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(\n            event,\n          )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n        );\n      return true;\n    }\n    if (!_isAllowedUrl(event, options.allowUrls)) {\n      DEBUG_BUILD &&\n        logger.warn(\n          `Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(\n            event,\n          )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n        );\n      return true;\n    }\n  } else if (event.type === 'transaction') {\n    // Filter transactions\n\n    if (_isIgnoredTransaction(event, options.ignoreTransactions)) {\n      DEBUG_BUILD &&\n        logger.warn(\n          `Event dropped due to being matched by \\`ignoreTransactions\\` option.\\nEvent: ${getEventDescription(event)}`,\n        );\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction _isIgnoredError(event, ignoreErrors) {\n  if (!ignoreErrors?.length) {\n    return false;\n  }\n\n  return getPossibleEventMessages(event).some(message => stringMatchesSomePattern(message, ignoreErrors));\n}\n\nfunction _isIgnoredTransaction(event, ignoreTransactions) {\n  if (!ignoreTransactions?.length) {\n    return false;\n  }\n\n  const name = event.transaction;\n  return name ? stringMatchesSomePattern(name, ignoreTransactions) : false;\n}\n\nfunction _isDeniedUrl(event, denyUrls) {\n  if (!denyUrls?.length) {\n    return false;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? false : stringMatchesSomePattern(url, denyUrls);\n}\n\nfunction _isAllowedUrl(event, allowUrls) {\n  if (!allowUrls?.length) {\n    return true;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? true : stringMatchesSomePattern(url, allowUrls);\n}\n\nfunction _getLastValidUrl(frames = []) {\n  for (let i = frames.length - 1; i >= 0; i--) {\n    const frame = frames[i];\n\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n\n  return null;\n}\n\nfunction _getEventFilterUrl(event) {\n  try {\n    // If there are linked exceptions or exception aggregates we only want to match against the top frame of the \"root\" (the main exception)\n    // The root always comes last in linked exceptions\n    const rootException = [...(event.exception?.values ?? [])]\n      .reverse()\n      .find(value => value.mechanism?.parent_id === undefined && value.stacktrace?.frames?.length);\n    const frames = rootException?.stacktrace?.frames;\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    DEBUG_BUILD && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\n\nfunction _isUselessError(event) {\n  // We only want to consider events for dropping that actually have recorded exception values.\n  if (!event.exception?.values?.length) {\n    return false;\n  }\n\n  return (\n    // No top-level message\n    !event.message &&\n    // There are no exception values that have a stacktrace, a non-generic-Error type or value\n    !event.exception.values.some(value => value.stacktrace || (value.type && value.type !== 'Error') || value.value)\n  );\n}\n\nexport { eventFiltersIntegration, inboundFiltersIntegration };\n//# sourceMappingURL=eventFilters.js.map\n"],"names":["DEFAULT_IGNORE_ERRORS","INTEGRATION_NAME","eventFiltersIntegration","defineIntegration","options","mergedOptions","client","clientOptions","_mergeOptions","event","_hint","_shouldDropEvent","inboundFiltersIntegration","internalOptions","_isIgnoredTransaction","DEBUG_BUILD","logger","getEventDescription","_isIgnoredError","_isUselessError","_isDeniedUrl","_getEventFilterUrl","_isAllowedUrl","ignoreErrors","getPossibleEventMessages","message","stringMatchesSomePattern","ignoreTransactions","name","denyUrls","url","allowUrls","_getLastValidUrl","frames","i","frame","value"],"mappings":"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","x_google_ignoreList":[0]}