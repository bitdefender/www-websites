{"version":3,"file":"awards-search.js","sources":["../../../src/blocks/awards-search/awards-search.js"],"sourcesContent":["import { createOptimizedPicture } from '../../scripts/lib-franklin.js';\n\nlet awardsData = [];\nlet filteredAwards = [];\nlet yearsToFilterBy = [];\n\nfunction renderAwardItem(block, award) {\n  const awardItemContainer = document.createElement('div');\n  awardItemContainer.classList.add('award-item-container');\n\n  if (award.Logo) {\n    const awardsLogo = document.createElement('div');\n    awardsLogo.classList.add('award-logo');\n    awardsLogo.append(createOptimizedPicture(award.Logo, award.Title));\n    awardItemContainer.append(awardsLogo);\n  }\n\n  const awardItemContent = document.createElement('div');\n  awardItemContent.classList.add('award-item-description');\n  const itemTitle = document.createElement('h2');\n  itemTitle.append(award.Title);\n  awardItemContent.append(itemTitle);\n  const itemDescription = document.createElement('p');\n  itemDescription.append(award.Description);\n  awardItemContent.append(itemDescription);\n\n  if (award.Link) {\n    const itemLink = document.createElement('a');\n    itemLink.innerHTML = 'Read More';\n    itemLink.href = award.Link;\n    awardItemContent.append(itemLink);\n  }\n\n  awardItemContainer.append(awardItemContent);\n  block.appendChild(awardItemContainer);\n}\n\nfunction createFiltersContainer(parent) {\n  const filtersContainer = document.createElement('div');\n  filtersContainer.classList.add('award-results-filters-container');\n  parent.append(filtersContainer);\n}\n\nfunction clearAwardsResultsSection(block) {\n  const awardsResultsContainer = block.querySelector('.awards-results-container');\n  awardsResultsContainer.innerHTML = '';\n  createFiltersContainer(awardsResultsContainer);\n}\n\nfunction renderAwards(block, data) {\n  const awardsResultsContainer = block.querySelector('.awards-results-container');\n  data.forEach((award) => {\n    renderAwardItem(awardsResultsContainer, award);\n  });\n}\n\nfunction renderFilters(block) {\n  if (yearsToFilterBy.length === 0) {\n    return;\n  }\n\n  const filtersContainer = block.querySelector('.award-results-filters-container');\n  yearsToFilterBy.forEach((year) => {\n    const filterItem = document.createElement('div');\n    filterItem.append(year);\n    filtersContainer.append(filterItem);\n  });\n\n  const clearAllLink = document.createElement('a');\n  clearAllLink.addEventListener('click', () => {\n    yearsToFilterBy = [];\n    const checkboxes = block.querySelectorAll('.accordion-item-content input');\n    [...checkboxes].forEach((checkbox) => { checkbox.checked = false; });\n    filteredAwards = [...awardsData];\n\n    // Clear the existing awards before rendering new ones\n    const awardsResultsContainer = block.querySelector('.awards-results-container');\n    if (awardsResultsContainer) {\n      awardsResultsContainer.innerHTML = '';\n    }\n\n    renderFilters(block);\n    renderAwards(block, filteredAwards);\n  });\n\n  clearAllLink.innerText = 'Clear All';\n  filtersContainer.append(clearAllLink);\n}\n\nfunction renderFilteredAwards(block) {\n  clearAwardsResultsSection(block);\n  renderFilters(block);\n  if (yearsToFilterBy.length > 0) {\n    filteredAwards = awardsData.filter((award) => yearsToFilterBy.includes(award.Year));\n    renderAwards(block, filteredAwards);\n  } else {\n    filteredAwards = awardsData;\n    renderAwards(block, awardsData);\n  }\n}\n\nfunction handleFilterByYearCheckbox(block, event) {\n  if (event.target.checked) {\n    yearsToFilterBy.push(event.target.value);\n  } else if (yearsToFilterBy.includes(event.target.value)) {\n    yearsToFilterBy = yearsToFilterBy.filter((year) => year !== event.target.value);\n  }\n\n  renderFilteredAwards(block);\n}\n\nfunction createAwardsResultContainer(block) {\n  const awardsResultsContainer = document.createElement('div');\n  awardsResultsContainer.classList.add('awards-results-container');\n  createFiltersContainer(awardsResultsContainer);\n  block.appendChild(awardsResultsContainer);\n}\n\nfunction createFilterBySection(block, data) {\n  const filterByContent = document.createElement('div');\n  filterByContent.classList.add('accordion-item-content');\n\n  const filterByYears = data.map((award) => award.Year);\n  const filterByYearsUniqueValue = [...new Set(filterByYears)];\n\n  filterByYearsUniqueValue.forEach((year) => {\n    const checkboxElement = document.createElement('input');\n    checkboxElement.setAttribute('type', 'checkbox');\n    checkboxElement.setAttribute('value', year);\n    checkboxElement.addEventListener('click', handleFilterByYearCheckbox.bind(null, block));\n    const checkboxLabel = document.createElement('label');\n    checkboxLabel.append(checkboxElement);\n    checkboxLabel.append(year);\n    filterByContent.append(checkboxLabel);\n  });\n\n  const filterWrapperSection = block.querySelector('.accordion > div');\n  if (!filterWrapperSection) {\n    return;\n  }\n\n  if (window.window.innerWidth >= 768) {\n    filterWrapperSection.classList.add('expanded');\n  }\n  filterWrapperSection.appendChild(filterByContent);\n}\n\nasync function fetchAwardsData(block) {\n  const awardsLink = block.querySelector('a');\n  const data = await fetch(awardsLink.href);\n  const awards = await data.json();\n  awardsData = [...awards.data];\n  filteredAwards = [...awardsData];\n  createFilterBySection(block, awardsData);\n  renderAwards(block, filteredAwards);\n}\n\nfunction handleTextSearch(searchTextBox, block) {\n  const filterBy = searchTextBox.value;\n  clearAwardsResultsSection(block);\n  renderFilters(block);\n  if (filterBy.length === 0) {\n    renderAwards(block, filteredAwards);\n    return;\n  }\n\n  const filteredByTextAwards = filteredAwards.filter((award) => award.Title.match(new RegExp(`${filterBy}`, 'i')));\n  renderAwards(block, filteredByTextAwards);\n}\n\nfunction createSearchTextBox(block) {\n  const searchTextBox = document.createElement('input');\n  searchTextBox.classList.add('text-box-wrapper');\n  searchTextBox.setAttribute('type', 'text');\n  searchTextBox.setAttribute('placeholder', 'Search Awards');\n\n  searchTextBox.addEventListener('keyup', handleTextSearch.bind(null, searchTextBox, block));\n\n  const searchMagnifingGlass = document.createElement('button');\n  searchMagnifingGlass.classList.add('text-box-search-magnifing-glass');\n  searchMagnifingGlass.setAttribute('aria-label', 'Search');\n  searchMagnifingGlass.setAttribute('role', 'button');\n  searchTextBox.after(searchMagnifingGlass);\n  searchMagnifingGlass.addEventListener('click', handleTextSearch.bind(null, searchTextBox, block));\n\n  const filterSection = block.querySelector('.award-search-filter-wrapper');\n  filterSection.appendChild(searchTextBox);\n  filterSection.appendChild(searchMagnifingGlass);\n}\n\nfunction removeAwardsLinkFromDom(block) {\n  [...block.children].forEach((element) => {\n    if (element.innerHTML.includes('awards.json')) {\n      element.remove();\n    }\n  });\n}\n\nfunction moveAccordionUnderFilterSection(block) {\n  const accordion = document.querySelector('.accordion-wrapper');\n  const awardSearchFilterSection = document.createElement('div');\n  awardSearchFilterSection.classList.add('award-search-filter-wrapper');\n  block.append(awardSearchFilterSection);\n  createSearchTextBox(block);\n  awardSearchFilterSection.append(accordion);\n}\n\nexport default async function decorate(block) {\n  moveAccordionUnderFilterSection(block);\n  createAwardsResultContainer(block);\n  fetchAwardsData(block);\n  removeAwardsLinkFromDom(block);\n}\n"],"names":["awardsData","filteredAwards","yearsToFilterBy","renderAwardItem","block","award","awardItemContainer","awardsLogo","createOptimizedPicture","awardItemContent","itemTitle","itemDescription","itemLink","createFiltersContainer","parent","filtersContainer","clearAwardsResultsSection","awardsResultsContainer","renderAwards","data","renderFilters","year","filterItem","clearAllLink","checkbox","renderFilteredAwards","handleFilterByYearCheckbox","event","createAwardsResultContainer","createFilterBySection","filterByContent","filterByYears","checkboxElement","checkboxLabel","filterWrapperSection","fetchAwardsData","awardsLink","handleTextSearch","searchTextBox","filterBy","filteredByTextAwards","createSearchTextBox","searchMagnifingGlass","filterSection","removeAwardsLinkFromDom","element","moveAccordionUnderFilterSection","accordion","awardSearchFilterSection","decorate"],"mappings":"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"}