{"version":3,"file":"footer.js","sources":["../../../src/blocks/footer/footer.js"],"sourcesContent":["import { decorateIcons, getMetadata, loadBlocks } from '../../scripts/lib-franklin.js';\nimport { getDomain } from '../../scripts/utils/utils.js';\nimport { decorateMain } from '../../scripts/scripts.js';\nimport { adobeMcAppendVisitorId } from '../../scripts/target.js';\n\nfunction wrapImgsInLinks(container) {\n  const pictures = container.querySelectorAll('picture');\n  pictures.forEach((pic) => {\n    const link = pic.nextElementSibling;\n    if (link && link.tagName === 'A' && link.href) {\n      link.innerHTML = pic.outerHTML;\n      pic.replaceWith(link);\n    }\n  });\n}\n\nfunction onFooterElementClick(evt) {\n  const header = evt.target;\n  const ul = header.nextElementSibling;\n  header.classList.toggle('active');\n\n  if (ul.classList.contains('open')) {\n    ul.addEventListener('transitionend', function callback() {\n      if (!ul.classList.contains('open')) { // Ensure the ul is still closed\n        ul.classList.remove('visible');\n      }\n      ul.removeEventListener('transitionend', callback);\n    });\n    ul.classList.remove('open');\n  } else {\n    ul.classList.add('visible');\n    setTimeout(() => {\n      ul.classList.add('open');\n    }, 10); // slight delay to allow the browser to apply the \"visible\" class first\n  }\n}\n\nfunction disableSelectedCountry(container) {\n  const listOfCountries = container.querySelectorAll('li');\n  listOfCountries.forEach((countryLanguage) => {\n    if (countryLanguage.innerHTML.includes('selected')) {\n      countryLanguage.classList.add('deactivated');\n      countryLanguage.innerHTML = countryLanguage.innerHTML.replace('(selected)', '');\n    }\n  });\n}\n\nfunction setupPrivacyButton(container) {\n  const privacyButton = container.querySelector('a[href=\"#privacybutton\"]');\n  if (privacyButton) {\n    privacyButton.href = '#';\n    privacyButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      if (window.UC_UI) {\n        window.UC_UI.showSecondLayer();\n      }\n    });\n  }\n}\n\nasync function runDefaultFooterLogic(block) {\n  // fetch footer content\n  const footerPath = getMetadata('footer') || '/footer';\n  const resp = await fetch(`${footerPath}.plain.html`, window.location.pathname.endsWith('/footer') ? { cache: 'reload' } : {});\n\n  if (resp.ok) {\n    const html = await resp.text();\n\n    // decorate footer DOM\n    const footer = document.createElement('div');\n    footer.innerHTML = html;\n\n    wrapImgsInLinks(footer);\n\n    const sectionHeaders = footer.querySelectorAll('div > div > p');\n    sectionHeaders[2].addEventListener('click', onFooterElementClick);\n    sectionHeaders[3].addEventListener('click', onFooterElementClick);\n\n    const sectionsData = footer.querySelectorAll('div > div > ul');\n    disableSelectedCountry(sectionsData[3]);\n\n    decorateIcons(footer);\n    block.append(footer);\n\n    setupPrivacyButton(footer);\n\n    adobeMcAppendVisitorId('footer');\n  }\n}\n\nasync function runLandingpageLogic(block) {\n  const footerPath = getMetadata('footer') || '/footer';\n  const resp = await fetch(`${footerPath}.plain.html`);\n\n  const fragment = document.createElement('main');\n  if (resp.ok) {\n    fragment.innerHTML = await resp.text();\n    decorateMain(fragment);\n    await loadBlocks(fragment);\n  }\n  const footer = block.closest('.footer-wrapper');\n\n  if (window.location.href.indexOf('scuderiaferrari') !== -1 || window.location.href.indexOf('spurs') !== -1) {\n    block.closest('.footer-wrapper').id = 'footer-ferrari';\n  }\n\n  if (fragment) {\n    const fragmentSections = fragment.querySelectorAll(':scope .section');\n    if (fragmentSections) {\n      footer.replaceChildren(...fragmentSections);\n    }\n  }\n\n  const replacements = [\n    [/\\[year\\]/g, new Date().getFullYear()],\n    [/>Twitter Bitdefender</, '><img alt=\"x\" src=\"/_src/icons/twitter.svg\" /><'],\n    [/>Linkedin Bitdefender</, '><img alt=\"linkedin\" src=\"/_src/icons/linkedin.svg\" /><'],\n    [/>Facebook Bitdefender</, '><img alt=\"facebook\" src=\"/_src/icons/facebook.svg\" /><'],\n    [/>Youtube Bitdefender</, '><img alt=\"youtube\" src=\"/_src/icons/youtube.svg\" /><'],\n  ];\n\n  replacements.forEach(([pattern, replacement]) => {\n    footer.innerHTML = footer.innerHTML.replace(pattern, replacement);\n  });\n\n  setupPrivacyButton(footer);\n\n  adobeMcAppendVisitorId('footer');\n}\n\nasync function runAemFooterLogic() {\n  // fetch footer content\n  const aemFooterHostname = window.location.hostname.includes('.aem.')\n    || window.location.hostname.includes('localhost')\n    ? 'https://www.bitdefender.com'\n    : '';\n\n  const websiteDomain = getDomain();\n  let aemFetchDomain;\n\n  if (websiteDomain === 'en-us') {\n    aemFetchDomain = 'en';\n  } else if (websiteDomain.includes('-global')) {\n    const [singleDomain] = websiteDomain.split('-');\n    aemFetchDomain = singleDomain;\n  } else {\n    aemFetchDomain = websiteDomain.split('-').join('_');\n  }\n\n  const aemFooterFetch = await fetch(`${aemFooterHostname}/content/experience-fragments/bitdefender/language_master/${aemFetchDomain}/footer-fragment-v1/master/jcr:content/root.html`);\n  if (!aemFooterFetch.ok) {\n    return;\n  }\n\n  const aemFooterHtml = await aemFooterFetch.text();\n  const footer = document.createElement('footer');\n  const shadowRoot = footer.attachShadow({ mode: 'open' });\n  const contentDiv = document.createElement('div');\n  contentDiv.innerHTML = aemFooterHtml;\n\n  const loadedLinks = [];\n  contentDiv.querySelectorAll('link').forEach((linkElement) => {\n    // update the links so that they work on all Franklin domains\n    linkElement.href = `${aemFooterHostname}${linkElement.getAttribute('href')}`;\n    linkElement.rel = 'stylesheet';\n\n    // add a promise for each link element in the code\n    // so that we can wait on all the CSS before displaying the component\n    loadedLinks.push(new Promise((resolve, reject) => {\n      linkElement.onload = () => {\n        resolve();\n      };\n\n      linkElement.onerror = () => {\n        reject();\n      };\n    }));\n  });\n\n  // a list of all the components to be received from aem components\n  const aemComponents = ['footer'];\n\n  // add logic so that every time an AEM function is fully loaded\n  // it is directly run using the shadow dom as parameter\n  aemComponents.forEach((aemComponentName) => {\n    window.addEventListener(aemComponentName, () => {\n      window[aemComponentName](shadowRoot);\n    });\n  });\n\n  // select all the scripts from contet div and\n  const scripts = contentDiv.querySelectorAll('script');\n  scripts.forEach((script) => {\n    //  multiple reruns of runtime lead to all the scripts\n    // being run multiple times\n    if (!script.src.includes('runtime')) {\n      const newScript = document.createElement('script');\n      newScript.src = `${aemFooterHostname}${script.getAttribute('src')}`;\n      newScript.defer = true;\n      shadowRoot.appendChild(newScript);\n    }\n  });\n\n  shadowRoot.appendChild(contentDiv);\n  document.querySelector('footer').replaceWith(footer);\n}\n\n/**\n * applies footer factory based on footer variation\n * @param {String} footerMetadata The footer variation: landingpage' or none\n * @param {Element} footer The footer element\n */\nfunction applyFooterFactorySetup(footerMetadata, block) {\n  switch (footerMetadata) {\n    case 'landingpage':\n      runLandingpageLogic(block);\n      break;\n    case 'franklinFooter':\n      runDefaultFooterLogic(block);\n      break;\n    case 'hidden':\n      break;\n    default:\n      runAemFooterLogic(block);\n      break;\n  }\n}\n\n/**\n * loads and decorates the footer\n * @param {Element} block The footer block element\n */\nexport default async function decorate(block) {\n  const footerMetadata = getMetadata('footer-type');\n  block.parentNode.classList.add(footerMetadata || 'default');\n\n  block.textContent = '';\n\n  applyFooterFactorySetup(footerMetadata, block);\n}\n"],"names":["wrapImgsInLinks","container","pic","link","onFooterElementClick","evt","header","ul","callback","disableSelectedCountry","countryLanguage","setupPrivacyButton","privacyButton","runDefaultFooterLogic","block","footerPath","getMetadata","resp","html","footer","sectionHeaders","sectionsData","decorateIcons","adobeMcAppendVisitorId","runLandingpageLogic","fragment","decorateMain","loadBlocks","fragmentSections","pattern","replacement","runAemFooterLogic","aemFooterHostname","websiteDomain","getDomain","aemFetchDomain","singleDomain","aemFooterFetch","aemFooterHtml","shadowRoot","contentDiv","loadedLinks","linkElement","resolve","reject","aemComponentName","script","newScript","applyFooterFactorySetup","footerMetadata","decorate"],"mappings":"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"}