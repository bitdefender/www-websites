{"version":3,"file":"quiz-stepper.js","sources":["../../../src/blocks/quiz-stepper/quiz-stepper.js"],"sourcesContent":["import { getDatasetFromSection } from '../../scripts/utils/utils.js';\n\nexport default async function decorate(block) {\n  const dataset = getDatasetFromSection(block);\n\n  const {\n    questionLabel, nextButtonLabel, previousButtonLabel, seeResultsLabel, selectErrorLabel,\n  } = dataset;\n\n  const state = {\n    score: 0,\n    currentStep: 0,\n  };\n\n  block.classList.add('default-content-wrapper');\n  block.closest('.section').id = 'quiz-form';\n\n  const steps = [...block.children];\n\n  function renderStep(step, index) {\n    const stepTitle = step.children[0].children[0].textContent;\n    const stepOptions = [...step.children[0].children[1].children];\n    const stepImage = step.children[1].children[0];\n    const isFirstStep = index === 0;\n    const isLastStep = index === steps.length - 1;\n\n    const fieldId = `question-${index}`;\n\n    return `\n      <div class=\"form-wrapper\">\n        <form class=\"step\">\n           <div class=\"step-header\">\n             <div class=\"step-index\">${questionLabel} ${index + 1}/${steps.length}:</div>\n             ${!isFirstStep ? `<a class=\"step-previous\">${previousButtonLabel}</a>` : ''}\n           </div>\n        \n           \n           <fieldset>\n             <legend>${stepTitle}</legend>\n             \n             \n                ${stepOptions.map((option, idx) => {\n    const value = option.querySelector('u') ? 1 : 0;\n    const forLabel = `${fieldId}-${idx}`;\n\n    return `\n                <div class=\"step-radio-wrapper\">\n                  <input type=\"radio\" id=\"${forLabel}\" name=\"${fieldId}\" value=\"${value}\" required aria-required=\"true\"/>\n                  <label for=\"${forLabel}\">${option.textContent}</label>\n                </div>  \n                `;\n  }).join('')}\n                <div class=\"error-message\">${selectErrorLabel}</div>\n           </fieldset>\n    \n           <p class=\"button-container submit\">\n            <a class=\"button modal\" href=\"\">${!isLastStep ? nextButtonLabel : seeResultsLabel}</a>\n           </p>\n         \n            <div class=\"img-container\">\n                ${stepImage.outerHTML}\n            </div>    \n        </form>\n      </div>\n    `;\n  }\n\n  function moveToNextStep() {\n    state.currentStep += 1;\n    const slideWrapper = block.querySelector('.slide-wrapper');\n    const offset = 60;\n\n    const transformValue = `translateX(calc(-100% * ${state.currentStep} - (${offset}px *  ${state.currentStep})))`;\n    slideWrapper.style.transform = transformValue;\n  }\n\n  function moveToPreviousStep() {\n    state.currentStep -= 1;\n    const slideWrapper = block.querySelector('.slide-wrapper');\n    const offset = 60;\n\n    const transformValue = `translateX(calc(-100% * ${state.currentStep} - (${offset}px *  ${state.currentStep})))`;\n    slideWrapper.style.transform = transformValue;\n  }\n\n  function renderResults() {\n    block.style.transform = null;\n\n    // get score\n    /* eslint-disable-next-line */\n    const score = [...block.querySelectorAll('input[type=\"radio\"]:checked')].map((inputEl) => inputEl.value).reduce((sc, value) => sc += Number(value), 0);\n\n    const legendScore = Object.keys(dataset)\n      .filter((item) => item.includes('result_'))\n      .map((item) => ({\n        template: item.split('result_')[1].split('_').join('-'),\n        interval: [...dataset[item].split('-')],\n      }));\n\n    /* eslint-disable max-len */\n    const foundLegend = legendScore.find(({ interval: [min, max] }) => Number(min) <= score && score <= Number(max));\n\n    const { origin, pathname } = window.location;\n    // redirect\n    window.location.replace(`${origin}${pathname}${foundLegend.template}`);\n  }\n\n  function validateForm(e) {\n    e.preventDefault();\n\n    const formEl = e.target.closest('form');\n    const selectedOption = formEl.querySelector('input[type=\"radio\"]:checked');\n    const isLastStep = state.currentStep === steps.length - 1;\n\n    if (!selectedOption) {\n      formEl.querySelector('fieldset').classList.add('invalid');\n      return;\n    }\n\n    if (!isLastStep) {\n      moveToNextStep();\n      return;\n    }\n\n    renderResults();\n  }\n\n  block.innerHTML = `\n    <div class=\"slide-wrapper\">${steps.map((step, index) => renderStep(step, index)).join('')}</div>\n  `;\n\n  block.querySelectorAll('form').forEach((form) => {\n    const radios = form.querySelectorAll('input[type=\"radio\"]');\n\n    radios.forEach((radio) => {\n      radio.addEventListener('change', (event) => {\n        if (event.target.checked) {\n          form.querySelector('fieldset').classList.remove('invalid');\n        }\n      });\n    });\n\n    form.querySelectorAll('.button-container.submit').forEach((buttonEl) => buttonEl.addEventListener('click', validateForm));\n    form.querySelectorAll('.step-previous').forEach((previousEl) => previousEl.addEventListener('click', moveToPreviousStep));\n  });\n}\n"],"names":[],"mappings":"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"}