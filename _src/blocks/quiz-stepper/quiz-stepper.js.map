{"version":3,"file":"quiz-stepper.js","sources":["../../../src/blocks/quiz-stepper/quiz-stepper.js"],"sourcesContent":["import { getDatasetFromSection } from '../../scripts/utils/utils.js';\n\nexport default async function decorate(block) {\n  const dataset = getDatasetFromSection(block);\n\n  const {\n    questionLabel, nextButtonLabel, previousButtonLabel, seeResultsLabel, selectErrorLabel,\n  } = dataset;\n\n  const state = {\n    score: 0,\n    currentStep: 0,\n  };\n\n  block.classList.add('default-content-wrapper');\n  block.closest('.section').id = 'quiz-form';\n\n  const steps = [...block.children];\n\n  function renderStep(step, index) {\n    const stepTitle = step.children[0].children[0].textContent;\n    const stepOptions = [...step.children[0].children[1].children];\n    const stepImage = step.children[1].children[0];\n    const isFirstStep = index === 0;\n    const isLastStep = index === steps.length - 1;\n\n    const fieldId = `question-${index}`;\n\n    return `\n      <div class=\"form-wrapper\">\n        <form class=\"step\">\n           <div class=\"step-header\">\n             <div class=\"step-index\">${questionLabel} ${index + 1}/${steps.length}:</div>\n             ${!isFirstStep ? `<a class=\"step-previous\">${previousButtonLabel}</a>` : ''}\n           </div>\n        \n           \n           <fieldset>\n             <legend>${stepTitle}</legend>\n             \n             \n                ${stepOptions.map((option, idx) => {\n    const value = option.querySelector('u') ? 1 : 0;\n    const forLabel = `${fieldId}-${idx}`;\n\n    return `\n                <div class=\"step-radio-wrapper\">\n                  <input type=\"radio\" id=\"${forLabel}\" name=\"${fieldId}\" value=\"${value}\" required aria-required=\"true\"/>\n                  <label for=\"${forLabel}\">${option.textContent}</label>\n                </div>  \n                `;\n  }).join('')}\n                <div class=\"error-message\">${selectErrorLabel}</div>\n           </fieldset>\n    \n           <p class=\"button-container submit\">\n            <a class=\"button modal\" href=\"\">${!isLastStep ? nextButtonLabel : seeResultsLabel}</a>\n           </p>\n         \n            <div class=\"img-container\">\n                ${stepImage.outerHTML}\n            </div>    \n        </form>\n      </div>\n    `;\n  }\n\n  function moveToNextStep() {\n    state.currentStep += 1;\n    const slideWrapper = block.querySelector('.slide-wrapper');\n    const offset = 60;\n\n    const transformValue = `translateX(calc(-100% * ${state.currentStep} - (${offset}px *  ${state.currentStep})))`;\n    slideWrapper.style.transform = transformValue;\n  }\n\n  function moveToPreviousStep() {\n    state.currentStep -= 1;\n    const slideWrapper = block.querySelector('.slide-wrapper');\n    const offset = 60;\n\n    const transformValue = `translateX(calc(-100% * ${state.currentStep} - (${offset}px *  ${state.currentStep})))`;\n    slideWrapper.style.transform = transformValue;\n  }\n\n  function renderResults() {\n    block.style.transform = null;\n\n    // get score\n    /* eslint-disable-next-line */\n    const score = [...block.querySelectorAll('input[type=\"radio\"]:checked')].map((inputEl) => inputEl.value).reduce((sc, value) => sc += Number(value), 0);\n\n    const legendScore = Object.keys(dataset)\n      .filter((item) => item.includes('result_'))\n      .map((item) => ({\n        template: item.split('result_')[1].split('_').join('-'),\n        interval: [...dataset[item].split('-')],\n      }));\n\n    /* eslint-disable max-len */\n    const foundLegend = legendScore.find(({ interval: [min, max] }) => Number(min) <= score && score <= Number(max));\n\n    const { origin, pathname } = window.location;\n    // redirect\n    window.location.replace(`${origin}${pathname}${foundLegend.template}`);\n  }\n\n  function validateForm(e) {\n    e.preventDefault();\n\n    const formEl = e.target.closest('form');\n    const selectedOption = formEl.querySelector('input[type=\"radio\"]:checked');\n    const isLastStep = state.currentStep === steps.length - 1;\n\n    if (!selectedOption) {\n      formEl.querySelector('fieldset').classList.add('invalid');\n      return;\n    }\n\n    if (!isLastStep) {\n      moveToNextStep();\n      return;\n    }\n\n    renderResults();\n  }\n\n  block.innerHTML = `\n    <div class=\"slide-wrapper\">${steps.map((step, index) => renderStep(step, index)).join('')}</div>\n  `;\n\n  block.querySelectorAll('form').forEach((form) => {\n    const radios = form.querySelectorAll('input[type=\"radio\"]');\n\n    radios.forEach((radio) => {\n      radio.addEventListener('change', (event) => {\n        if (event.target.checked) {\n          form.querySelector('fieldset').classList.remove('invalid');\n        }\n      });\n    });\n\n    form.querySelectorAll('.button-container.submit').forEach((buttonEl) => buttonEl.addEventListener('click', validateForm));\n    form.querySelectorAll('.step-previous').forEach((previousEl) => previousEl.addEventListener('click', moveToPreviousStep));\n  });\n}\n"],"names":["decorate","block","dataset","getDatasetFromSection","questionLabel","nextButtonLabel","previousButtonLabel","seeResultsLabel","selectErrorLabel","state","steps","renderStep","step","index","stepTitle","stepOptions","stepImage","isFirstStep","isLastStep","fieldId","option","idx","value","forLabel","moveToNextStep","slideWrapper","transformValue","moveToPreviousStep","renderResults","score","inputEl","sc","foundLegend","item","min","max","origin","pathname","validateForm","formEl","selectedOption","form","radio","event","buttonEl","previousEl"],"mappings":"qEAEe,eAAeA,EAASC,EAAO,CAC5C,MAAMC,EAAUC,EAAsBF,CAAK,EAErC,CACJ,cAAAG,EAAe,gBAAAC,EAAiB,oBAAAC,EAAqB,gBAAAC,EAAiB,iBAAAC,CAC1E,EAAMN,EAEEO,EAAQ,CAEZ,YAAa,CACd,EAEDR,EAAM,UAAU,IAAI,yBAAyB,EAC7CA,EAAM,QAAQ,UAAU,EAAE,GAAK,YAE/B,MAAMS,EAAQ,CAAC,GAAGT,EAAM,QAAQ,EAEhC,SAASU,EAAWC,EAAMC,EAAO,CAC/B,MAAMC,EAAYF,EAAK,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,YACzCG,EAAc,CAAC,GAAGH,EAAK,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,QAAQ,EACvDI,EAAYJ,EAAK,SAAS,CAAC,EAAE,SAAS,CAAC,EACvCK,EAAcJ,IAAU,EACxBK,EAAaL,IAAUH,EAAM,OAAS,EAEtCS,EAAU,YAAYN,CAAK,GAEjC,MAAO;AAAA;AAAA;AAAA;AAAA,uCAI4BT,CAAa,IAAIS,EAAQ,CAAC,IAAIH,EAAM,MAAM;AAAA,eACjEO,EAAsE,GAAxD,4BAA4BX,CAAmB,MAAW;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKjEQ,CAAS;AAAA;AAAA;AAAA,kBAGdC,EAAY,IAAI,CAACK,EAAQC,IAAQ,CAC/C,MAAMC,EAAQF,EAAO,cAAc,GAAG,EAAI,EAAI,EACxCG,EAAW,GAAGJ,CAAO,IAAIE,CAAG,GAElC,MAAO;AAAA;AAAA,4CAEiCE,CAAQ,WAAWJ,CAAO,YAAYG,CAAK;AAAA,gCACvDC,CAAQ,KAAKH,EAAO,WAAW;AAAA;AAAA,iBAG/D,CAAG,EAAE,KAAK,EAAE,CAAC;AAAA,6CACgCZ,CAAgB;AAAA;AAAA;AAAA;AAAA,8CAIdU,EAA+BX,EAAlBF,CAAiC;AAAA;AAAA;AAAA;AAAA,kBAI3EW,EAAU,SAAS;AAAA;AAAA;AAAA;AAAA,KAKrC,CAEE,SAASQ,GAAiB,CACxBf,EAAM,aAAe,EACrB,MAAMgB,EAAexB,EAAM,cAAc,gBAAgB,EAGnDyB,EAAiB,2BAA2BjB,EAAM,WAAW,eAAsBA,EAAM,WAAW,MAC1GgB,EAAa,MAAM,UAAYC,CACnC,CAEE,SAASC,GAAqB,CAC5BlB,EAAM,aAAe,EACrB,MAAMgB,EAAexB,EAAM,cAAc,gBAAgB,EAGnDyB,EAAiB,2BAA2BjB,EAAM,WAAW,eAAsBA,EAAM,WAAW,MAC1GgB,EAAa,MAAM,UAAYC,CACnC,CAEE,SAASE,GAAgB,CACvB3B,EAAM,MAAM,UAAY,KAIxB,MAAM4B,EAAQ,CAAC,GAAG5B,EAAM,iBAAiB,6BAA6B,CAAC,EAAE,IAAK6B,GAAYA,EAAQ,KAAK,EAAE,OAAO,CAACC,EAAIT,IAAUS,GAAM,OAAOT,CAAK,EAAG,CAAC,EAU/IU,EARc,OAAO,KAAK9B,CAAO,EACpC,OAAQ+B,GAASA,EAAK,SAAS,SAAS,CAAC,EACzC,IAAKA,IAAU,CACd,SAAUA,EAAK,MAAM,SAAS,EAAE,CAAC,EAAE,MAAM,GAAG,EAAE,KAAK,GAAG,EACtD,SAAU,CAAC,GAAG/B,EAAQ+B,CAAI,EAAE,MAAM,GAAG,CAAC,CAC9C,EAAQ,EAG4B,KAAK,CAAC,CAAE,SAAU,CAACC,EAAKC,CAAG,CAAC,IAAO,OAAOD,CAAG,GAAKL,GAASA,GAAS,OAAOM,CAAG,CAAC,EAEzG,CAAE,OAAAC,EAAQ,SAAAC,CAAU,EAAG,OAAO,SAEpC,OAAO,SAAS,QAAQ,GAAGD,CAAM,GAAGC,CAAQ,GAAGL,EAAY,QAAQ,EAAE,CACzE,CAEE,SAASM,EAAa,EAAG,CACvB,EAAE,eAAgB,EAElB,MAAMC,EAAS,EAAE,OAAO,QAAQ,MAAM,EAChCC,EAAiBD,EAAO,cAAc,6BAA6B,EACnErB,EAAaT,EAAM,cAAgBC,EAAM,OAAS,EAExD,GAAI,CAAC8B,EAAgB,CACnBD,EAAO,cAAc,UAAU,EAAE,UAAU,IAAI,SAAS,EACxD,MACN,CAEI,GAAI,CAACrB,EAAY,CACfM,EAAgB,EAChB,MACN,CAEII,EAAe,CACnB,CAEE3B,EAAM,UAAY;AAAA,iCACaS,EAAM,IAAI,CAACE,EAAMC,IAAUF,EAAWC,EAAMC,CAAK,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA,IAG3FZ,EAAM,iBAAiB,MAAM,EAAE,QAASwC,GAAS,CAChCA,EAAK,iBAAiB,qBAAqB,EAEnD,QAASC,GAAU,CACxBA,EAAM,iBAAiB,SAAWC,GAAU,CACtCA,EAAM,OAAO,SACfF,EAAK,cAAc,UAAU,EAAE,UAAU,OAAO,SAAS,CAEnE,CAAO,CACP,CAAK,EAEDA,EAAK,iBAAiB,0BAA0B,EAAE,QAASG,GAAaA,EAAS,iBAAiB,QAASN,CAAY,CAAC,EACxHG,EAAK,iBAAiB,gBAAgB,EAAE,QAASI,GAAeA,EAAW,iBAAiB,QAASlB,CAAkB,CAAC,CAC5H,CAAG,CACH"}