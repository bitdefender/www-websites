import"../../node_modules/@repobit/dex-utils/dist/src/index.js";import{getMetadata as E,decorateButtons as N,decorateIcons as q,decorateTags as $}from"../../scripts/lib-franklin.js";import{getDomain as x,decorateBlockWithRegionId as M,decorateLinkWithLinkTrackingId as D}from"../../scripts/utils/utils.js";import{adobeMcAppendVisitorId as B,target as W}from"../../scripts/target.js";import{Constants as k}from"../../scripts/libs/constants.js";import T from"../../node_modules/@repobit/dex-utils/dist/src/user.js";import O from"../../node_modules/@repobit/dex-utils/dist/src/cookies.js";const P=(t,e,n)=>{let a,o;if(t){const c=t.split(" ");a=c[0].charAt(0).toUpperCase(),o=c.length>1?c[1].charAt(0).toUpperCase():c[0].length>1?c[0].charAt(1).toUpperCase():""}else{const c=e.split("@")[0].replace(/[^a-zA-Z]+/g,"");a=c.charAt(0).toUpperCase(),o=c.length>1?c.charAt(1).toUpperCase():""}const s=n.querySelector(".mega-menu__right-link");s.classList.add("mega-menu__login"),s.textContent=`${a}${o}`;const i=n.querySelector(".mega-menu__second-level-container"),r=i.querySelector(".mega-menu__column .navigation__header-link"),f=[...i.querySelectorAll(".navigation__link")].filter(c=>c.dataset.loggedInLink);r&&(r.textContent=t?`${s.dataset.loginText}, ${t}`:`${s.dataset.loginText}, ${e}`);const u=O.get(k.LOGIN_LOGGED_USER_EXPIRY_COOKIE_NAME);(!u||u&&u>Date.now())&&f.forEach(async c=>{c.href=await W.appendVisitorIDsTo(c.dataset.loggedInLink)})},U=async(t=document)=>{try{await T.login();const e=await T.info;if(e){const n=t.querySelector("li.mega-menu__login-container");P(e.firstname,e.email,n)}}catch(e){console.warn(e)}};function R(t,e){t.querySelectorAll("img").forEach(n=>{n.src=`${e}${n.getAttribute("src")}`;function a(o){return o.replace(/(?:,|^)\s*(\/[^\s,]+)/g,(s,i)=>s.replace(i,`${e}${i}`))}n.srcset&&(n.srcset=a(n.srcset))})}function G(){const t=document.querySelector("nav > div:nth-child(4)");t.classList.add("login-modal");const e=document.createElement("div");e.className="triangle",t.appendChild(e);const n=document.createElement("div");n.className="divider",t.appendChild(n)}function z(){const t=document.querySelector(".login-modal");t.classList.contains("show")?t.classList.remove("show"):(t.style.display="flex",setTimeout(()=>{t.classList.add("show")},0)),document.querySelector(".nav-sections p:last-child").classList.toggle("clicked")}function F(){document.querySelectorAll(".mega-menu-websites > div").forEach(e=>{e.querySelectorAll("ul").forEach(a=>{const o=a.previousElementSibling,s=document.createElement("div");Array.from(a.children).forEach(i=>{s.textContent+=` ${i.textContent}`,s.textContent=s.textContent.slice(1)}),o.appendChild(s),a.remove()})})}function j(){const t=document.getElementById("nav"),e=Array.from(t.children).filter(r=>r.tagName.toLowerCase()==="div"),n=e.findIndex(r=>r.classList.contains("nav-sections")),a=document.createElement("div");a.className="mega-menu-websites",M(a,"Main Menu|Home Solutions");const o=document.createElement("div");o.className="other-options";const s=document.createElement("div");s.className="bottom-links",a.appendChild(e[n+1].cloneNode(!0)),t.removeChild(e[n+1]);for(let r=n+2;r<8;r+=1)o.appendChild(e[r].cloneNode(!0)),t.removeChild(e[r]);for(let r=8;r<e.length;r+=1)s.appendChild(e[r].cloneNode(!0)),t.removeChild(e[r]);t.appendChild(a),a.appendChild(o),a.appendChild(s),o.firstElementChild&&a.insertBefore(o.firstElementChild,o),s.firstElementChild&&o.appendChild(s.firstElementChild);const i=document.querySelector(".mega-menu-websites > div:first-child");t.appendChild(i)}function V(){document.querySelectorAll("header .button-container > div").forEach(e=>{e.parentNode.querySelector("a").appendChild(e)},this)}function Y(){const t=document.querySelector(".bottom-links"),e=t.querySelectorAll("p"),n=t.querySelectorAll("span"),a=t.querySelectorAll("a");e.forEach(o=>{o.classList.remove("button-container")}),n.forEach(o=>{o.classList.remove("button-text")}),a.forEach(o=>{o.classList.remove("button")})}function K(){j(),F(),Y(),V()}function Q(t,e){const n=e.querySelector(".nav-sections"),a=e.querySelector(".nav-brand"),o=e.querySelectorAll(".nav-brand a");if(n&&(M(n,"Main Menu|General Links"),document.querySelector(".nav-sections p:last-child").addEventListener("click",m=>{m.preventDefault(),z()})),a&&o&&o.length>0){M(a,"Main Menu|Brands");const p=Array.from(o)[0];p&&p.classList.add("active")}const s=document.createElement("div");s.className="nav-wrapper",s.append(e),t.append(s),K();const i=document.createElement("p"),r=document.querySelector(".bottom-links > div:last-child > p");i.innerHTML=r.innerHTML,i.classList.add("home-solutions-link-default"),document.querySelector(".header-wrapper").appendChild(i);const u=document.querySelector(".bottom-links");u.removeChild(u.lastElementChild);const c=document.querySelector(".mega-menu-websites");let g=!1,v=!1;const l=()=>{c.style.display="flex",setTimeout(()=>{c.classList.add("mega-menu-websites-show")},10)},d=()=>{!g&&!v&&(c.classList.remove("mega-menu-websites-show"),i.classList.remove("home-solutions-link-hover"))};i.addEventListener("mouseenter",()=>{g=!0,l(),i.classList.add("home-solutions-link-hover")}),i.addEventListener("mouseleave",()=>{g=!1,setTimeout(d,0)}),c.addEventListener("mouseenter",()=>{v=!0}),c.addEventListener("mouseleave",()=>{v=!1,d(),i.classList.remove("home-solutions-link-hover")}),G()}function X(){this.classList.toggle("change");const t=document.querySelector(".header-wrapper");t.classList.toggle("expanded"),document.body.classList.toggle("no-scroll");let e=!1;const n=document.querySelector(".options-wrapper");setTimeout(()=>{n.classList.toggle("show")},100),window.addEventListener("resize",()=>{window.innerWidth>1e3&&!e&&t.classList.contains("expanded")?(t.classList.toggle("expanded"),this.classList.toggle("change"),n.classList.toggle("show"),e=!0):window.innerWidth<=1e3&&(e=!1)});const a=document.querySelector(".mega-menu-websites").firstElementChild,o=Array.from(document.querySelector(".other-options").children),s=[a].concat(o),i=[];for(let l=0;l<s.length;l+=1){const d={},p=s[l],m=p.querySelector("h2");if(m){d.title=m.childNodes[0].textContent.trim();const L=p.querySelectorAll("a:not(h2 a)");L.length>0&&(d.subMenu=[],L.forEach(y=>{const S={},w=y.cloneNode(!0);S.name=w.textContent,S.url=w.href,S.updatedLinkHTML=w.outerHTML,d.subMenu.push(S)})),i.push(d)}else p.parentNode.removeChild(p)}let r;function f(l){return`<div class='sub-menu-title' data-option='${l.title}'>${l.title}</div>${l.subMenu.map(d=>`<a href='${d.url}'>${d.updatedLinkHTML}</a>`).join("")}`}const u=i.map(l=>`<div class='menu-option' data-option='${l.title}'>${l.title}</div>`).join("");r=u,n.innerHTML=u;function c(){const l=this.dataset.option,d=i.find(y=>y.title===l);n.innerHTML=f(d);const p=document.querySelector(".sub-menu-title");p&&p.addEventListener("click",v);const m=document.querySelector(".options-wrapper.show");m.style.height="auto",m.querySelectorAll("div:not(.sub-menu-title)").forEach(y=>{y.parentNode.removeChild(y)})}function g(){document.querySelectorAll(".menu-option").forEach(d=>{d.addEventListener("click",c)});const l=document.querySelector(".options-wrapper.show");l&&(l.style.height="100vh")}function v(){n.innerHTML=r,g()}g()}function Z(t){const e=document.querySelector(".header.block"),n=document.createElement("div");n.className="nav-wrapper",n.append(t);const a=document.createElement("div");a.classList.add("menu-wrapper"),a.addEventListener("click",X);for(let s=0;s<3;s+=1){const i=document.createElement("span");i.classList.add("menu-bar"),a.appendChild(i)}const o=document.createElement("div");o.className="options-wrapper",e.appendChild(t),e.appendChild(a),e.appendChild(o)}async function J(t){const e=document.querySelector(".hero");e&&e.classList.contains("black-background")&&document.querySelector("header").classList.add("black-background");const n=document.querySelector(".header.block");n.removeChild(n.firstElementChild);const a=E("nav")||"/nav",o=await fetch(`${a}.plain.html`);if(o.ok){const f=await o.text();if(f.includes("aem-banner")){const p=x();let m;if(p==="en-us")m="en";else if(p.includes("-global")){const[h]=p.split("-");m=h}else m=p.split("-").join("_");const L=await fetch(`${k.PUBLIC_URL_ORIGIN}/content/experience-fragments/bitdefender/language_master/${m}/header-navigation/mega-menu/master/jcr:content/root.html`);if(!L.ok)return;const y=await L.text(),S=document.createElement("div"),w=S.attachShadow({mode:"open"}),C=document.createElement("div");C.style.display="none",C.innerHTML=y,k.PUBLIC_URL_ORIGIN==="https://stage.bitdefender.com"&&R(C,k.PUBLIC_URL_ORIGIN);const I=[];C.querySelectorAll("link").forEach(h=>{h.href=`${k.PUBLIC_URL_ORIGIN}${h.getAttribute("href")}`,I.push(new Promise((b,H)=>{h.onload=()=>{b()},h.onerror=()=>{H()}}))}),["languageBanner","megaMenu"].forEach(h=>{window.addEventListener(h,()=>{window[h](w)})}),C.querySelectorAll("script").forEach(h=>{const b=document.createElement("script");b.src=`${k.PUBLIC_URL_ORIGIN}${h.getAttribute("src")}`,b.defer=!0,C.appendChild(b)}),w.appendChild(C);const _=document.querySelector("body");_.style.maxWidth="initial";const A=document.querySelector("header");A&&A.remove(),document.querySelector("body").prepend(S),await Promise.allSettled(I),C.style.display="block",S.classList.add("header-with-language-banner"),B(w),U(w);return}const u=document.createElement("nav");u.id="nav",u.innerHTML=f,["brand","sections"].forEach((p,m)=>{const L=u.children[m];L&&L.classList.add(`nav-${p}`)}),N(u),Z(u),Q(t,u),q(u),$(u);const g=document.querySelector(".bottom-links"),v=document.querySelector("header"),l=g.children[2];g.removeChild(l),l.classList.add("logo");const d=document.createElement("div");d.classList.add("logo-container"),M(d,"Main Menu|Logo Container"),d.appendChild(l),v.querySelector("p.home-solutions-link-default")&&d.appendChild(v.querySelector("p.home-solutions-link-default")),q(d),v.appendChild(d)}const s=document.querySelector(".logo a");s.setAttribute("aria-label","Logo"),D(s,"Bitdefender Logo");const i=document.querySelector(".header-wrapper > div > p span:nth-child(2)");i&&i.parentNode.removeChild(i);const r=document.getElementsByClassName("header-wrapper")[0];window.addEventListener("scroll",()=>{window.innerWidth>990&&(window.scrollY>0?(r.style.display="none",document.querySelector("nav > div:nth-child(4)").classList.remove("show")):r.style.display="block")})}async function ee(t){const e=E("nav")||"/nav",a=await(await fetch(`${e}.plain.html`)).text();t.classList.add("lp-header","py-3","default-content-wrapper");const o=t.closest("header");o.id="header-ferrari",o.classList.add("header-spurs","dark"),t.innerHTML=a;const s=t.closest(".lp-header");s.addEventListener("click",()=>{s.classList.toggle("active",!s.classList.contains("active"))})}async function te(t){const e=E("nav")||"/nav",a=await(await fetch(`${e}.plain.html`)).text();t.classList.add("quiz","py-3","default-content-wrapper"),t.closest("header").classList.add("dark"),t.innerHTML=a,q(t)}function ne(t,e){switch(t){case"landingpage":ee(e);break;case"quiz":te(e);break;case"hidden":break;default:J(e);break}}async function pe(t){const e=E("header-type");t.parentNode.classList.add(e||"default"),ne(e,t)}export{pe as default};
//# sourceMappingURL=header.js.map
