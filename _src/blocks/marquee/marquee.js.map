{"version":3,"file":"marquee.js","sources":["../../../src/blocks/marquee/marquee.js"],"sourcesContent":["import { debounce } from '@repobit/dex-utils';\nimport { getDatasetFromSection, isView } from '../../scripts/utils/utils.js';\n\nexport default async function decorate(block) {\n  const defaultBackgroundColor = '#004299';\n  const SLIDE_SIZE_ENUM = {\n    MOBILE: 85 + 20 * 2,\n    TABLET_UP: 85 + 20 * 2,\n  };\n\n  const SPEED_ANIMATION = 0.6;\n\n  const [title, ...initialSlideList] = [...block.children];\n\n  function getCurrentViewportSlideSize() {\n    return isView('mobile') ? SLIDE_SIZE_ENUM.MOBILE : SLIDE_SIZE_ENUM.TABLET_UP;\n  }\n  function calculateSlideListBasedOnScreenWidth() {\n    const result = {\n      duplicatedSlides: null,\n      slidesToShift: null,\n    };\n\n    const currentViewportSlideSize = getCurrentViewportSlideSize();\n    const clientWidth = window.innerWidth;\n    const spaceToFillMore = clientWidth - initialSlideList.length * currentViewportSlideSize; // ok\n    if (spaceToFillMore < 0) {\n      result.duplicatedSlides = initialSlideList.concat(initialSlideList);\n      result.slidesToShift = initialSlideList.length;\n\n      return result;\n    }\n    // fill space\n    const fullWidthSlidesToFill = parseInt(spaceToFillMore / currentViewportSlideSize, 10);\n    const hasPartialSlideToFill = clientWidth % currentViewportSlideSize !== 0;\n\n    result.duplicatedSlides = Array(fullWidthSlidesToFill)\n      .fill(initialSlideList).flatMap((slide) => slide);\n\n    if (!hasPartialSlideToFill) {\n      result.duplicatedSlides = result.duplicatedSlides.concat(result.duplicatedSlides);\n      result.slidesToShift = result.duplicatedSlides.length;\n\n      return result;\n    }\n\n    // need to apply the patch here\n    result.duplicatedSlides = result.duplicatedSlides.concat(initialSlideList);\n    result.slidesToShift = result.duplicatedSlides.length;\n    result.duplicatedSlides = result.duplicatedSlides.concat(result.duplicatedSlides);\n\n    return result;\n  }\n\n  function updateTranslation(slidesToShift) {\n    const content = block.querySelector('.marquee-content');\n    content.style.animationDuration = `${slidesToShift / SPEED_ANIMATION}s`;\n    content.style.setProperty('--translateX', `${getCurrentViewportSlideSize() * slidesToShift}px`);\n  }\n\n  function render() {\n    const blockDataset = getDatasetFromSection(block);\n    const { background_color: backgroundColor } = blockDataset;\n    block.style.background = backgroundColor || defaultBackgroundColor;\n\n    const { duplicatedSlides, slidesToShift } = calculateSlideListBasedOnScreenWidth();\n\n    block.innerHTML = `\n      <div class=\"default-content-wrapper\"><div class=\"title\">${title.textContent}</div></div>\n      <div class=\"outer-wrapper\">\n          <div class=\"marquee-content\">\n              ${duplicatedSlides.map((slide) => `<div class=\"marquee-item img-container\">${slide.querySelector('picture').outerHTML}</div>`).join('')}\n          </div>\n      </div>\n  `;\n\n    updateTranslation(slidesToShift);\n  }\n\n  render();\n\n  window.addEventListener('resize', debounce(render, 250));\n}\n"],"names":["decorate","block","defaultBackgroundColor","SLIDE_SIZE_ENUM","SPEED_ANIMATION","title","initialSlideList","getCurrentViewportSlideSize","isView","calculateSlideListBasedOnScreenWidth","result","currentViewportSlideSize","clientWidth","spaceToFillMore","fullWidthSlidesToFill","hasPartialSlideToFill","slide","updateTranslation","slidesToShift","content","render","blockDataset","getDatasetFromSection","backgroundColor","duplicatedSlides","debounce"],"mappings":"oOAGe,eAAeA,EAASC,EAAO,CAC5C,MAAMC,EAAyB,UACzBC,EAAkB,CACtB,OAAQ,IACR,UAAW,GACZ,EAEKC,EAAkB,GAElB,CAACC,EAAO,GAAGC,CAAgB,EAAI,CAAC,GAAGL,EAAM,QAAQ,EAEvD,SAASM,GAA8B,CACrC,OAAOC,EAAO,QAAQ,EAAIL,EAAgB,OAASA,EAAgB,SACvE,CACE,SAASM,GAAuC,CAC9C,MAAMC,EAAS,CACb,iBAAkB,KAClB,cAAe,IAChB,EAEKC,EAA2BJ,EAA6B,EACxDK,EAAc,OAAO,WACrBC,EAAkBD,EAAcN,EAAiB,OAASK,EAChE,GAAIE,EAAkB,EACpB,OAAAH,EAAO,iBAAmBJ,EAAiB,OAAOA,CAAgB,EAClEI,EAAO,cAAgBJ,EAAiB,OAEjCI,EAGT,MAAMI,EAAwB,SAASD,EAAkBF,EAA0B,EAAE,EAC/EI,EAAwBH,EAAcD,IAA6B,EAKzE,OAHAD,EAAO,iBAAmB,MAAMI,CAAqB,EAClD,KAAKR,CAAgB,EAAE,QAASU,GAAUA,CAAK,EAE7CD,GAQLL,EAAO,iBAAmBA,EAAO,iBAAiB,OAAOJ,CAAgB,EACzEI,EAAO,cAAgBA,EAAO,iBAAiB,OAC/CA,EAAO,iBAAmBA,EAAO,iBAAiB,OAAOA,EAAO,gBAAgB,EAEzEA,IAXLA,EAAO,iBAAmBA,EAAO,iBAAiB,OAAOA,EAAO,gBAAgB,EAChFA,EAAO,cAAgBA,EAAO,iBAAiB,OAExCA,EASb,CAEE,SAASO,EAAkBC,EAAe,CACxC,MAAMC,EAAUlB,EAAM,cAAc,kBAAkB,EACtDkB,EAAQ,MAAM,kBAAoB,GAAGD,EAAgBd,CAAe,IACpEe,EAAQ,MAAM,YAAY,eAAgB,GAAGZ,EAA6B,EAAGW,CAAa,IAAI,CAClG,CAEE,SAASE,GAAS,CAChB,MAAMC,EAAeC,EAAsBrB,CAAK,EAC1C,CAAE,iBAAkBsB,CAAe,EAAKF,EAC9CpB,EAAM,MAAM,WAAasB,GAAmBrB,EAE5C,KAAM,CAAE,iBAAAsB,EAAkB,cAAAN,CAAe,EAAGT,EAAsC,EAElFR,EAAM,UAAY;AAAA,gEAC0CI,EAAM,WAAW;AAAA;AAAA;AAAA,gBAGjEmB,EAAiB,IAAKR,GAAU,2CAA2CA,EAAM,cAAc,SAAS,EAAE,SAAS,QAAQ,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,IAKjJC,EAAkBC,CAAa,CACnC,CAEEE,EAAQ,EAER,OAAO,iBAAiB,SAAUK,EAASL,EAAQ,GAAG,CAAC,CACzD"}