{"version":3,"file":"marquee.js","sources":["../../../src/blocks/marquee/marquee.js"],"sourcesContent":["import { debounce } from '@repobit/dex-utils';\nimport { getDatasetFromSection, isView } from '../../scripts/utils/utils.js';\n\nexport default async function decorate(block) {\n  const defaultBackgroundColor = '#004299';\n  const SLIDE_SIZE_ENUM = {\n    MOBILE: 85 + 20 * 2,\n    TABLET_UP: 85 + 20 * 2,\n  };\n\n  const SPEED_ANIMATION = 0.6;\n\n  const [title, ...initialSlideList] = [...block.children];\n\n  function getCurrentViewportSlideSize() {\n    return isView('mobile') ? SLIDE_SIZE_ENUM.MOBILE : SLIDE_SIZE_ENUM.TABLET_UP;\n  }\n  function calculateSlideListBasedOnScreenWidth() {\n    const result = {\n      duplicatedSlides: null,\n      slidesToShift: null,\n    };\n\n    const currentViewportSlideSize = getCurrentViewportSlideSize();\n    const clientWidth = window.innerWidth;\n    const spaceToFillMore = clientWidth - initialSlideList.length * currentViewportSlideSize; // ok\n    if (spaceToFillMore < 0) {\n      result.duplicatedSlides = initialSlideList.concat(initialSlideList);\n      result.slidesToShift = initialSlideList.length;\n\n      return result;\n    }\n    // fill space\n    const fullWidthSlidesToFill = parseInt(spaceToFillMore / currentViewportSlideSize, 10);\n    const hasPartialSlideToFill = clientWidth % currentViewportSlideSize !== 0;\n\n    result.duplicatedSlides = Array(fullWidthSlidesToFill)\n      .fill(initialSlideList).flatMap((slide) => slide);\n\n    if (!hasPartialSlideToFill) {\n      result.duplicatedSlides = result.duplicatedSlides.concat(result.duplicatedSlides);\n      result.slidesToShift = result.duplicatedSlides.length;\n\n      return result;\n    }\n\n    // need to apply the patch here\n    result.duplicatedSlides = result.duplicatedSlides.concat(initialSlideList);\n    result.slidesToShift = result.duplicatedSlides.length;\n    result.duplicatedSlides = result.duplicatedSlides.concat(result.duplicatedSlides);\n\n    return result;\n  }\n\n  function updateTranslation(slidesToShift) {\n    const content = block.querySelector('.marquee-content');\n    content.style.animationDuration = `${slidesToShift / SPEED_ANIMATION}s`;\n    content.style.setProperty('--translateX', `${getCurrentViewportSlideSize() * slidesToShift}px`);\n  }\n\n  function render() {\n    const blockDataset = getDatasetFromSection(block);\n    const { background_color: backgroundColor } = blockDataset;\n    block.style.background = backgroundColor || defaultBackgroundColor;\n\n    const { duplicatedSlides, slidesToShift } = calculateSlideListBasedOnScreenWidth();\n\n    block.innerHTML = `\n      <div class=\"default-content-wrapper\"><div class=\"title\">${title.textContent}</div></div>\n      <div class=\"outer-wrapper\">\n          <div class=\"marquee-content\">\n              ${duplicatedSlides.map((slide) => `<div class=\"marquee-item img-container\">${slide.querySelector('picture').outerHTML}</div>`).join('')}\n          </div>\n      </div>\n  `;\n\n    updateTranslation(slidesToShift);\n  }\n\n  render();\n\n  window.addEventListener('resize', debounce(render, 250));\n}\n"],"names":[],"mappings":"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"}