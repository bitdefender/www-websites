{"version":3,"file":"columns.js","sources":["../../../src/blocks/columns/columns.js"],"sourcesContent":["import { debounce } from '@repobit/dex-utils';\nimport { matchHeights, createTag } from '../../scripts/utils/utils.js';\n\nfunction getItemsToShow() {\n  const width = window.innerWidth;\n  return width <= 767 ? 1 : 3; // 1 item for mobile, 2 for tablet, 3 for desktop\n}\n\nfunction countSlides(carouselContent) {\n  return Math.ceil(carouselContent.children.length / getItemsToShow());\n}\n\nfunction showSlides(carousel, slideNumber) {\n  const carouselContent = carousel.querySelector('.columns.carousel > div:first-child');\n  const itemsToShow = getItemsToShow();\n  const translateXValue = -(carousel.clientWidth * slideNumber) / itemsToShow;\n\n  carouselContent.style.transform = `translateX(${translateXValue}px)`;\n  carouselContent.style.transition = 'transform 0.5s ease';\n}\n\nfunction hideExcessElements(carousel) {\n  showSlides(carousel, 0); // Always show the first set initially\n}\n\nfunction setActiveButton(button, buttonsWrapper) {\n  buttonsWrapper.querySelector('.active-button')?.classList.remove('active-button');\n  button.classList.add('active-button');\n}\n\nfunction createNavigationButtons(numberOfSlides, carousel) {\n  const buttonsWrapper = document.createElement('div');\n  buttonsWrapper.className = 'carousel-buttons';\n\n  Array.from({ length: numberOfSlides }, (_, i) => {\n    const button = document.createElement('button');\n    button.setAttribute('aria-label', `Slide ${i + 1}`);\n    button.addEventListener('click', () => {\n      if (!button.classList.contains('active-button')) {\n        showSlides(carousel, i);\n        setActiveButton(button, buttonsWrapper);\n      }\n    });\n    buttonsWrapper.appendChild(button);\n    return button;\n  });\n\n  buttonsWrapper.firstChild?.classList.add('active-button'); // Set first button as active\n  return buttonsWrapper;\n}\n\nfunction setupCarousel(carousel, resetSlidePosition = false) {\n  const carouselContent = carousel.querySelector('.columns.carousel > div');\n  if (resetSlidePosition) carouselContent.style.transform = 'translateX(0px)';\n\n  const buttonsWrapper = createNavigationButtons(countSlides(carouselContent), carousel);\n  carousel.querySelector('.carousel-buttons')?.remove(); // Remove existing buttons\n  carousel.appendChild(buttonsWrapper);\n  hideExcessElements(carousel);\n}\n\nfunction setImageAsBackgroundImage() {\n  const columns = document.querySelectorAll('.columns.text-over-image > div > div');\n\n  columns.forEach((column) => {\n    const image = column.querySelector('img');\n\n    if (image) {\n      const src = image.getAttribute('src');\n\n      column.style.backgroundImage = `url(${src})`;\n\n      // remove the p tag that contains the picture element\n      const pContainer = image.closest('p');\n      if (pContainer) {\n        pContainer.remove();\n      }\n    }\n  });\n}\n\nexport default function decorate(block) {\n  const {\n    linksOpenInNewTab, type, maxElementsInColumn, products, breadcrumbs, aliases,\n  } = block.closest('.section').dataset;\n  const cols = [...block.firstElementChild.children];\n  block.classList.add(`columns-${cols.length}-cols`);\n\n  // setup image columns\n  [...block.children].forEach((row) => {\n    [...row.children].forEach((col) => {\n      const pic = col.querySelector('picture');\n      if (pic) {\n        const picWrapper = pic.closest('div');\n        if (picWrapper && picWrapper.children.length === 1) {\n          // picture is only content in column\n          picWrapper.classList.add('columns-img-col');\n        }\n      } else {\n        const children = [...row.children];\n\n        if (children.length === 1) {\n          col.closest('div').classList.add('columns-title-col');\n        } else {\n          const firstParentIndex = children.indexOf(col.closest('div'));\n\n          col.closest('div').classList.add('columns-text-col');\n          if (firstParentIndex) {\n            col.closest('div').classList.add('columns-right-col');\n          } else {\n            col.closest('div').classList.add('columns-left-col');\n          }\n        }\n      }\n    });\n  });\n\n  if (breadcrumbs && block.classList.contains('creators-banner')) {\n    const breadcrumb = createTag('div', { class: 'breadcrumb' });\n    block.querySelector('.columns-left-col')?.prepend(breadcrumb);\n  }\n\n  // setup buylink, this can be used later as a starting point for prices.\n  const productsAsList = products?.split(',');\n  if (productsAsList) {\n    // eslint-disable-next-line no-unused-vars\n    [...block.children].forEach((row, rowNumber) => {\n      [...row.children].forEach((col, colNumber) => {\n        const [prodName, prodYears, prodUsers] = productsAsList[colNumber].trim().split('/');\n        col.setAttribute('data-store-context', '');\n        col.setAttribute('data-store-id', prodName);\n        col.setAttribute('data-store-option', `${prodUsers}-${prodYears}`);\n        col.setAttribute('data-store-department', 'consumer');\n        col.querySelector('a[href*=\"#buylink\"]')?.setAttribute('data-store-buy-link', '');\n      });\n    });\n  }\n\n  // setup data-store-id on mobal buttons\n  aliases?.split(',').forEach((alias, i) => {\n    [...block.children].forEach((row) => {\n      row.children[i]\n        ?.querySelector('a.button.modal')\n        ?.setAttribute('data-store-id', alias.trim());\n    });\n  });\n\n  if (linksOpenInNewTab === 'true') {\n    block.querySelectorAll('.button-container > a').forEach((anchorEl) => {\n      anchorEl.target = '_blank';\n      anchorEl.rel = 'noopener noreferrer';\n    });\n  }\n\n  if (block.classList.contains('text-over-image')) {\n    setImageAsBackgroundImage();\n  }\n\n  // If it has the carousel class, then setup the carousel\n  if (block.classList.contains('carousel')) {\n    setupCarousel(block);\n  }\n\n  window.addEventListener('resize', debounce(() => {\n    // Check if the block still has the carousel class before resetting\n    if (block.classList.contains('carousel')) {\n      setupCarousel(block, true); // Pass true to reset the slide position\n    }\n  }, 250));\n  window.dispatchEvent(new Event('resize')); // trigger resize to give width to columns\n\n  const sectionDiv = document.querySelector('.columns-container[data-bg-image]');\n  if (sectionDiv) {\n    const bgImageUrl = sectionDiv.getAttribute('data-bg-image');\n    if (bgImageUrl) {\n      sectionDiv.style.setProperty('--bg-image-url', `url(${bgImageUrl})`);\n    }\n  }\n\n  if (type && type === 'video_left') {\n    block.closest('.section').classList.add('video-left');\n    const leftCol = block.querySelector('.columns-img-col');\n    const videoPath = leftCol.querySelector('tr:last-of-type').innerText.trim();\n    const videoImg = leftCol.querySelector('img').getAttribute('src');\n\n    leftCol.innerHTML = `<video data-type=\"dam\" data-video=\"\" src=\"${videoPath}\" disableremoteplayback=\"\" playsinline=\"\" controls=\"\" poster=\"${videoImg}\"></video>`;\n  }\n\n  const chatOptions = document.querySelector('.chat-options');\n  if (chatOptions) {\n    const cardButtons = chatOptions.querySelectorAll('.button-container');\n    cardButtons.forEach((button) => {\n      button.previousElementSibling.classList.add('chat-options-text');\n    });\n    matchHeights(chatOptions, '.chat-options-text');\n    matchHeights(chatOptions, 'table');\n  }\n  block.querySelectorAll('h3')?.forEach((element) => {\n    if (element.textContent.includes('{GLOBAL_BIGGEST_DISCOUNT_PERCENTAGE}')) {\n      element.classList.add('await-loader');\n    }\n  });\n\n  // this will define the number of rows inside each card of the subgrid system\n  // by dynamically setting this, i can set howewer much rows i want based on the number of\n  // maximum elements expected in the row\n  if (block.closest('.section').classList.contains('v-5') && maxElementsInColumn) {\n    block.querySelectorAll('.columns-text-col')?.forEach((element) => {\n      element.style['grid-row'] = `span ${maxElementsInColumn}`;\n    });\n  }\n\n  matchHeights(block, 'h3');\n  matchHeights(block, 'h4');\n  if (block.closest('.section').classList.contains('multi-blocks')) {\n    matchHeights(block.closest('.section'), '.columns');\n    matchHeights(block.closest('.section'), 'table');\n    matchHeights(block.closest('.section'), 'p:nth-last-of-type(2)');\n    matchHeights(block.closest('.section'), '.columns > div');\n  }\n  if (block.classList.contains('awards-fragment')) {\n    matchHeights(block, 'p:last-of-type');\n  }\n}\n"],"names":["getItemsToShow","countSlides","carouselContent","showSlides","carousel","slideNumber","itemsToShow","translateXValue","hideExcessElements","setActiveButton","button","buttonsWrapper","createNavigationButtons","numberOfSlides","_","i","setupCarousel","resetSlidePosition","setImageAsBackgroundImage","column","image","src","pContainer","decorate","block","linksOpenInNewTab","type","maxElementsInColumn","products","breadcrumbs","aliases","cols","row","col","pic","picWrapper","children","firstParentIndex","breadcrumb","createTag","productsAsList","rowNumber","colNumber","prodName","prodYears","prodUsers","alias","anchorEl","debounce","sectionDiv","bgImageUrl","leftCol","videoPath","videoImg","chatOptions","matchHeights","element"],"mappings":"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"}