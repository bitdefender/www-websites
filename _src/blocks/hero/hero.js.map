{"version":3,"file":"hero.js","sources":["../../../src/blocks/hero/hero.js"],"sourcesContent":["/* eslint-disable max-len */\n// Description: Hero block\nimport { UserAgent } from '@repobit/dex-utils';\nimport {\n  createTag,\n  createNanoBlock,\n  renderNanoBlocks,\n  getBrowserName,\n} from '../../scripts/utils/utils.js';\n\nfunction detectAndRenderOSContent(osLinkMapping, androidTemplate, iosTemplate, block) {\n  const button = block.querySelector('a.button');\n  const dynamicTextElement = button.parentNode.nextElementSibling;\n  switch (UserAgent.os) {\n    case 'android':\n      button.classList.add('android');\n      button.href = osLinkMapping.android.googlePlay;\n      dynamicTextElement.querySelectorAll('a').forEach((anchor, index) => {\n        anchor.textContent = osLinkMapping[androidTemplate.split(',')[index].trim()].text;\n        anchor.href = osLinkMapping[androidTemplate.split(',')[index].trim()].link;\n      });\n      break;\n    case 'ios':\n      button.classList.add('ios');\n      button.href = osLinkMapping.ios.appStore;\n      dynamicTextElement.querySelectorAll('a').forEach((anchor, index) => {\n        anchor.textContent = osLinkMapping[iosTemplate.split(',')[index].trim()].text;\n        anchor.href = osLinkMapping[iosTemplate.split(',')[index].trim()].link;\n      });\n      break;\n    default:\n      break;\n  }\n}\n\n/**\n * Builds hero block and prepends to main in a new section.\n * @param {Element} element The container element\n */\nfunction buildHeroBlock(element) {\n  const h1 = element.querySelector('h1');\n  const picture = element.querySelector('picture');\n  const pictureParent = picture ? picture.parentNode : false;\n  // eslint-disable-next-line no-bitwise\n  if (h1 && picture && (h1.compareDocumentPosition(picture) & Node.DOCUMENT_POSITION_PRECEDING)) {\n    const section = document.querySelector('div.hero');\n    const subSection = document.querySelector('div.hero div');\n    subSection.classList.add('hero-content');\n\n    const isHomePage = window.location.pathname.split('/').filter((item) => item).length === 1;\n\n    if (!isHomePage) {\n      const breadcrumb = createTag('div', { class: 'breadcrumb' });\n      document.querySelector('div.hero div div:first-child').prepend(breadcrumb);\n    }\n\n    const pictureEl = document.createElement('div');\n    pictureEl.classList.add('hero-picture');\n    pictureEl.append(picture);\n    section.prepend(pictureEl);\n\n    pictureParent.remove();\n  }\n}\n\ncreateNanoBlock('discount', (code, label = '{label}') => {\n  // code = \"av/3/1\"\n  const [product, unit, year] = code.split('/');\n\n  const root = document.createElement('div');\n  root.classList.add('discount-bubble');\n  root.classList.add('await-loader');\n\n  // Add the required attributes to the root element\n\n  root.setAttribute('data-store-context', '');\n  root.setAttribute('data-store-id', product);\n  root.setAttribute('data-store-option', `${unit}-${year}`);\n  root.setAttribute('data-store-department', 'consumer');\n  root.setAttribute('data-store-event', 'main-product-loaded');\n  root.setAttribute('data-store-hide', 'no-price=discounted;type=visibility');\n  root.innerHTML = `\n    <span class=\"discount-bubble-0\" data-store-discount=\"percentage\">--%</span>\n    <span class=\"discount-bubble-1\">${label}</span>\n  `;\n\n  return root;\n});\n\nasync function renderBubble(block) {\n  await renderNanoBlocks(block);\n  const bubble = block?.querySelector('.discount-bubble');\n  if (bubble) {\n    const { label } = block.closest('.section').dataset;\n    if (label) {\n      bubble.innerHTML = bubble.innerHTML.replace('{label}', label);\n    }\n\n    let sibling = bubble.previousElementSibling;\n\n    while (sibling) {\n      if (sibling.matches('.button-container')) {\n        sibling.append(bubble);\n        break;\n      }\n      sibling = sibling.previousElementSibling;\n    }\n  }\n}\n\n/**\n * decorates hero block\n * @param {Element} block The hero block element\n */\nexport default function decorate(block) {\n  const parentSection = block.closest('.section');\n  const {\n    // this defines wether the modals automatically refresh or not in the hero banner\n    stopAutomaticModalRefresh,\n    signature,\n    percentProduct,\n    firefoxUrl,\n    buttonImage,\n    iosLink,\n    androidLink,\n    windowsLink,\n    macLink,\n    androidTemplate,\n    iosTemplate,\n    appStoreLink,\n    googlePlayLink,\n    backgroundcolor,\n    textcolor,\n  } = parentSection.dataset;\n\n  buildHeroBlock(block);\n  renderBubble(block);\n  if (androidLink && iosLink) {\n    const osLinkMapping = {\n      android: {\n        link: androidLink,\n        googlePlay: googlePlayLink,\n        text: 'Android',\n      },\n      ios: {\n        link: iosLink,\n        appStore: appStoreLink,\n        text: 'iOS',\n      },\n      windows: {\n        link: windowsLink,\n        text: 'Windows',\n      },\n      mac: {\n        link: macLink,\n        text: 'macOS',\n      },\n    };\n    detectAndRenderOSContent(osLinkMapping, androidTemplate, iosTemplate, block);\n  }\n  // Eager load images to improve LCP\n  [...block.querySelectorAll('img')].forEach((el) => el.setAttribute('loading', 'eager'));\n\n  if (backgroundcolor) {\n    parentSection.style.backgroundColor = backgroundcolor;\n    block.style.backgroundColor = backgroundcolor;\n  }\n\n  // get div class hero-content\n  const elementHeroContent = block.querySelector('.hero div.hero-content div');\n  if (elementHeroContent !== null) {\n    // Select  <ul> elements that contain a <picture> tag\n    const ulsWithPicture = Array.from(document.querySelectorAll('ul')).filter((ul) => ul.querySelector('picture'));\n\n    // Apply a CSS class to each selected <ul> element\n    ulsWithPicture.forEach((ul) => ul.classList.add('hero-awards'));\n\n    // add signature to the top of the banner\n    if (signature) {\n      const signatureElement = createTag('div', { class: 'signature' });\n      signatureElement.textContent = signature;\n      document.querySelector('div.hero div div:first-child').prepend(signatureElement);\n    }\n\n    if (textcolor) {\n      block.querySelectorAll('.hero-content > div, .hero-content > div *').forEach((el) => {\n        el.style.color = textcolor;\n      });\n    }\n\n    // set the modal buttons in the hero banner to not refresh the modal on click\n    if (stopAutomaticModalRefresh === 'true') {\n      block.querySelectorAll('a.modal.button').forEach((modalButton) => {\n        modalButton.setAttribute('data-stop-automatic-modal-refresh', true);\n      });\n    }\n\n    if (buttonImage) {\n      const buttonImageEl = document.createElement('img');\n      buttonImageEl.setAttribute('src', buttonImage);\n      const heroBtn = block.querySelector('a');\n      heroBtn.insertAdjacentElement('afterbegin', buttonImageEl);\n    }\n  }\n\n  // make discount dynamic\n  if (percentProduct) {\n    const [alias, variant] = percentProduct.split(',');\n    block.setAttribute('data-store-context', '');\n    block.setAttribute('data-store-text-variable', '');\n    block.setAttribute('data-store-id', alias);\n    block.setAttribute('data-store-department', 'consumer');\n    block.setAttribute('data-store-option', variant);\n    block.querySelector('div').classList.add('await-loader');\n  }\n\n  // Add the await-loader class to the button that leads to the thank you page, this is an exception\n  // for the free antivirus page\n  if (block.querySelector('.button-container a[href*=\"/consumer/thank-you\"]')) {\n    block.querySelector('.button-container a[href*=\"/consumer/thank-you\"]').classList.add('await-loader');\n  }\n\n  if (firefoxUrl && getBrowserName() === 'Firefox') {\n    block.querySelector('a').href = firefoxUrl;\n  }\n}\n"],"names":[],"mappings":"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"}