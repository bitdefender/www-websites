{"version":3,"file":"hero.js","sources":["../../../src/blocks/hero/hero.js"],"sourcesContent":["/* eslint-disable max-len */\n// Description: Hero block\nimport { UserAgent } from '@repobit/dex-utils';\nimport {\n  createTag,\n  createNanoBlock,\n  renderNanoBlocks,\n  getBrowserName,\n} from '../../scripts/utils/utils.js';\n\nfunction detectAndRenderOSContent(osLinkMapping, androidTemplate, iosTemplate, block) {\n  const button = block.querySelector('a.button');\n  const dynamicTextElement = button.parentNode.nextElementSibling;\n  switch (UserAgent.os) {\n    case 'android':\n      button.classList.add('android');\n      button.href = osLinkMapping.android.googlePlay;\n      dynamicTextElement.querySelectorAll('a').forEach((anchor, index) => {\n        anchor.textContent = osLinkMapping[androidTemplate.split(',')[index].trim()].text;\n        anchor.href = osLinkMapping[androidTemplate.split(',')[index].trim()].link;\n      });\n      break;\n    case 'ios':\n      button.classList.add('ios');\n      button.href = osLinkMapping.ios.appStore;\n      dynamicTextElement.querySelectorAll('a').forEach((anchor, index) => {\n        anchor.textContent = osLinkMapping[iosTemplate.split(',')[index].trim()].text;\n        anchor.href = osLinkMapping[iosTemplate.split(',')[index].trim()].link;\n      });\n      break;\n    default:\n      break;\n  }\n}\n\n/**\n * Builds hero block and prepends to main in a new section.\n * @param {Element} element The container element\n */\nfunction buildHeroBlock(element) {\n  const h1 = element.querySelector('h1');\n  const picture = element.querySelector('picture');\n  const pictureParent = picture ? picture.parentNode : false;\n  // eslint-disable-next-line no-bitwise\n  if (h1 && picture && (h1.compareDocumentPosition(picture) & Node.DOCUMENT_POSITION_PRECEDING)) {\n    const section = document.querySelector('div.hero');\n    const subSection = document.querySelector('div.hero div');\n    subSection.classList.add('hero-content');\n\n    const isHomePage = window.location.pathname.split('/').filter((item) => item).length === 1;\n\n    if (!isHomePage) {\n      const breadcrumb = createTag('div', { class: 'breadcrumb' });\n      document.querySelector('div.hero div div:first-child').prepend(breadcrumb);\n    }\n\n    const pictureEl = document.createElement('div');\n    pictureEl.classList.add('hero-picture');\n    pictureEl.append(picture);\n    section.prepend(pictureEl);\n\n    pictureParent.remove();\n  }\n}\n\ncreateNanoBlock('discount', (code, label = '{label}') => {\n  // code = \"av/3/1\"\n  const [product, unit, year] = code.split('/');\n\n  const root = document.createElement('div');\n  root.classList.add('discount-bubble');\n  root.classList.add('await-loader');\n\n  // Add the required attributes to the root element\n\n  root.setAttribute('data-store-context', '');\n  root.setAttribute('data-store-id', product);\n  root.setAttribute('data-store-option', `${unit}-${year}`);\n  root.setAttribute('data-store-department', 'consumer');\n  root.setAttribute('data-store-event', 'main-product-loaded');\n  root.setAttribute('data-store-hide', 'no-price=discounted;type=visibility');\n  root.innerHTML = `\n    <span class=\"discount-bubble-0\" data-store-discount=\"percentage\">--%</span>\n    <span class=\"discount-bubble-1\">${label}</span>\n  `;\n\n  return root;\n});\n\nasync function renderBubble(block) {\n  await renderNanoBlocks(block);\n  const bubble = block?.querySelector('.discount-bubble');\n  if (bubble) {\n    const { label } = block.closest('.section').dataset;\n    if (label) {\n      bubble.innerHTML = bubble.innerHTML.replace('{label}', label);\n    }\n\n    let sibling = bubble.previousElementSibling;\n\n    while (sibling) {\n      if (sibling.matches('.button-container')) {\n        sibling.append(bubble);\n        break;\n      }\n      sibling = sibling.previousElementSibling;\n    }\n  }\n}\n\n/**\n * decorates hero block\n * @param {Element} block The hero block element\n */\nexport default function decorate(block) {\n  const parentSection = block.closest('.section');\n  const {\n    // this defines wether the modals automatically refresh or not in the hero banner\n    stopAutomaticModalRefresh,\n    signature,\n    percentProduct,\n    firefoxUrl,\n    buttonImage,\n    iosLink,\n    androidLink,\n    windowsLink,\n    macLink,\n    androidTemplate,\n    iosTemplate,\n    appStoreLink,\n    googlePlayLink,\n    backgroundcolor,\n    textcolor,\n  } = parentSection.dataset;\n\n  buildHeroBlock(block);\n  renderBubble(block);\n  if (androidLink && iosLink) {\n    const osLinkMapping = {\n      android: {\n        link: androidLink,\n        googlePlay: googlePlayLink,\n        text: 'Android',\n      },\n      ios: {\n        link: iosLink,\n        appStore: appStoreLink,\n        text: 'iOS',\n      },\n      windows: {\n        link: windowsLink,\n        text: 'Windows',\n      },\n      mac: {\n        link: macLink,\n        text: 'macOS',\n      },\n    };\n    detectAndRenderOSContent(osLinkMapping, androidTemplate, iosTemplate, block);\n  }\n  // Eager load images to improve LCP\n  [...block.querySelectorAll('img')].forEach((el) => el.setAttribute('loading', 'eager'));\n\n  if (backgroundcolor) {\n    parentSection.style.backgroundColor = backgroundcolor;\n    block.style.backgroundColor = backgroundcolor;\n  }\n\n  // get div class hero-content\n  const elementHeroContent = block.querySelector('.hero div.hero-content div');\n  if (elementHeroContent !== null) {\n    // Select  <ul> elements that contain a <picture> tag\n    const ulsWithPicture = Array.from(document.querySelectorAll('ul')).filter((ul) => ul.querySelector('picture'));\n\n    // Apply a CSS class to each selected <ul> element\n    ulsWithPicture.forEach((ul) => ul.classList.add('hero-awards'));\n\n    // add signature to the top of the banner\n    if (signature) {\n      const signatureElement = createTag('div', { class: 'signature' });\n      signatureElement.textContent = signature;\n      document.querySelector('div.hero div div:first-child').prepend(signatureElement);\n    }\n\n    if (textcolor) {\n      block.querySelectorAll('.hero-content > div, .hero-content > div *').forEach((el) => {\n        el.style.color = textcolor;\n      });\n    }\n\n    // set the modal buttons in the hero banner to not refresh the modal on click\n    if (stopAutomaticModalRefresh === 'true') {\n      block.querySelectorAll('a.modal.button').forEach((modalButton) => {\n        modalButton.setAttribute('data-stop-automatic-modal-refresh', true);\n      });\n    }\n\n    if (buttonImage) {\n      const buttonImageEl = document.createElement('img');\n      buttonImageEl.setAttribute('src', buttonImage);\n      const heroBtn = block.querySelector('a');\n      heroBtn.insertAdjacentElement('afterbegin', buttonImageEl);\n    }\n  }\n\n  // make discount dynamic\n  if (percentProduct) {\n    const [alias, variant] = percentProduct.split(',');\n    block.setAttribute('data-store-context', '');\n    block.setAttribute('data-store-text-variable', '');\n    block.setAttribute('data-store-id', alias);\n    block.setAttribute('data-store-department', 'consumer');\n    block.setAttribute('data-store-option', variant);\n    block.querySelector('div').classList.add('await-loader');\n  }\n\n  // Add the await-loader class to the button that leads to the thank you page, this is an exception\n  // for the free antivirus page\n  if (block.querySelector('.button-container a[href*=\"/consumer/thank-you\"]')) {\n    block.querySelector('.button-container a[href*=\"/consumer/thank-you\"]').classList.add('await-loader');\n  }\n\n  if (firefoxUrl && getBrowserName() === 'Firefox') {\n    block.querySelector('a').href = firefoxUrl;\n  }\n}\n"],"names":["detectAndRenderOSContent","osLinkMapping","androidTemplate","iosTemplate","block","button","dynamicTextElement","UserAgent","anchor","index","buildHeroBlock","element","h1","picture","pictureParent","section","item","breadcrumb","createTag","pictureEl","createNanoBlock","code","label","product","unit","year","root","renderBubble","renderNanoBlocks","bubble","sibling","decorate","parentSection","stopAutomaticModalRefresh","signature","percentProduct","firefoxUrl","buttonImage","iosLink","androidLink","windowsLink","macLink","appStoreLink","googlePlayLink","backgroundcolor","textcolor","el","ul","signatureElement","modalButton","buttonImageEl","alias","variant","getBrowserName"],"mappings":"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"}