import{AdobeDataLayerService as u}from"../../vendor/repobit/dex-data-layer/dist/src/adobe-data-layer-service/index.js";import"../../vendor/repobit/dex-utils/dist/src/index.js";import{WindowLoadStartedEvent as w}from"../../vendor/repobit/dex-data-layer/dist/src/events/window-load-started-event/index.js";import{target as g}from"../../scripts/target.js";import{decorateMain as d,detectModalButtons as p}from"../../scripts/scripts.js";import{loadBlocks as f,getMetadata as h}from"../../scripts/lib-franklin.js";import i from"../../scripts/page.js";function P(e){const t=document.createElement("div");return t.innerHTML=e,d(t),p(t),t}function v(){const e={},t=new URLSearchParams(window.location.search),n=t.get("feature"),a=t.get("lang");return t.forEach(o=>{o===n&&(e.feature=n.replaceAll("_","-")),o===a&&(e.lang=a.toLocaleLowerCase())}),e}function L(e){const t={};return Object.entries(e).forEach(([n,a])=>{t[`profile.${n}`]=a}),t}async function b(e){const t=e.offer.match(/\/([^/]+)\.plain\.html$/),n=t?t[1]:null;let a=h("cid");a=a.replace("<language>",i.getParamValue("lang")),a=a.replace("<asset name>",i.getParamValue("feature"));const o=new w(r=>(r.name=r.name.replace("<dynamic-content>",n),r.language=i.getParamValue("lang")||"en-us",r),{trackingID:a});Object.entries(o.page.info).forEach(([r,c])=>{c==="<dynamic-content>"&&(o.page.info[r]=n)}),u.push(o)}async function T(e){const{mboxName:t}=e.closest(".section").dataset,n=v();e.innerHTML+=`
    <div class="canvas-content">

    </div>
  `,e.classList.add("loader-circle");const a=await g.getOffers({mboxNames:t,parameters:n,profileParameters:L(n)}),o=await fetch(`${a.offer}`);let r;if(await f(e.querySelector(".canvas-content")),o.ok)r=await o.text();else{const m=new URLSearchParams(window.location.search).get("lang")?.toLowerCase()||"en-us";let s=await fetch(`/${m}/consumer/webview/webview-table.plain.html`);s.ok?r=await s.text():(s=await fetch("/en-us/consumer/webview/webview-table.plain.html"),r=await s.text())}const c=P(r);b(a),c.querySelectorAll('a[href*="#buylink"]').forEach(l=>{l.setAttribute("target","_blank")}),e.querySelector(".canvas-content").innerHTML=c.innerHTML,await f(e.querySelector(".canvas-content"))}export{T as default};
//# sourceMappingURL=mbox-canvas.js.map
