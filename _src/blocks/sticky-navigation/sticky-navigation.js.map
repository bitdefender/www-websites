{"version":3,"file":"sticky-navigation.js","sources":["../../../src/blocks/sticky-navigation/sticky-navigation.js"],"sourcesContent":["import { STICKY_NAVIGATION_DATASET_KEY } from '../../scripts/lib-franklin.js';\n\nfunction scrollToAnchorWithOffset(anchorId) {\n  const anchorElement = document.getElementById(anchorId);\n\n  if (anchorElement) {\n    const offsetPosition = anchorElement.getBoundingClientRect().top + window.scrollY - 80;\n\n    window.scrollTo({\n      top: offsetPosition,\n      behavior: 'smooth',\n    });\n  }\n}\n\nfunction renderMobileDropDown() {\n  const mobileDropDown = document.createElement('div');\n  mobileDropDown.className = 'mobile-dropdown';\n\n  /* listen to click event to open or close the dropdown menu on mobile */\n  mobileDropDown.addEventListener('click', (e) => {\n    e.preventDefault();\n    mobileDropDown.classList.toggle('opened');\n  });\n\n  return mobileDropDown;\n}\n\nfunction renderStickyNavMenuItem(section) {\n  if (!section.id) return null;\n\n  const sectionTitle = section.dataset[STICKY_NAVIGATION_DATASET_KEY];\n  if (!sectionTitle) return null; // Nu creează nimic dacă nu există titlu\n\n  const navMenuItem = document.createElement('li');\n  const navItemLink = document.createElement('a');\n  navItemLink.href = `#${section.id}`;\n  navItemLink.title = sectionTitle;\n  navItemLink.innerText = sectionTitle;\n  navMenuItem.appendChild(navItemLink);\n\n  /** close the dropdown menu after user selection */\n  navMenuItem.addEventListener('click', (e) => {\n    e.preventDefault();\n    scrollToAnchorWithOffset(section.id);\n  });\n\n  return navMenuItem;\n}\n\nfunction renderStickyNavMenu() {\n  const stickyNavMenu = document.createElement('ul');\n  const stickyNavMenuItems = Array.from(document.querySelectorAll('.section[id]')).map(renderStickyNavMenuItem).filter(Boolean);\n  stickyNavMenu.append(...stickyNavMenuItems);\n  return stickyNavMenu;\n}\n\nfunction renderStickyNavigation(block) {\n  const menuWithButton = document.createElement('div');\n  menuWithButton.classList.add('menu-with-button');\n\n  const mobileDropDown = renderMobileDropDown();\n\n  const stickyNavMenu = renderStickyNavMenu();\n  menuWithButton.appendChild(stickyNavMenu);\n\n  /** close the dropdown menu after user selection */\n  stickyNavMenu.addEventListener('click', (event) => {\n    event.target.closest('ul').querySelectorAll('li').forEach((item) => {\n      item.classList.remove('opened');\n    });\n    event.target.closest('li').classList.toggle('opened');\n    mobileDropDown.classList.toggle('opened');\n  });\n\n  mobileDropDown.innerText = stickyNavMenu.querySelector('li').innerText;\n\n  const stickyNavButton = block.querySelector('.button-container');\n  if (stickyNavButton) {\n    stickyNavButton.addEventListener('click', () => {\n      window.adobeDataLayer.push(\n        {\n          event: 'click',\n          asset: 'sticky-buy',\n        },\n      );\n    });\n    menuWithButton.appendChild(stickyNavButton);\n  }\n  block.replaceChildren(mobileDropDown);\n  block.appendChild(menuWithButton);\n  return block;\n}\n\nfunction stickNavigationOnTop(stickyNav) {\n  const wrapperTop = document.querySelector('.sticky-navigation-container')?.offsetTop;\n  if (wrapperTop) {\n    if (window.scrollY >= wrapperTop) {\n      stickyNav.classList.add('fixed-nav');\n    } else {\n      stickyNav.classList.remove('fixed-nav');\n    }\n  }\n}\n\nfunction findVisibleSection(sections) {\n  return Array.from(sections).reduce((visSection, curSection) => {\n    const curTop = curSection.getBoundingClientRect().top;\n    const curBottom = curSection.getBoundingClientRect().bottom;\n    // return current heading if at max 115px (magic number) from the top of the screen\n    if (curTop < 115 && curBottom > 0) {\n      return curSection;\n    }\n    return visSection;\n  }, null);\n}\n\nfunction updateStickyNavActiveMenuItem(stickyNav) {\n  // list all sections referenced in the sticky navigation\n  const sections = document.querySelectorAll('.section[id]');\n\n  const mobileDropDown = stickyNav.querySelector('.mobile-dropdown');\n\n  // identify the visible section based on scroll position\n  const visibleSection = findVisibleSection(sections);\n\n  const previousActiveMenuEntry = stickyNav.querySelector('li.active');\n\n  if (visibleSection) {\n    const visibleActiveMenuEntryLink = stickyNav.querySelector(`li a[href=\"#${visibleSection.id}\"]`);\n\n    // the section is present in the sticky menu\n    if (visibleActiveMenuEntryLink) {\n      const visibleActiveMenuEntry = visibleActiveMenuEntryLink.parentElement;\n      visibleActiveMenuEntry.classList.add('active');\n      mobileDropDown.innerText = visibleActiveMenuEntry.innerText;\n\n      if (previousActiveMenuEntry && !previousActiveMenuEntry.isSameNode(visibleActiveMenuEntry)) {\n        previousActiveMenuEntry.classList.remove('active');\n      }\n    } else if (previousActiveMenuEntry) {\n      previousActiveMenuEntry.classList.remove('active');\n    }\n  } else if (previousActiveMenuEntry) {\n    previousActiveMenuEntry.classList.remove('active');\n  }\n}\n\nfunction onScroll(stickyNav) {\n  stickNavigationOnTop(stickyNav);\n  updateStickyNavActiveMenuItem(stickyNav);\n}\n\nexport default function decorate(block) {\n  const stickyNav = renderStickyNavigation(block);\n\n  // listen to scroll event to stick the nav on the top and update the current visible section\n  document.addEventListener('scroll', () => onScroll(stickyNav));\n}\n"],"names":["scrollToAnchorWithOffset","anchorId","anchorElement","offsetPosition","renderMobileDropDown","mobileDropDown","e","renderStickyNavMenuItem","section","sectionTitle","STICKY_NAVIGATION_DATASET_KEY","navMenuItem","navItemLink","renderStickyNavMenu","stickyNavMenu","stickyNavMenuItems","renderStickyNavigation","block","menuWithButton","event","item","stickyNavButton","stickNavigationOnTop","stickyNav","wrapperTop","findVisibleSection","sections","visSection","curSection","curTop","curBottom","updateStickyNavActiveMenuItem","visibleSection","previousActiveMenuEntry","visibleActiveMenuEntryLink","visibleActiveMenuEntry","onScroll","decorate"],"mappings":"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"}