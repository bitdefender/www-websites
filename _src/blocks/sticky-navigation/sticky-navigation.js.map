{"version":3,"file":"sticky-navigation.js","sources":["../../../src/blocks/sticky-navigation/sticky-navigation.js"],"sourcesContent":["import { STICKY_NAVIGATION_DATASET_KEY } from '../../scripts/lib-franklin.js';\n\nfunction scrollToAnchorWithOffset(anchorId) {\n  const anchorElement = document.getElementById(anchorId);\n\n  if (anchorElement) {\n    const offsetPosition = anchorElement.getBoundingClientRect().top + window.scrollY - 80;\n\n    window.scrollTo({\n      top: offsetPosition,\n      behavior: 'smooth',\n    });\n  }\n}\n\nfunction renderMobileDropDown() {\n  const mobileDropDown = document.createElement('div');\n  mobileDropDown.className = 'mobile-dropdown';\n\n  /* listen to click event to open or close the dropdown menu on mobile */\n  mobileDropDown.addEventListener('click', (e) => {\n    e.preventDefault();\n    mobileDropDown.classList.toggle('opened');\n  });\n\n  return mobileDropDown;\n}\n\nfunction renderStickyNavMenuItem(section) {\n  if (!section.id) return null;\n\n  const sectionTitle = section.dataset[STICKY_NAVIGATION_DATASET_KEY];\n  if (!sectionTitle) return null; // Nu creează nimic dacă nu există titlu\n\n  const navMenuItem = document.createElement('li');\n  const navItemLink = document.createElement('a');\n  navItemLink.href = `#${section.id}`;\n  navItemLink.title = sectionTitle;\n  navItemLink.innerText = sectionTitle;\n  navMenuItem.appendChild(navItemLink);\n\n  /** close the dropdown menu after user selection */\n  navMenuItem.addEventListener('click', (e) => {\n    e.preventDefault();\n    scrollToAnchorWithOffset(section.id);\n  });\n\n  return navMenuItem;\n}\n\nfunction renderStickyNavMenu() {\n  const stickyNavMenu = document.createElement('ul');\n  const stickyNavMenuItems = Array.from(document.querySelectorAll('.section[id]')).map(renderStickyNavMenuItem).filter(Boolean);\n  stickyNavMenu.append(...stickyNavMenuItems);\n  return stickyNavMenu;\n}\n\nfunction renderStickyNavigation(block) {\n  const menuWithButton = document.createElement('div');\n  menuWithButton.classList.add('menu-with-button');\n\n  const mobileDropDown = renderMobileDropDown();\n\n  const stickyNavMenu = renderStickyNavMenu();\n  menuWithButton.appendChild(stickyNavMenu);\n\n  /** close the dropdown menu after user selection */\n  stickyNavMenu.addEventListener('click', (event) => {\n    event.target.closest('ul').querySelectorAll('li').forEach((item) => {\n      item.classList.remove('opened');\n    });\n    event.target.closest('li').classList.toggle('opened');\n    mobileDropDown.classList.toggle('opened');\n  });\n\n  mobileDropDown.innerText = stickyNavMenu.querySelector('li').innerText;\n\n  const stickyNavButton = block.querySelector('.button-container');\n  if (stickyNavButton) {\n    stickyNavButton.addEventListener('click', () => {\n      window.adobeDataLayer.push(\n        {\n          event: 'click',\n          asset: 'sticky-buy',\n        },\n      );\n    });\n    menuWithButton.appendChild(stickyNavButton);\n  }\n  block.replaceChildren(mobileDropDown);\n  block.appendChild(menuWithButton);\n  return block;\n}\n\nfunction stickNavigationOnTop(stickyNav) {\n  const wrapperTop = document.querySelector('.sticky-navigation-container')?.offsetTop;\n  if (wrapperTop) {\n    if (window.scrollY >= wrapperTop) {\n      stickyNav.classList.add('fixed-nav');\n    } else {\n      stickyNav.classList.remove('fixed-nav');\n    }\n  }\n}\n\nfunction findVisibleSection(sections) {\n  return Array.from(sections).reduce((visSection, curSection) => {\n    const curTop = curSection.getBoundingClientRect().top;\n    const curBottom = curSection.getBoundingClientRect().bottom;\n    // return current heading if at max 115px (magic number) from the top of the screen\n    if (curTop < 115 && curBottom > 0) {\n      return curSection;\n    }\n    return visSection;\n  }, null);\n}\n\nfunction updateStickyNavActiveMenuItem(stickyNav) {\n  // list all sections referenced in the sticky navigation\n  const sections = document.querySelectorAll('.section[id]');\n\n  const mobileDropDown = stickyNav.querySelector('.mobile-dropdown');\n\n  // identify the visible section based on scroll position\n  const visibleSection = findVisibleSection(sections);\n\n  const previousActiveMenuEntry = stickyNav.querySelector('li.active');\n\n  if (visibleSection) {\n    const visibleActiveMenuEntryLink = stickyNav.querySelector(`li a[href=\"#${visibleSection.id}\"]`);\n\n    // the section is present in the sticky menu\n    if (visibleActiveMenuEntryLink) {\n      const visibleActiveMenuEntry = visibleActiveMenuEntryLink.parentElement;\n      visibleActiveMenuEntry.classList.add('active');\n      mobileDropDown.innerText = visibleActiveMenuEntry.innerText;\n\n      if (previousActiveMenuEntry && !previousActiveMenuEntry.isSameNode(visibleActiveMenuEntry)) {\n        previousActiveMenuEntry.classList.remove('active');\n      }\n    } else if (previousActiveMenuEntry) {\n      previousActiveMenuEntry.classList.remove('active');\n    }\n  } else if (previousActiveMenuEntry) {\n    previousActiveMenuEntry.classList.remove('active');\n  }\n}\n\nfunction onScroll(stickyNav) {\n  stickNavigationOnTop(stickyNav);\n  updateStickyNavActiveMenuItem(stickyNav);\n}\n\nexport default function decorate(block) {\n  const stickyNav = renderStickyNavigation(block);\n\n  // listen to scroll event to stick the nav on the top and update the current visible section\n  document.addEventListener('scroll', () => onScroll(stickyNav));\n}\n"],"names":[],"mappings":"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"}