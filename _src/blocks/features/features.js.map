{"version":3,"file":"features.js","sources":["../../../src/blocks/features/features.js"],"sourcesContent":["import { matchHeights } from '../../scripts/utils/utils.js';\n\nfunction expandItem(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  const transitionEndCallback = () => {\n    content.removeEventListener('transitionend', transitionEndCallback);\n    content.style.height = 'auto';\n  };\n  content.addEventListener('transitionend', transitionEndCallback);\n  content.classList.add('expanded');\n}\n\nfunction collapseItem(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  requestAnimationFrame(() => {\n    content.classList.remove('expanded');\n    content.style.height = 0;\n  });\n}\n\nfunction eventListener(ul) {\n  return (event) => {\n    let target = null;\n\n    // find ancestor a tag\n    if (event.target.tagName !== 'A') {\n      target = event.target.closest('a');\n    } else {\n      target = event.target;\n    }\n\n    // if the clicked node is not open then open it\n    if (!target.classList.contains('is-open')) {\n      target.classList.add('is-open');\n\n      // if the clicked node has children then toggle the expanded class\n      if (target.parentNode.children.length > 1) {\n        target.parentNode.querySelectorAll('.features-tabs-content').forEach((content) => {\n          expandItem(content);\n        });\n      }\n\n      // hid the other tabs\n      ul.querySelectorAll('li').forEach((collapsedLi) => {\n        if (collapsedLi !== target.parentNode) {\n          collapsedLi.children[0].classList.remove('is-open');\n          collapsedLi.querySelectorAll('.features-tabs-content').forEach((content) => {\n            collapseItem(content);\n          });\n        }\n      });\n    } else {\n      target.classList.remove('is-open');\n      // if the clicked node has children then toggle the expanded class\n      if (target.parentNode.children.length > 1) {\n        target.parentNode.querySelectorAll('.features-tabs-content').forEach((content) => {\n          collapseItem(content);\n        });\n      }\n    }\n  };\n}\n\nfunction extractFeatures(col) {\n  const ul = document.createElement('ul');\n  ul.classList.add('features-tabs');\n\n  // select all h4 tags as feature titles\n  col.querySelectorAll('h4').forEach((h4) => {\n    const li = document.createElement('li');\n    ul.appendChild(li);\n\n    const a = document.createElement('a');\n    a.setAttribute('href', '#');\n\n    // register click event on a tag\n\n    a.addEventListener('click', (event) => {\n      event.preventDefault();\n      eventListener(ul)(event);\n    });\n\n    h4.childNodes.forEach((node) => {\n      if (node.nodeType === Node.TEXT_NODE) {\n        a.appendChild(document.createTextNode(node.textContent));\n      } else {\n        a.appendChild(node);\n      }\n    });\n\n    a.classList.add('features-tabs-title');\n\n    li.appendChild(a);\n\n    // all descendants of a that have class tag\n    a.querySelectorAll('.tag').forEach((tag) => {\n      li.appendChild(tag);\n    });\n\n    const content = document.createElement('div');\n    content.classList.add('features-tabs-content');\n    li.appendChild(content);\n\n    // every oaragraph until next h4\n    let nextElement = h4.nextElementSibling;\n    while (nextElement && nextElement.tagName !== 'H4') {\n      content.appendChild(nextElement);\n      nextElement = h4.nextElementSibling;\n    }\n\n    ul.appendChild(li);\n\n    h4.remove();\n  });\n\n  return ul;\n}\n\nexport default function decorate(block) {\n  const cols = [...block.firstElementChild.children];\n  block.classList.add(`features-${cols.length}-cols`);\n\n  // setup image columns\n  [...block.children].forEach((row) => {\n    [...row.children].forEach((col) => {\n      const pic = col.querySelector('picture');\n      if (pic) {\n        const picWrapper = pic.closest('div');\n        if (picWrapper && picWrapper.children.length === 1) {\n          // picture is only content in column\n          picWrapper.classList.add('features-img-col');\n        }\n      }\n\n      // setup tabs\n      col.appendChild(extractFeatures(col));\n    });\n  });\n\n  const featuresList = block.querySelectorAll('ul');\n  if (featuresList) {\n    featuresList.forEach((list) => {\n      const featureText = list.previousElementSibling;\n      featureText.classList.add('feature-text');\n    });\n  }\n  matchHeights(block, '.feature-text');\n}\n"],"names":["expandItem","content","transitionEndCallback","collapseItem","eventListener","ul","event","target","collapsedLi","extractFeatures","col","h4","li","a","node","tag","nextElement","decorate","block","cols","row","pic","picWrapper","featuresList","list","matchHeights"],"mappings":"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"}