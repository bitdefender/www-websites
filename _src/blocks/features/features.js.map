{"version":3,"file":"features.js","sources":["../../../src/blocks/features/features.js"],"sourcesContent":["import { matchHeights } from '../../scripts/utils/utils.js';\n\nfunction expandItem(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  const transitionEndCallback = () => {\n    content.removeEventListener('transitionend', transitionEndCallback);\n    content.style.height = 'auto';\n  };\n  content.addEventListener('transitionend', transitionEndCallback);\n  content.classList.add('expanded');\n}\n\nfunction collapseItem(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  requestAnimationFrame(() => {\n    content.classList.remove('expanded');\n    content.style.height = 0;\n  });\n}\n\nfunction eventListener(ul) {\n  return (event) => {\n    let target = null;\n\n    // find ancestor a tag\n    if (event.target.tagName !== 'A') {\n      target = event.target.closest('a');\n    } else {\n      target = event.target;\n    }\n\n    // if the clicked node is not open then open it\n    if (!target.classList.contains('is-open')) {\n      target.classList.add('is-open');\n\n      // if the clicked node has children then toggle the expanded class\n      if (target.parentNode.children.length > 1) {\n        target.parentNode.querySelectorAll('.features-tabs-content').forEach((content) => {\n          expandItem(content);\n        });\n      }\n\n      // hid the other tabs\n      ul.querySelectorAll('li').forEach((collapsedLi) => {\n        if (collapsedLi !== target.parentNode) {\n          collapsedLi.children[0].classList.remove('is-open');\n          collapsedLi.querySelectorAll('.features-tabs-content').forEach((content) => {\n            collapseItem(content);\n          });\n        }\n      });\n    } else {\n      target.classList.remove('is-open');\n      // if the clicked node has children then toggle the expanded class\n      if (target.parentNode.children.length > 1) {\n        target.parentNode.querySelectorAll('.features-tabs-content').forEach((content) => {\n          collapseItem(content);\n        });\n      }\n    }\n  };\n}\n\nfunction extractFeatures(col) {\n  const ul = document.createElement('ul');\n  ul.classList.add('features-tabs');\n\n  // select all h4 tags as feature titles\n  col.querySelectorAll('h4').forEach((h4) => {\n    const li = document.createElement('li');\n    ul.appendChild(li);\n\n    const a = document.createElement('a');\n    a.setAttribute('href', '#');\n\n    // register click event on a tag\n\n    a.addEventListener('click', (event) => {\n      event.preventDefault();\n      eventListener(ul)(event);\n    });\n\n    h4.childNodes.forEach((node) => {\n      if (node.nodeType === Node.TEXT_NODE) {\n        a.appendChild(document.createTextNode(node.textContent));\n      } else {\n        a.appendChild(node);\n      }\n    });\n\n    a.classList.add('features-tabs-title');\n\n    li.appendChild(a);\n\n    // all descendants of a that have class tag\n    a.querySelectorAll('.tag').forEach((tag) => {\n      li.appendChild(tag);\n    });\n\n    const content = document.createElement('div');\n    content.classList.add('features-tabs-content');\n    li.appendChild(content);\n\n    // every oaragraph until next h4\n    let nextElement = h4.nextElementSibling;\n    while (nextElement && nextElement.tagName !== 'H4') {\n      content.appendChild(nextElement);\n      nextElement = h4.nextElementSibling;\n    }\n\n    ul.appendChild(li);\n\n    h4.remove();\n  });\n\n  return ul;\n}\n\nexport default function decorate(block) {\n  const cols = [...block.firstElementChild.children];\n  block.classList.add(`features-${cols.length}-cols`);\n\n  // setup image columns\n  [...block.children].forEach((row) => {\n    [...row.children].forEach((col) => {\n      const pic = col.querySelector('picture');\n      if (pic) {\n        const picWrapper = pic.closest('div');\n        if (picWrapper && picWrapper.children.length === 1) {\n          // picture is only content in column\n          picWrapper.classList.add('features-img-col');\n        }\n      }\n\n      // setup tabs\n      col.appendChild(extractFeatures(col));\n    });\n  });\n\n  const featuresList = block.querySelectorAll('ul');\n  if (featuresList) {\n    featuresList.forEach((list) => {\n      const featureText = list.previousElementSibling;\n      featureText.classList.add('feature-text');\n    });\n  }\n  matchHeights(block, '.feature-text');\n}\n"],"names":[],"mappings":"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"}