import{Constants as x}from"../../scripts/libs/constants.js";import{createNanoBlock as p,createTag as h,checkIfNotProductPage as N,renderNanoBlocks as A,matchHeights as f}from"../../scripts/utils/utils.js";const C=[{variable:"percent",storeVariable:"{DISCOUNT_PERCENTAGE}"}];function b(e,t){const a=document.createElement("div"),n=document.createElement("ul");n.classList.add("variant-selector"),a.appendChild(n),e.length===3&&(n.style.display="none");for(let s=0;s<e.length-2;s+=3){const u=e[s],c={};if(Number(t))c["data-store-click-set-devices"]=u;else{const i=e[s+1],o=e[s+2];c["data-store-click-set-product"]="",c["data-store-product-id"]=i,c["data-store-department"]="consumer",c["data-product-type"]=x.PRODUCT_ID_MAPPINGS[i].isMonthlyProduct?"monthly":"yearly",c["data-store-product-option"]=o}const r=h("li",c,`<span>${u}</span>`);t===u&&(r.classList.add("active"),r.checked=!0),r.addEventListener("click",()=>{const i=a.querySelector(".active");i&&(i.classList.remove("active"),i.checked=!1),r.classList.add("active"),r.checked=!0}),n.appendChild(r)}return a}function w(e="",t=""){const a=document.createElement("del");t.toLowerCase()==="monthly"?a.setAttribute("data-store-price","full-monthly"):a.setAttribute("data-store-price","full");const n=h("div",{"data-store-hide":"no-price=discounted;type=visibility",class:"price await-loader"},`<span class='old-price'>${e} ${a.outerHTML}</span>`);return t.toLowerCase()==="monthly"&&n.querySelector(".old-price").insertAdjacentHTML("beforeend","<sup>/mo</sup>"),n}function q(e="",t="",a="mo"){const n=document.createElement("strong");t.toLowerCase()==="monthly"?n.setAttribute("data-store-price","discounted-monthly||full-monthly"):n.setAttribute("data-store-price","discounted||full");const s=h("div",{class:"price await-loader"},`<strong class='new-price'>${e} ${n.outerHTML}</strong>`);return t.toLowerCase()==="monthly"&&s.querySelector(".new-price").insertAdjacentHTML("beforeend",`<sup>/${a}</sup>`),s}function I(e="Save",t=""){const a=document.createElement("span");return a.setAttribute("data-store-text-variable",""),a.textContent=`${e} ${t.toLowerCase()==="percent"?"{DISCOUNT_PERCENTAGE}":"{DISCOUNT_VALUE}"}`,h("div",{"data-store-hide":"no-price=discounted;type=visibility",class:"highlight await-loader",style:"display=none"},`${a.outerHTML}`)}const T=e=>{let t=e;return C.forEach(a=>{t=t.replaceAll(a.variable,a.storeVariable)}),t};function $(e){const t=T(e);return h("div",{class:"highlight","data-store-text-variable":"","data-store-hide":"no-price=discounted"},`<span>${t}</span>`)}const _=e=>C.some(t=>e.includes(t.variable));function O(e){const t=document.createElement("div");return t.setAttribute("data-store-text-variable",""),t.classList.add("featured"),t.textContent=e,_(e)&&(t.classList.add("await-loader"),t.textContent=T(t.textContent)),t}function M(e="Save",t=""){const a=document.createElement("span");a.setAttribute("data-store-text-variable",""),a.textContent=`${e} ${t.toLowerCase()==="percent"?"{DISCOUNT_PERCENTAGE}":"{DISCOUNT_VALUE}"}`;const n=h("div",{"data-store-hide":"no-price=discounted;type=visibility",class:"featured"},`${a.outerHTML}`);return n.classList.add("await-loader"),n}function B(...e){const t=e.filter(c=>c&&typeof c!="object").slice(-2),a=t.length>1?t[1]:t[0],n=t.length>1?t[0]:"",s=document.createElement("p"),u=document.createElement("span");return s.classList.add("await-loader"),u.setAttribute("data-store-text-variable",""),u.textContent=a.replace("0",n.toLowerCase()==="monthly"?"{SMALLEST_PRICE_PER_MONTH}":"{SMALLEST_PRICE}"),s.appendChild(u),s}function D(e){const t=e.replace("BilledPrice",'<em data-store-price="discounted||full" class="await-loader"></em>');return h("div",{class:"price condition"},`<em>${t}</em>`)}p("plans",b);p("price",q);p("oldPrice",w);p("priceCondition",D);p("featured",O);p("featuredSavings",M);p("highlightSavings",I);p("highlight",$);p("lowestPrice",B);function V(e){const t=e.closest(".section").dataset,a=[];Object.entries(t).forEach(([r,i])=>{if(r.includes("plans")){const o=i.match(/[^,{}[\]]+/gu).map(v=>v.trim());a.push({productCode:o[1],defaultVariant:`${Number(o.slice(-1)[0])?o.slice(-1)[0]:o[2].match(/[0-9-]+/g)[0]}${o[2].match(/[0-9-]+/g)[1]}`})}}),e.parentElement.parentElement.setAttribute("data-store-context",""),[...e.children].forEach((r,i)=>{[...r.children].forEach((o,v)=>{const y=i*r.children.length+v;let l="main-product-loaded";N()&&(l="product-loaded"),o.classList.add("product-card"),o.setAttribute("data-store-context",""),a[y]&&(o.setAttribute("data-store-id",a[y].productCode),o.setAttribute("data-store-option",a[y].defaultVariant)),o.setAttribute("data-store-department","consumer"),o.setAttribute("data-store-event",l),o.querySelectorAll(".button-container a")?.forEach(m=>{(m.href?.includes("/buy/")||m.href?.includes("#buylink"))&&(m.href="#",m.setAttribute("data-store-buy-link",""))}),e.appendChild(o),A(o,void 0,i)}),r.remove()});const n=e.parentNode.parentNode.querySelector(".default-content-wrapper");n&&A(n),[...e.querySelectorAll(".product-card .featured")].forEach(r=>{r.closest(".product-card").classList.add("featured")}),e.querySelectorAll(".product-card li").forEach(r=>{r.querySelector("del")?r.classList.add("with-del"):r.classList.remove("with-del")}),e.querySelectorAll(".product-card ul").forEach(r=>{r.previousElementSibling?.tagName==="P"&&r.previousElementSibling.classList.add("ul-header-text")}),e.querySelectorAll(".product-card ul li u").forEach(r=>{r.parentNode.classList.add("icon-important")}),e.querySelectorAll(".product-card.featured p").forEach(r=>{Array.from(r.childNodes).every(o=>o.nodeName==="SPAN")&&(r.classList.add("os-availability"),r.nextElementSibling.nodeName==="P"&&r.nextElementSibling.classList.add("os-availability-text"))});const u=e.querySelectorAll(".product-card"),c=e.querySelector(".product-card.featured");u.forEach((r,i)=>{r.querySelector("img")!==null&&!e.classList.contains("plans")&&!e.classList.contains("compact")&&r.querySelector("p:not(:has(img, .icon))").classList.add("img-adjacent-text");const v=r.querySelector(".variant-selector"),y=`dynamicPriceTexts${i+1}`;if(t[y]){const l=[...t[y].split(",")],d=r.querySelector(".price.condition em");v?.querySelectorAll("li")?.forEach((m,P)=>{m.addEventListener("click",()=>{if(m.classList.contains("active")&&d&&l){const E=l[P]||"";if(E.includes("{BilledPrice}")){const[L,g]=E.split("{BilledPrice}");Array.from(d.childNodes).filter(S=>S.nodeType===Node.TEXT_NODE).forEach(S=>d.removeChild(S)),L&&d.insertBefore(document.createTextNode(L),d.firstChild),g&&d.appendChild(document.createTextNode(g))}else d.textContent=E}})})}if(!r.classList.contains("featured")){if(!c)return;let l=r.querySelector("h3");l=l.nextElementSibling;const d=document.createElement("div");l.insertAdjacentElement("afterend",d),d.classList.add("featured","nanoblock"),d.style.visibility="hidden"}}),f(e,".price.nanoblock:not(:last-of-type)"),f(e,".price.condition"),f(e,"h3:nth-of-type(2)"),f(e,"p:nth-of-type(2)"),f(e,"p:nth-of-type(3)"),f(e,"h4"),f(e,"ul:not(.variant-selector)"),f(e,".featured.nanoblock")}export{V as default};
//# sourceMappingURL=products.js.map
