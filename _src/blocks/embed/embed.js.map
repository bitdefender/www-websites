{"version":3,"file":"embed.js","sources":["../../../src/blocks/embed/embed.js"],"sourcesContent":["/*\n * Embed Block\n * Show videos and social posts directly on your page\n * https://www.aem.live/developer/block-collection/embed\n */\n\nconst loadScript = (url, callback, type) => {\n  const head = document.querySelector('head');\n  const script = document.createElement('script');\n  script.src = url;\n  if (type) {\n    script.setAttribute('type', type);\n  }\n  script.onload = callback;\n  head.append(script);\n  return script;\n};\n\nconst getDefaultEmbed = (url) => `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n    <iframe src=\"${url.href}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" allowfullscreen=\"\"\n      scrolling=\"no\" allow=\"encrypted-media\" title=\"Content from ${url.hostname}\" loading=\"lazy\">\n    </iframe>\n  </div>`;\n\nconst embedYoutube = (url, autoplay) => {\n  const usp = new URLSearchParams(url.search);\n  const suffix = autoplay ? '&muted=1&autoplay=1' : '';\n  let vid = encodeURIComponent(usp.get('v'));\n  const embed = url.pathname;\n  if (url.origin.includes('youtu.be')) {\n    [, vid] = url.pathname.split('/');\n  }\n  const embedHTML = `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://www.youtube.com${vid ? `/embed/${vid}?rel=0&v=${vid}${suffix}` : embed}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" \n      allow=\"autoplay; fullscreen; picture-in-picture; encrypted-media; accelerometer; gyroscope; picture-in-picture\" allowfullscreen=\"\" scrolling=\"no\" title=\"Content from Youtube\" loading=\"lazy\"></iframe>\n    </div>`;\n  return embedHTML;\n};\n\nconst embedVimeo = (url, autoplay) => {\n  const [, video] = url.pathname.split('/');\n  const suffix = autoplay ? '?muted=1&autoplay=1' : '';\n  const embedHTML = `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://player.vimeo.com/video/${video}${suffix}\" \n      style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" \n      frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen  \n      title=\"Content from Vimeo\" loading=\"lazy\"></iframe>\n    </div>`;\n  return embedHTML;\n};\n\nconst embedTwitter = (url) => {\n  const embedHTML = `<blockquote class=\"twitter-tweet\"><a href=\"${url.href}\"></a></blockquote>`;\n  loadScript('https://platform.twitter.com/widgets.js');\n  return embedHTML;\n};\n\nconst loadEmbed = (block, link, autoplay) => {\n  if (block.classList.contains('embed-is-loaded')) {\n    return;\n  }\n\n  const EMBEDS_CONFIG = [\n    {\n      match: ['youtube', 'youtu.be'],\n      embed: embedYoutube,\n    },\n    {\n      match: ['vimeo'],\n      embed: embedVimeo,\n    },\n    {\n      match: ['twitter'],\n      embed: embedTwitter,\n    },\n  ];\n\n  const config = EMBEDS_CONFIG.find((e) => e.match.some((match) => link.includes(match)));\n  const url = new URL(link);\n  if (config) {\n    block.innerHTML = config.embed(url, autoplay);\n    block.classList = `block embed embed-${config.match[0]}`;\n  } else {\n    block.innerHTML = getDefaultEmbed(url);\n    block.classList = 'block embed';\n  }\n  block.classList.add('embed-is-loaded');\n};\n\nexport default function decorate(block) {\n  const placeholder = block.querySelector('picture');\n  const link = block.querySelector('a').href;\n  block.textContent = '';\n\n  if (placeholder) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'embed-placeholder';\n    wrapper.innerHTML = '<div class=\"embed-placeholder-play\"><button title=\"Play\"></button></div>';\n    wrapper.prepend(placeholder);\n    wrapper.addEventListener('click', () => {\n      loadEmbed(block, link, true);\n    });\n    block.append(wrapper);\n  } else {\n    const observer = new IntersectionObserver((entries) => {\n      if (entries.some((e) => e.isIntersecting)) {\n        observer.disconnect();\n        loadEmbed(block, link, true);\n      }\n    });\n    observer.observe(block);\n  }\n}\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,MAAM,UAAU,GAAG,CAAC,GAAG,EAAE,QAAQ,EAAE,IAAI,KAAK;AAC5C,EAAE,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC;AAC7C,EAAE,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC;AACjD,EAAE,MAAM,CAAC,GAAG,GAAG,GAAG;AAIlB,EAAE,MAAM,CAAC,MAAM,GAAG,QAAQ;AAC1B,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AACrB,EAAE,OAAO,MAAM;AACf,CAAC;;AAED,MAAM,eAAe,GAAG,CAAC,GAAG,KAAK,CAAC;AAClC,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC;AAC5B,iEAAiE,EAAE,GAAG,CAAC,QAAQ,CAAC;AAChF;AACA,QAAQ,CAAC;;AAET,MAAM,YAAY,GAAG,CAAC,GAAG,EAAE,QAAQ,KAAK;AACxC,EAAE,MAAM,GAAG,GAAG,IAAI,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC;AAC7C,EAAE,MAAM,MAAM,GAAG,QAAQ,GAAG,qBAAqB,GAAG,EAAE;AACtD,EAAE,IAAI,GAAG,GAAG,kBAAkB,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC5C,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,QAAQ;AAC5B,EAAE,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;AACvC,IAAI,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC;AACrC;AACA,EAAE,MAAM,SAAS,GAAG,CAAC;AACrB,0CAA0C,EAAE,GAAG,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,KAAK,CAAC;AAClG;AACA,UAAU,CAAC;AACX,EAAE,OAAO,SAAS;AAClB,CAAC;;AAED,MAAM,UAAU,GAAG,CAAC,GAAG,EAAE,QAAQ,KAAK;AACtC,EAAE,MAAM,GAAG,KAAK,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC;AAC3C,EAAE,MAAM,MAAM,GAAG,QAAQ,GAAG,qBAAqB,GAAG,EAAE;AACtD,EAAE,MAAM,SAAS,GAAG,CAAC;AACrB,kDAAkD,EAAE,KAAK,CAAC,EAAE,MAAM,CAAC;AACnE;AACA;AACA;AACA,UAAU,CAAC;AACX,EAAE,OAAO,SAAS;AAClB,CAAC;;AAED,MAAM,YAAY,GAAG,CAAC,GAAG,KAAK;AAC9B,EAAE,MAAM,SAAS,GAAG,CAAC,2CAA2C,EAAE,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC;AAC/F,EAAE,UAAU,CAAC,yCAAyC,CAAC;AACvD,EAAE,OAAO,SAAS;AAClB,CAAC;;AAED,MAAM,SAAS,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,QAAQ,KAAK;AAC7C,EAAE,IAAI,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,iBAAiB,CAAC,EAAE;AACnD,IAAI;AACJ;;AAEA,EAAE,MAAM,aAAa,GAAG;AACxB,IAAI;AACJ,MAAM,KAAK,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC;AACpC,MAAM,KAAK,EAAE,YAAY;AACzB,KAAK;AACL,IAAI;AACJ,MAAM,KAAK,EAAE,CAAC,OAAO,CAAC;AACtB,MAAM,KAAK,EAAE,UAAU;AACvB,KAAK;AACL,IAAI;AACJ,MAAM,KAAK,EAAE,CAAC,SAAS,CAAC;AACxB,MAAM,KAAK,EAAE,YAAY;AACzB,KAAK;AACL,GAAG;;AAEH,EAAE,MAAM,MAAM,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;AACzF,EAAE,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC;AAC3B,EAAE,IAAI,MAAM,EAAE;AACd,IAAI,KAAK,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC;AACjD,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,kBAAkB,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5D,GAAG,MAAM;AACT,IAAI,KAAK,CAAC,SAAS,GAAG,eAAe,CAAC,GAAG,CAAC;AAC1C,IAAI,KAAK,CAAC,SAAS,GAAG,aAAa;AACnC;AACA,EAAE,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC;AACxC,CAAC;;AAEc,SAAS,QAAQ,CAAC,KAAK,EAAE;AACxC,EAAE,MAAM,WAAW,GAAG,KAAK,CAAC,aAAa,CAAC,SAAS,CAAC;AACpD,EAAE,MAAM,IAAI,GAAG,KAAK,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI;AAC5C,EAAE,KAAK,CAAC,WAAW,GAAG,EAAE;;AAExB,EAAE,IAAI,WAAW,EAAE;AACnB,IAAI,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACjD,IAAI,OAAO,CAAC,SAAS,GAAG,mBAAmB;AAC3C,IAAI,OAAO,CAAC,SAAS,GAAG,0EAA0E;AAClG,IAAI,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC;AAChC,IAAI,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM;AAC5C,MAAM,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC;AAClC,KAAK,CAAC;AACN,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC;AACzB,GAAG,MAAM;AACT,IAAI,MAAM,QAAQ,GAAG,IAAI,oBAAoB,CAAC,CAAC,OAAO,KAAK;AAC3D,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,cAAc,CAAC,EAAE;AACjD,QAAQ,QAAQ,CAAC,UAAU,EAAE;AAC7B,QAAQ,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC;AACpC;AACA,KAAK,CAAC;AACN,IAAI,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;AAC3B;AACA;;;;"}