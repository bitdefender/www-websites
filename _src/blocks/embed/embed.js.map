{"version":3,"file":"embed.js","sources":["../../../src/blocks/embed/embed.js"],"sourcesContent":["/*\n * Embed Block\n * Show videos and social posts directly on your page\n * https://www.aem.live/developer/block-collection/embed\n */\n\nconst loadScript = (url, callback, type) => {\n  const head = document.querySelector('head');\n  const script = document.createElement('script');\n  script.src = url;\n  if (type) {\n    script.setAttribute('type', type);\n  }\n  script.onload = callback;\n  head.append(script);\n  return script;\n};\n\nconst getDefaultEmbed = (url) => `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n    <iframe src=\"${url.href}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" allowfullscreen=\"\"\n      scrolling=\"no\" allow=\"encrypted-media\" title=\"Content from ${url.hostname}\" loading=\"lazy\">\n    </iframe>\n  </div>`;\n\nconst embedYoutube = (url, autoplay) => {\n  const usp = new URLSearchParams(url.search);\n  const suffix = autoplay ? '&muted=1&autoplay=1' : '';\n  let vid = encodeURIComponent(usp.get('v'));\n  const embed = url.pathname;\n  if (url.origin.includes('youtu.be')) {\n    [, vid] = url.pathname.split('/');\n  }\n  const embedHTML = `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://www.youtube.com${vid ? `/embed/${vid}?rel=0&v=${vid}${suffix}` : embed}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" \n      allow=\"autoplay; fullscreen; picture-in-picture; encrypted-media; accelerometer; gyroscope; picture-in-picture\" allowfullscreen=\"\" scrolling=\"no\" title=\"Content from Youtube\" loading=\"lazy\"></iframe>\n    </div>`;\n  return embedHTML;\n};\n\nconst embedVimeo = (url, autoplay) => {\n  const [, video] = url.pathname.split('/');\n  const suffix = autoplay ? '?muted=1&autoplay=1' : '';\n  const embedHTML = `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://player.vimeo.com/video/${video}${suffix}\" \n      style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" \n      frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen  \n      title=\"Content from Vimeo\" loading=\"lazy\"></iframe>\n    </div>`;\n  return embedHTML;\n};\n\nconst embedTwitter = (url) => {\n  const embedHTML = `<blockquote class=\"twitter-tweet\"><a href=\"${url.href}\"></a></blockquote>`;\n  loadScript('https://platform.twitter.com/widgets.js');\n  return embedHTML;\n};\n\nconst loadEmbed = (block, link, autoplay) => {\n  if (block.classList.contains('embed-is-loaded')) {\n    return;\n  }\n\n  const EMBEDS_CONFIG = [\n    {\n      match: ['youtube', 'youtu.be'],\n      embed: embedYoutube,\n    },\n    {\n      match: ['vimeo'],\n      embed: embedVimeo,\n    },\n    {\n      match: ['twitter'],\n      embed: embedTwitter,\n    },\n  ];\n\n  const config = EMBEDS_CONFIG.find((e) => e.match.some((match) => link.includes(match)));\n  const url = new URL(link);\n  if (config) {\n    block.innerHTML = config.embed(url, autoplay);\n    block.classList = `block embed embed-${config.match[0]}`;\n  } else {\n    block.innerHTML = getDefaultEmbed(url);\n    block.classList = 'block embed';\n  }\n  block.classList.add('embed-is-loaded');\n};\n\nexport default function decorate(block) {\n  const placeholder = block.querySelector('picture');\n  const link = block.querySelector('a').href;\n  block.textContent = '';\n\n  if (placeholder) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'embed-placeholder';\n    wrapper.innerHTML = '<div class=\"embed-placeholder-play\"><button title=\"Play\"></button></div>';\n    wrapper.prepend(placeholder);\n    wrapper.addEventListener('click', () => {\n      loadEmbed(block, link, true);\n    });\n    block.append(wrapper);\n  } else {\n    const observer = new IntersectionObserver((entries) => {\n      if (entries.some((e) => e.isIntersecting)) {\n        observer.disconnect();\n        loadEmbed(block, link, true);\n      }\n    });\n    observer.observe(block);\n  }\n}\n"],"names":["loadScript","url","callback","type","head","script","getDefaultEmbed","embedYoutube","autoplay","usp","suffix","vid","embed","embedVimeo","video","embedTwitter","embedHTML","loadEmbed","block","link","config","e","match","decorate","placeholder","wrapper","observer","entries"],"mappings":"AAMA,MAAMA,EAAa,CAACC,EAAKC,EAAUC,IAAS,CAC1C,MAAMC,EAAO,SAAS,cAAc,MAAM,EACpCC,EAAS,SAAS,cAAc,QAAQ,EAC9C,OAAAA,EAAO,IAAMJ,EAIbI,EAAO,OAASH,EAChBE,EAAK,OAAOC,CAAM,EACXA,CACT,EAEMC,EAAmBL,GAAQ;AAAA,mBACdA,EAAI,IAAI;AAAA,mEACwCA,EAAI,QAAQ;AAAA;AAAA,UAIzEM,EAAe,CAACN,EAAKO,IAAa,CACtC,MAAMC,EAAM,IAAI,gBAAgBR,EAAI,MAAM,EACpCS,EAASF,EAAW,sBAAwB,GAClD,IAAIG,EAAM,mBAAmBF,EAAI,IAAI,GAAG,CAAC,EACzC,MAAMG,EAAQX,EAAI,SAClB,OAAIA,EAAI,OAAO,SAAS,UAAU,IAChC,CAAA,CAAGU,CAAG,EAAIV,EAAI,SAAS,MAAM,GAAG,GAEhB;AAAA,4CACwBU,EAAM,UAAUA,CAAG,YAAYA,CAAG,GAAGD,CAAM,GAAKE,CAAK;AAAA;AAAA,WAIjG,EAEMC,EAAa,CAACZ,EAAKO,IAAa,CACpC,KAAM,CAAA,CAAGM,CAAK,EAAIb,EAAI,SAAS,MAAM,GAAG,EAQxC,MANkB;AAAA,oDACgCa,CAAK,GAFxCN,EAAW,sBAAwB,EAEc;AAAA;AAAA;AAAA;AAAA,WAMlE,EAEMO,EAAgBd,GAAQ,CAC5B,MAAMe,EAAY,8CAA8Cf,EAAI,IAAI,sBACxE,OAAAD,EAAW,yCAAyC,EAC7CgB,CACT,EAEMC,EAAY,CAACC,EAAOC,EAAMX,IAAa,CAC3C,GAAIU,EAAM,UAAU,SAAS,iBAAiB,EAC5C,OAkBF,MAAME,EAfgB,CACpB,CACE,MAAO,CAAC,UAAW,UAAU,EAC7B,MAAOb,CACR,EACD,CACE,MAAO,CAAC,OAAO,EACf,MAAOM,CACR,EACD,CACE,MAAO,CAAC,SAAS,EACjB,MAAOE,CACR,CACF,EAE4B,KAAMM,GAAMA,EAAE,MAAM,KAAMC,GAAUH,EAAK,SAASG,CAAK,CAAC,CAAC,EAChFrB,EAAM,IAAI,IAAIkB,CAAI,EACpBC,GACFF,EAAM,UAAYE,EAAO,MAAMnB,EAAKO,CAAQ,EAC5CU,EAAM,UAAY,qBAAqBE,EAAO,MAAM,CAAC,CAAC,KAEtDF,EAAM,UAAYZ,EAAgBL,CAAG,EACrCiB,EAAM,UAAY,eAEpBA,EAAM,UAAU,IAAI,iBAAiB,CACvC,EAEe,SAASK,EAASL,EAAO,CACtC,MAAMM,EAAcN,EAAM,cAAc,SAAS,EAC3CC,EAAOD,EAAM,cAAc,GAAG,EAAE,KAGtC,GAFAA,EAAM,YAAc,GAEhBM,EAAa,CACf,MAAMC,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,oBACpBA,EAAQ,UAAY,2EACpBA,EAAQ,QAAQD,CAAW,EAC3BC,EAAQ,iBAAiB,QAAS,IAAM,CACtCR,EAAUC,EAAOC,EAAM,EAAI,CACjC,CAAK,EACDD,EAAM,OAAOO,CAAO,CACxB,KAAS,CACL,MAAMC,EAAW,IAAI,qBAAsBC,GAAY,CACjDA,EAAQ,KAAMN,GAAMA,EAAE,cAAc,IACtCK,EAAS,WAAY,EACrBT,EAAUC,EAAOC,EAAM,EAAI,EAEnC,CAAK,EACDO,EAAS,QAAQR,CAAK,CAC1B,CACA"}