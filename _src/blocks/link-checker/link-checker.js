import{AdobeDataLayerService as m}from"../../node_modules/@repobit/dex-data-layer/dist/src/adobe-data-layer-service/index.js";import"../../node_modules/@repobit/dex-utils/dist/src/index.js";import{UserDetectedEvent as y}from"../../node_modules/@repobit/dex-data-layer/dist/src/events/user-detected-event/index.js";import{WindowLoadStartedEvent as g}from"../../node_modules/@repobit/dex-data-layer/dist/src/events/window-load-started-event/index.js";import{WindowLoadedEvent as v}from"../../node_modules/@repobit/dex-data-layer/dist/src/events/window-loaded-event/index.js";import{BotPrevention as w}from"../../scripts/utils/bot-prevention.js";class S{static createMessage(n,a,c){let r=a;/^https?:\/\//i.test(a)||(r=`http://${a}`),r=new URL(r),r.hostname.startsWith("www.")||(r.hostname=`www.${r.hostname}`);const t={1:"safe",2:"so_far_so_good_1",3:"so_far_so_good_2",4:"malware &amp; phishing",5:"malware",6:"c&amp;c",7:"malvertising &amp; fraud &amp; phishing",8:"fraud",9:"phishing",10:"malvertising",11:"pua",12:"homograph",13:"miner",14:"miner-server",15:"spam",16:"malware-hd",17:"untrusted",18:"malicious",other:"other"},s=t[n]||t.other,o=s.includes("safe")||s.includes("so_far_so_good_1")||s.includes("so_far_so_good_2");let i=c[s.toLowerCase()];return i=i.replace("<domain-name>",r.hostname),i?{text:i,className:o?"result safe":"result danger",status:s}:{text:`Status: ${s}`,className:"result warning"}}}function E(e,n,a){const c=a[n.status.toLowerCase()]||a.default;e.querySelector("h1").textContent=c}const b=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-_]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+@]*)*(\\?[;&a-z\\d%\\/_@.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);async function x(e,n,a,c,r){const t=n.value.trim();if(!t||!b(t)){a.textContent="Please enter a valid URL",a.className="result danger";return}n.closest(".input-container").classList.add("loader-circle");let s=await fetch("https://eu.nimbus.bitdefender.net/tools/link-checker",{method:"POST",headers:{"Content-Type":"application/json","X-Nimbus-ClientID":"81b10964-a3c1-44f6-b5ac-7eac82db3ab1"},body:JSON.stringify({url:t})});if(s.status===401){const l=await s.json(),p=await w.solveChallange(l);s=await fetch("https://eu.nimbus.bitdefender.net/tools/link-checker",{method:"POST",headers:{"Content-Type":"application/json","X-Nimbus-ClientID":"81b10964-a3c1-44f6-b5ac-7eac82db3ab1"},body:JSON.stringify({url:t,pow_challenge:l.pow_challenge,pow_solution:p.nonces})})}if(!s.ok){a.innerHTML=`
      <strong>Something went wrong</strong><br>
      The system encountered an error while trying to check the link you provided. Please try again in a few minutes.`,a.className="result danger no-response",n.closest(".input-container").classList.remove("loader-circle");return}const o=await s.json(),{status:i}=o,d=S.createMessage(i,t,c);a.innerHTML=d.text,a.className=d.className,e.closest(".section").classList.add(d.className.split(" ")[1]),n.setAttribute("disabled",""),document.getElementById("inputDiv").textContent=t,E(e,d,r),n.closest(".input-container").classList.remove("loader-circle"),m.push(new g(l=>(l.name+=`:${d.status}`,l))),m.push(new y),m.push(new v)}async function f(e){const n=["danger","safe"],a=e.closest(".section");n.forEach(s=>{a.classList.contains(s)&&a.classList.remove(s)});const c=e.querySelector("#link-checker-input"),r=e.querySelector(".result"),t=e.querySelector("h1");c.removeAttribute("disabled"),c.value="",r.className="result",t.textContent="Is This Link Really Safe?",m.push(new g({})),m.push(new y),m.push(new v)}function _(e){e.style.maxWidth=`${e.offsetWidth}px`,e.style.maxHeight=`${e.offsetHeight}px`;const n=document.createElement("div");return n.classList.add("share-popup"),e.insertAdjacentElement("beforeend",n),n}function T(e,n,a){const c=window.location.href;if(navigator.clipboard.writeText(c),e.querySelector(".buttons-container")){const t=e.querySelector(".share-popup")||_(n);t.textContent=`${a}`;const s=Math.abs((t.offsetWidth-n.offsetWidth)/2);t.style=`transform:translateX(-${s}px); opacity: 1`,setTimeout(()=>{t.style=`transform:translateX(-${s}px); opacity:0;`},2e3)}}function q(e){const n={};return Array.from(e.querySelectorAll("div")).find(r=>{const t=r.querySelector("p");return t&&t.textContent.includes("<status-messages>")}).querySelectorAll("p").forEach((r,t)=>{if(t===0)return;const s=r.innerHTML.split(":");if(s.length>=2){const o=s[0].trim(),i=s.slice(1).join(":").trim();n[o.toLowerCase()]=i}}),n}function A(e){const n={},a=Array.from(e.querySelectorAll("div")).find(r=>{const t=r.querySelector("p");return t&&t.textContent.includes("<titles-change>")});return a.classList.add("status-titles"),a.querySelectorAll("p").forEach((r,t)=>{if(t===0)return;const s=r.textContent.split(":");if(s.length>=2){const o=s[0].trim(),i=s.slice(1).join(":").trim();n[o.toLowerCase()]=i}}),a.remove(),n}function k(e,n,a){const c=Array.from(e.querySelectorAll("div")).find(o=>{const i=o.querySelector("p");return i&&i.textContent.includes("<buttons>")});if(c){c.classList.add("buttons-container");const o=c.querySelectorAll("p");c.querySelector("div").remove(),o.forEach((i,d)=>{if(d===0){i.remove();return}d===1&&i.querySelector("a").classList.add("share-button"),d===2&&i.querySelector("a").classList.add("check-another-button"),c.appendChild(i);const l=i.querySelector("a");l.href.includes("#check-another")&&l.addEventListener("click",()=>f(e))});return}const r=document.createElement("div");r.classList.add("buttons-container");const t=document.createElement("button");t.innerHTML="<span>Share Link Checker</span>",t.classList.add("share-button");const s=document.createElement("button");s.innerHTML="<span>Check Another Link</span>",s.classList.add("check-another-button"),r.appendChild(t),r.appendChild(s),n.appendChild(r),s.addEventListener("click",()=>f(e)),a&&t.addEventListener("click",o=>{o.preventDefault(),T(e,t,a)})}function j(e){const{clipboardText:n}=e.closest(".section").dataset;e.querySelector(":scope > div:nth-child(3)").classList.add("privacy-policy");const c=q(e),r=A(e),t=document.createElement("div");t.classList.add("link-checker-form");const s=document.createElement("div");s.classList.add("input-container"),t.appendChild(s);const o=document.createElement("input");o.type="text",o.placeholder="example-url.com",o.id="link-checker-input";const i=document.createElement("span");i.id="copy-to-clipboard";const d=document.createElement("p");d.setAttribute("id","inputDiv");const l=document.createElement("div");l.className="input-container__container",l.appendChild(o),e.prepend(d),l.appendChild(i),s.appendChild(l),i.addEventListener("click",async()=>{try{const h=await navigator.clipboard.readText();o.value+=h}catch{}});const p=document.createElement("button");p.textContent="Check URL",p.classList.add("check-url"),s.appendChild(p);const u=document.createElement("div");u.className="result",t.appendChild(u),e.querySelectorAll(":scope > div")[1].replaceWith(t);const[L,C]=e.querySelectorAll("picture");L.classList.add("safe-image"),C.classList.add("danger-image"),p.addEventListener("click",()=>x(e,o,u,c,r)),k(e,t,n),o.addEventListener("input",()=>{o.value.trim()===""&&(u.textContent="",u.className="")}),o.addEventListener("paste",()=>{u.textContent="",u.className=""})}export{j as default};
//# sourceMappingURL=link-checker.js.map
