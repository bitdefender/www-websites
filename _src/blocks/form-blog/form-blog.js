import"../../vendor/repobit/dex-utils/dist/src/index.js";import{AdobeDataLayerService as L}from"../../vendor/repobit/dex-data-layer/dist/src/adobe-data-layer-service/index.js";import{FormEvent as S}from"../../vendor/repobit/dex-data-layer/dist/src/events/form-event/index.js";import x from"../../vendor/repobit/dex-utils/dist/src/cookies.js";function p(e){const r=e.querySelector('input[type="submit"]'),c=e.querySelector('input[type="email"]'),s=[...e.querySelectorAll('input[type="checkbox"]:required')].every(a=>a.checked),d=c.value.trim()!=="";r.disabled=!(s&&d)}async function E(e){const c=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",c);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function H(e,r){const c="0".repeat(r);let s=0;for(;;){const d=e+s,a=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(d)),n=Array.from(new Uint8Array(a)).map(o=>o.toString(16).padStart(2,"0")).join("");if(n.startsWith(c))return{nonce:s,hash:n};s++}}async function v(e,r,c,s,d,a="newsletter"){e.preventDefault();const i=await fetch("https://www.bitdefender.com/site/Store/challenge"),{challenge:n,difficulty:o}=await i.json(),{nonce:t}=await H(n,o),u=new FormData(r),l=u.get("email"),m=u.get("name"),w=m.split(" ")[0],y=m.split(" ")[1]||"",b=u.get("checkbox"),g=await fetch("https://www.bitdefender.com/site/Store/offerSubscribe",{method:"POST",body:JSON.stringify({email:l,flow:c,first_name:w,last_name:y,update:b,nonce:t,challenge:n,difficulty:o})}),h=r.parentElement;if(g.ok){const A=await E(l);L.push(new S("form completed",{form:a,formID:A})),h.innerHTML="",h.appendChild(s),x.set("newsLetterIntentShown","1")}else h.innerHTML="",h.appendChild(d)}function T(e){const r=/{{(.*?)}}/g,c=/\[\[(.*?)\]\]/g,s=[],d=[];let a;for(;(a=r.exec(e))!==null;)s.push(a[1].trim());for(;(a=c.exec(e))!==null;)d.push(a[1].trim());return{insideCurlyBrackets:s,insideSquareBrackets:d}}async function f(e,r,c,s,d,a){const i=document.createElement("form");i.setAttribute("method","post");for(let n=0;n<e.length;n+=1){const o=e[n].toLowerCase(),t=document.createElement("input");if(t.id=`form-${n}-${o}`,t.addEventListener("change",()=>p(i)),t.addEventListener("input",()=>p(i)),o==="name"?t.setAttribute("type","text"):t.setAttribute("type",o),t.setAttribute("name",o),t.setAttribute("placeholder",r[n]),t.setAttribute("required",""),t.setAttribute("aria-required","true"),i.append(t),o==="submit"&&(t.classList.add("disabled"),t.disabled=!0),o==="checkbox"){const u=document.createElement("div");u.classList.add("checkbox");const l=document.createElement("label");l.setAttribute("for",`form-${n}-${o}`),l.innerHTML=r[n],t.before(u),u.append(t,l)}}return i.addEventListener("submit",n=>v(n,i,c,s,d,a)),i}async function B(e,r){const{template:c,flow:s,captchaKey:d}=e.closest(".section").dataset;r&&(e=e.querySelector(".block"),e.closest(".section").classList.add("we-container"));const a=e.children[1],i=e.children[2].children[1],n=e.children[3].children[1],o=T(a.innerHTML),[t,u]=[o.insideCurlyBrackets,o.insideSquareBrackets];let l=null;r?l=await f(t,u,s,i,n,r.formType):l=await f(t,u,s,i,n,"newsletter"),l&&e.append(l),e.children[1].innerHTML="",e.children[2].innerHTML="",e.children[3].innerHTML="",c==="blog"&&e.classList.add("blog-template"),window.dispatchEvent(new CustomEvent("shadowDomLoaded"),{bubbles:!0,composed:!0})}export{B as default};
//# sourceMappingURL=form-blog.js.map
