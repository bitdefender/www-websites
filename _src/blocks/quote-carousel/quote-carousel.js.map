{"version":3,"file":"quote-carousel.js","sources":["../../../src/blocks/quote-carousel/quote-carousel.js"],"sourcesContent":["import { createTag } from '../../scripts/utils/utils.js';\nimport { decorateIcons } from '../../scripts/lib-franklin.js';\n\nconst SLIDE_PREFIX = 'carousel-slide-';\nconst CONTROL_PREFIX = 'carousel-control-';\n\nfunction createSlide(item, index) {\n  const paragraphs = Array.from(item.querySelectorAll('p'));\n  const quote = paragraphs.find((paragraph) => {\n    const strongOrEm = paragraph.querySelector('strong, em');\n    return !strongOrEm && paragraph.innerHTML !== '';\n  });\n\n  const author = item.querySelector('p > strong');\n  const description = item.querySelector('p > em');\n  if (!quote) {\n    return null;\n  }\n\n  return createTag(\n    'div',\n    {\n      class: 'slide',\n      id: `${SLIDE_PREFIX}${index}`,\n      role: 'tabpanel',\n      'aria-hidden': 'true',\n      'aria-describedby': `${CONTROL_PREFIX}${index}`,\n      tabindex: '-1',\n    },\n    `<div class=\"quote\">\n        <span class=\"icon icon-dark-blue-quote\"/>\n    </div>\n    <div class=\"quote-content\">\n        <h4>${quote?.innerHTML}</h4>\n        <h5>${author?.textContent}</h5>\n        <p>${description?.innerHTML}</p>\n    </div>`,\n  );\n}\n\nfunction getCurrentSlideIndex(slides) {\n  return [...slides.children].findIndex((slide) => slide.classList.contains('active'));\n}\n\nfunction updateControlsState(block, nextIndex) {\n  const dots = block.querySelector('.slides-dots');\n  const currentActive = dots.querySelector('.active');\n  if (currentActive) {\n    currentActive.classList.remove('active');\n    const btn = currentActive.querySelector('button');\n    btn.removeAttribute('aria-selected');\n    btn.setAttribute('tabindex', '-1');\n  }\n  const nextActive = dots.children[nextIndex];\n  if (nextActive) {\n    nextActive.classList.add('active');\n    const btn = nextActive.querySelector('button');\n    btn.setAttribute('aria-selected', 'true');\n    btn.setAttribute('tabindex', '0');\n  }\n}\n\nfunction updateSlideState(nextIndex, block) {\n  const slides = block.querySelector('.slides');\n  const currentIndex = getCurrentSlideIndex(slides);\n  slides.children[currentIndex].classList.remove('active');\n  slides.children[nextIndex].classList.add('active');\n  const translateX = -nextIndex * 100;\n  slides.style.transform = `translateX( ${translateX}% )`;\n  [...slides.children].forEach((slide, index) => {\n    if (index === nextIndex) {\n      slide.removeAttribute('tabindex');\n      slide.setAttribute('aria-hidden', 'false');\n    } else {\n      slide.setAttribute('tabindex', '-1');\n      slide.setAttribute('aria-hidden', 'true');\n    }\n  });\n  updateControlsState(block, nextIndex);\n}\n\nfunction addDotsListeners(dotsControls, slides) {\n  [...dotsControls.children].forEach((dot, index) => {\n    dot.addEventListener('click', (event) => {\n      event.preventDefault();\n      updateSlideState(index, slides.parentElement);\n    });\n  });\n}\n\nfunction createDotsControls(slides) {\n  const dots = createTag('ul', { class: 'slides-dots', role: 'tablist' });\n  const slidesNumber = slides.children.length;\n  [...slides.children].forEach((slide, slideIndex) => {\n    const ariaIndex = slideIndex + 1;\n    const btn = createTag(\n      'button',\n      {\n        id: `${CONTROL_PREFIX}${ariaIndex}`,\n        class: 'dot',\n        role: 'tab',\n        type: 'button',\n        tabindex: '-1',\n        'aria-controls': `${SLIDE_PREFIX}${ariaIndex}`,\n        'aria-label': `${ariaIndex} of ${slidesNumber}`,\n      },\n      `${ariaIndex}`,\n    );\n    const li = createTag('li', { role: 'presentation' }, btn);\n    dots.append(li);\n  });\n  return dots;\n}\n\nexport default async function decorate(block) {\n  const slides = createTag('div', { class: 'slides' });\n  let slideIndex = 1;\n  [...block.children].forEach((item) => {\n    const slide = createSlide(item, slideIndex);\n    if (slide) {\n      slideIndex += 1;\n      slides.append(slide);\n    }\n  });\n\n  slides.children[0].classList.add('active');\n  const dotsControls = createDotsControls(slides, block);\n\n  /* Add carousel action button if it exists */\n  const controlsElements = [dotsControls];\n  const button = block.querySelector('.button-container');\n  if (button) {\n    const slidesAction = createTag('div', { class: 'slides-action' });\n    slidesAction.append(button);\n    controlsElements.push(slidesAction);\n  }\n  const slidesControls = createTag('div', { class: 'slides-controls' }, controlsElements);\n  const slidesContainer = createTag('div', { class: 'slides-container' }, [slides, slidesControls]);\n  block.replaceChildren(slidesContainer);\n  updateControlsState(block, 0);\n  addDotsListeners(dotsControls, slides);\n  decorateIcons(block);\n}\n"],"names":["SLIDE_PREFIX","CONTROL_PREFIX","createSlide","item","index","quote","paragraph","author","description","createTag","getCurrentSlideIndex","slides","slide","updateControlsState","block","nextIndex","dots","currentActive","btn","nextActive","updateSlideState","currentIndex","translateX","addDotsListeners","dotsControls","dot","event","createDotsControls","slidesNumber","slideIndex","ariaIndex","li","decorate","controlsElements","button","slidesAction","slidesControls","slidesContainer","decorateIcons"],"mappings":"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"}