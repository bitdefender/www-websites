{"version":3,"file":"video.js","sources":["../../../src/blocks/video/video.js"],"sourcesContent":["/*\n * Video Block\n * Show a video referenced by a link\n * https://www.aem.live/developer/block-collection/video\n */\nfunction embedYoutube(url, autoplay) {\n  const usp = new URLSearchParams(url.search);\n  const suffix = autoplay ? '&muted=1&autoplay=1' : '';\n  let vid = usp.get('v') ? encodeURIComponent(usp.get('v')) : '';\n  const embed = url.pathname;\n  if (url.origin.includes('youtu.be')) {\n    [, vid] = url.pathname.split('/');\n  }\n  return `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://www.youtube.com${vid ? `/embed/${vid}?rel=0&v=${vid}${suffix}` : embed}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\"\n      allow=\"autoplay; fullscreen; picture-in-picture; encrypted-media; accelerometer; gyroscope; picture-in-picture\" allowfullscreen=\"\" scrolling=\"no\" title=\"Content from Youtube\" loading=\"lazy\"></iframe>\n    </div>`;\n}\n\nfunction embedVimeo(url, autoplay) {\n  const [, video] = url.pathname.split('/');\n  const suffix = autoplay ? '?muted=1&autoplay=1' : '';\n  return `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://player.vimeo.com/video/${video}${suffix}\"\n      style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\"\n      frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen\n      title=\"Content from Vimeo\" loading=\"lazy\"></iframe>\n    </div>`;\n}\n\nfunction getVideoElement(source, autoplay) {\n  const video = document.createElement('video');\n  video.setAttribute('controls', '');\n  video.dataset.loading = 'true';\n  video.addEventListener('loadedmetadata', () => delete video.dataset.loading);\n  if (autoplay) video.setAttribute('autoplay', '');\n\n  const sourceEl = document.createElement('source');\n  sourceEl.setAttribute('src', source);\n  sourceEl.setAttribute('type', `video/${source.split('.').pop()}`);\n  video.append(sourceEl);\n\n  return video;\n}\n\nconst loadVideoEmbed = (block, link, autoplay) => {\n  if (block.dataset.embedIsLoaded) {\n    return;\n  }\n  const url = new URL(link);\n\n  const isYoutube = link.includes('youtube') || link.includes('youtu.be');\n  const isVimeo = link.includes('vimeo');\n  const isMp4 = link.includes('.mp4');\n\n  if (isYoutube) {\n    block.innerHTML = embedYoutube(url, autoplay);\n  } else if (isVimeo) {\n    block.innerHTML = embedVimeo(url, autoplay);\n  } else if (isMp4) {\n    block.textContent = '';\n    block.append(getVideoElement(link, autoplay));\n  }\n\n  block.dataset.embedIsLoaded = true;\n};\n\nconst DESKTOP_ALIGN_ENUM = {\n  left: 'left',\n  right: 'right',\n  center: 'center',\n};\n\nfunction positionVideoContainer(block, desktopAlign) {\n  block.classList.add(DESKTOP_ALIGN_ENUM[desktopAlign] || DESKTOP_ALIGN_ENUM.LEFT);\n}\n\nexport default async function decorate(block) {\n  block.classList.add('default-content-wrapper');\n  block.closest('.section').style.padding = '0';\n  const { desktopAlign } = block.closest('.section').dataset; // left / middle / right\n  const placeholder = block.querySelector('picture');\n  const link = block.querySelector('a').href;\n  block.textContent = '';\n\n  positionVideoContainer(block, desktopAlign);\n\n  if (placeholder) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'video-placeholder';\n    wrapper.innerHTML = '<div class=\"video-placeholder-play\"><button type=\"button\" title=\"Play\"></button></div>';\n    wrapper.prepend(placeholder);\n    wrapper.addEventListener('click', () => {\n      loadVideoEmbed(block, link, true);\n    });\n    block.append(wrapper);\n  } else {\n    block.classList.add('lazy-loading');\n    const observer = new IntersectionObserver((entries) => {\n      if (entries.some((e) => e.isIntersecting)) {\n        observer.disconnect();\n        loadVideoEmbed(block, link, false);\n        block.classList.remove('lazy-loading');\n      }\n    });\n    observer.observe(block);\n  }\n}\n"],"names":[],"mappings":"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"}