{"version":3,"file":"video.js","sources":["../../../src/blocks/video/video.js"],"sourcesContent":["/*\n * Video Block\n * Show a video referenced by a link\n * https://www.aem.live/developer/block-collection/video\n */\nfunction embedYoutube(url, autoplay) {\n  const usp = new URLSearchParams(url.search);\n  const suffix = autoplay ? '&muted=1&autoplay=1' : '';\n  let vid = usp.get('v') ? encodeURIComponent(usp.get('v')) : '';\n  const embed = url.pathname;\n  if (url.origin.includes('youtu.be')) {\n    [, vid] = url.pathname.split('/');\n  }\n  return `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://www.youtube.com${vid ? `/embed/${vid}?rel=0&v=${vid}${suffix}` : embed}\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\"\n      allow=\"autoplay; fullscreen; picture-in-picture; encrypted-media; accelerometer; gyroscope; picture-in-picture\" allowfullscreen=\"\" scrolling=\"no\" title=\"Content from Youtube\" loading=\"lazy\"></iframe>\n    </div>`;\n}\n\nfunction embedVimeo(url, autoplay) {\n  const [, video] = url.pathname.split('/');\n  const suffix = autoplay ? '?muted=1&autoplay=1' : '';\n  return `<div style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;\">\n      <iframe src=\"https://player.vimeo.com/video/${video}${suffix}\"\n      style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\"\n      frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen\n      title=\"Content from Vimeo\" loading=\"lazy\"></iframe>\n    </div>`;\n}\n\nfunction getVideoElement(source, autoplay) {\n  const video = document.createElement('video');\n  video.setAttribute('controls', '');\n  video.dataset.loading = 'true';\n  video.addEventListener('loadedmetadata', () => delete video.dataset.loading);\n  if (autoplay) video.setAttribute('autoplay', '');\n\n  const sourceEl = document.createElement('source');\n  sourceEl.setAttribute('src', source);\n  sourceEl.setAttribute('type', `video/${source.split('.').pop()}`);\n  video.append(sourceEl);\n\n  return video;\n}\n\nconst loadVideoEmbed = (block, link, autoplay) => {\n  if (block.dataset.embedIsLoaded) {\n    return;\n  }\n  const url = new URL(link);\n\n  const isYoutube = link.includes('youtube') || link.includes('youtu.be');\n  const isVimeo = link.includes('vimeo');\n  const isMp4 = link.includes('.mp4');\n\n  if (isYoutube) {\n    block.innerHTML = embedYoutube(url, autoplay);\n  } else if (isVimeo) {\n    block.innerHTML = embedVimeo(url, autoplay);\n  } else if (isMp4) {\n    block.textContent = '';\n    block.append(getVideoElement(link, autoplay));\n  }\n\n  block.dataset.embedIsLoaded = true;\n};\n\nconst DESKTOP_ALIGN_ENUM = {\n  left: 'left',\n  right: 'right',\n  center: 'center',\n};\n\nfunction positionVideoContainer(block, desktopAlign) {\n  block.classList.add(DESKTOP_ALIGN_ENUM[desktopAlign] || DESKTOP_ALIGN_ENUM.LEFT);\n}\n\nexport default async function decorate(block) {\n  block.classList.add('default-content-wrapper');\n  block.closest('.section').style.padding = '0';\n  const { desktopAlign } = block.closest('.section').dataset; // left / middle / right\n  const placeholder = block.querySelector('picture');\n  const link = block.querySelector('a').href;\n  block.textContent = '';\n\n  positionVideoContainer(block, desktopAlign);\n\n  if (placeholder) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'video-placeholder';\n    wrapper.innerHTML = '<div class=\"video-placeholder-play\"><button type=\"button\" title=\"Play\"></button></div>';\n    wrapper.prepend(placeholder);\n    wrapper.addEventListener('click', () => {\n      loadVideoEmbed(block, link, true);\n    });\n    block.append(wrapper);\n  } else {\n    block.classList.add('lazy-loading');\n    const observer = new IntersectionObserver((entries) => {\n      if (entries.some((e) => e.isIntersecting)) {\n        observer.disconnect();\n        loadVideoEmbed(block, link, false);\n        block.classList.remove('lazy-loading');\n      }\n    });\n    observer.observe(block);\n  }\n}\n"],"names":["embedYoutube","url","autoplay","usp","suffix","vid","embed","embedVimeo","video","getVideoElement","source","sourceEl","loadVideoEmbed","block","link","isYoutube","isVimeo","isMp4","DESKTOP_ALIGN_ENUM","positionVideoContainer","desktopAlign","decorate","placeholder","wrapper","observer","entries","e"],"mappings":"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"}