{"version":3,"file":"webview.js","sources":["../../../src/blocks/webview/webview.js"],"sourcesContent":["import { getLanguageCountryFromPath } from '../../scripts/scripts.js';\n\nfunction getLanguage() {\n  // Try to get the language from the path\n  const langCountry = getLanguageCountryFromPath();\n  if (langCountry && langCountry.language && langCountry.country) {\n    return `${langCountry.language}-${langCountry.country}`;\n  }\n\n  // Try to get the language from the query parameter\n  const urlParams = new URLSearchParams(window.location.search);\n  const langFromQuery = urlParams.get('lang');\n  if (langFromQuery) {\n    return langFromQuery;\n  }\n\n  // Default to \"en-us\"\n  return 'en-us';\n}\n\nasync function checkAndReplacePrivacyPolicyLink(block) {\n  // Select the privacy-policy tag\n  const privacyPolicyTag = block.querySelector('.privacy-policy-text');\n  if (privacyPolicyTag) {\n    // Select the link inside the privacy-policy tag\n    const privacyPolicyLink = privacyPolicyTag.querySelector('a');\n    const locale = getLanguage().toLowerCase();\n    if (privacyPolicyLink) {\n      privacyPolicyLink.href = privacyPolicyLink.href.replace('locale', locale);\n      privacyPolicyLink.setAttribute('target', '_blank');\n      const response = await fetch(privacyPolicyLink.href);\n      if (response.status === 404) {\n        // Replace the link with the en-us version\n        privacyPolicyLink.href = 'https://www.bitdefender.com/en-us/site/view/legal-privacy-policy-for-home-users-solutions.html';\n      }\n    }\n  }\n}\n\nexport default async function decorate(block) {\n  const {\n    product, saveText,\n  } = block.closest('.section').dataset;\n\n  let prodName; let prodUsers; let prodYears;\n  if (product) {\n    [prodName, prodUsers, prodYears] = product.split('/');\n  }\n  block.setAttribute('data-store-context', '');\n  block.setAttribute('data-store-id', prodName);\n  block.setAttribute('data-store-option', `${prodUsers}-${prodYears}`);\n  block.setAttribute('data-store-department', 'consumer');\n  block.setAttribute('data-store-event', 'product-loaded');\n\n  const buyLink = block.querySelector('a[href*=\"#buylink\"]');\n  buyLink?.setAttribute('data-store-buy-link', '');\n\n  [...block.children].forEach((child) => {\n    if (child.textContent.includes('{PRICE_BOX}') && product) {\n      child.innerHTML = child.innerHTML.replace('{PRICE_BOX}', '<div class=\"price-box\">Price box</div>');\n      child.innerHTML = `\n      <div class=\"price-box\">\n        <div>\n          <span class=\"prod-oldprice\" data-store-price=\"full\" data-store-hide=\"no-price=discounted\"></span>\n          <span class=\"prod-percent\" data-store-hide=\"no-price=discounted\"> <span data-store-discount=\"percentage\"></span> ${saveText || ''} </span>\n        </div>\n        <div class=\"newprice-container mt-2\">\n          <span class=\"prod-newprice\"> <span data-store-price=\"discounted||full\"> </span></span>\n        </div>\n      </div>`;\n    }\n    if (child.textContent.includes('{under_price_text}')) {\n      // remove the p tag that is wrapping the text {under_price_text}\n      child.querySelector('p')?.remove();\n\n      child.classList.add('under-price-text');\n    }\n\n    if (child.textContent.includes('<privacy-policy-text>')) {\n      // remove the p tag that is wrapping the text {under_price_text}\n      child.querySelector('p')?.remove();\n\n      child.classList.add('privacy-policy-text');\n    }\n  });\n\n  const url = new URL(window.location.href);\n  if (url.searchParams.has('theme') && url.searchParams.get('theme') === 'dark') {\n    block.parentElement.classList.add('dark-mode');\n  }\n\n  await checkAndReplacePrivacyPolicyLink(block);\n\n  // Select the link with the #upgrade href\n  const upgradeLink = block.querySelector('a[href*=\"#upgrade\"]');\n  if (upgradeLink) {\n    // Modify the URL to set the feature parameter to main_ui\n    const upgradeUrl = new URL(window.location.href);\n    upgradeUrl.searchParams.set('feature', 'main_ui');\n    upgradeLink.href = upgradeUrl.toString();\n  }\n}\n"],"names":[],"mappings":"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"}