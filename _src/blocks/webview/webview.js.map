{"version":3,"file":"webview.js","sources":["../../../src/blocks/webview/webview.js"],"sourcesContent":["import { getLanguageCountryFromPath } from '../../scripts/scripts.js';\n\nfunction getLanguage() {\n  // Try to get the language from the path\n  const langCountry = getLanguageCountryFromPath();\n  if (langCountry && langCountry.language && langCountry.country) {\n    return `${langCountry.language}-${langCountry.country}`;\n  }\n\n  // Try to get the language from the query parameter\n  const urlParams = new URLSearchParams(window.location.search);\n  const langFromQuery = urlParams.get('lang');\n  if (langFromQuery) {\n    return langFromQuery;\n  }\n\n  // Default to \"en-us\"\n  return 'en-us';\n}\n\nasync function checkAndReplacePrivacyPolicyLink(block) {\n  // Select the privacy-policy tag\n  const privacyPolicyTag = block.querySelector('.privacy-policy-text');\n  if (privacyPolicyTag) {\n    // Select the link inside the privacy-policy tag\n    const privacyPolicyLink = privacyPolicyTag.querySelector('a');\n    const locale = getLanguage().toLowerCase();\n    if (privacyPolicyLink) {\n      privacyPolicyLink.href = privacyPolicyLink.href.replace('locale', locale);\n      privacyPolicyLink.setAttribute('target', '_blank');\n      const response = await fetch(privacyPolicyLink.href);\n      if (response.status === 404) {\n        // Replace the link with the en-us version\n        privacyPolicyLink.href = 'https://www.bitdefender.com/en-us/site/view/legal-privacy-policy-for-home-users-solutions.html';\n      }\n    }\n  }\n}\n\nexport default async function decorate(block) {\n  const {\n    product, saveText,\n  } = block.closest('.section').dataset;\n\n  let prodName; let prodUsers; let prodYears;\n  if (product) {\n    [prodName, prodUsers, prodYears] = product.split('/');\n  }\n  block.setAttribute('data-store-context', '');\n  block.setAttribute('data-store-id', prodName);\n  block.setAttribute('data-store-option', `${prodUsers}-${prodYears}`);\n  block.setAttribute('data-store-department', 'consumer');\n  block.setAttribute('data-store-event', 'product-loaded');\n\n  const buyLink = block.querySelector('a[href*=\"#buylink\"]');\n  buyLink?.setAttribute('data-store-buy-link', '');\n\n  [...block.children].forEach((child) => {\n    if (child.textContent.includes('{PRICE_BOX}') && product) {\n      child.innerHTML = child.innerHTML.replace('{PRICE_BOX}', '<div class=\"price-box\">Price box</div>');\n      child.innerHTML = `\n      <div class=\"price-box\">\n        <div>\n          <span class=\"prod-oldprice\" data-store-price=\"full\" data-store-hide=\"no-price=discounted\"></span>\n          <span class=\"prod-percent\" data-store-hide=\"no-price=discounted\"> <span data-store-discount=\"percentage\"></span> ${saveText || ''} </span>\n        </div>\n        <div class=\"newprice-container mt-2\">\n          <span class=\"prod-newprice\"> <span data-store-price=\"discounted||full\"> </span></span>\n        </div>\n      </div>`;\n    }\n    if (child.textContent.includes('{under_price_text}')) {\n      // remove the p tag that is wrapping the text {under_price_text}\n      child.querySelector('p')?.remove();\n\n      child.classList.add('under-price-text');\n    }\n\n    if (child.textContent.includes('<privacy-policy-text>')) {\n      // remove the p tag that is wrapping the text {under_price_text}\n      child.querySelector('p')?.remove();\n\n      child.classList.add('privacy-policy-text');\n    }\n  });\n\n  const url = new URL(window.location.href);\n  if (url.searchParams.has('theme') && url.searchParams.get('theme') === 'dark') {\n    block.parentElement.classList.add('dark-mode');\n  }\n\n  await checkAndReplacePrivacyPolicyLink(block);\n\n  // Select the link with the #upgrade href\n  const upgradeLink = block.querySelector('a[href*=\"#upgrade\"]');\n  if (upgradeLink) {\n    // Modify the URL to set the feature parameter to main_ui\n    const upgradeUrl = new URL(window.location.href);\n    upgradeUrl.searchParams.set('feature', 'main_ui');\n    upgradeLink.href = upgradeUrl.toString();\n  }\n}\n"],"names":["getLanguage","langCountry","getLanguageCountryFromPath","langFromQuery","checkAndReplacePrivacyPolicyLink","block","privacyPolicyTag","privacyPolicyLink","locale","decorate","product","saveText","prodName","prodUsers","prodYears","child","url","upgradeLink","upgradeUrl"],"mappings":"sEAEA,SAASA,GAAc,CAErB,MAAMC,EAAcC,EAA4B,EAChD,GAAID,GAAeA,EAAY,UAAYA,EAAY,QACrD,MAAO,GAAGA,EAAY,QAAQ,IAAIA,EAAY,OAAO,GAKvD,MAAME,EADY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAC5B,IAAI,MAAM,EAC1C,OAAIA,GAKG,OACT,CAEA,eAAeC,EAAiCC,EAAO,CAErD,MAAMC,EAAmBD,EAAM,cAAc,sBAAsB,EACnE,GAAIC,EAAkB,CAEpB,MAAMC,EAAoBD,EAAiB,cAAc,GAAG,EACtDE,EAASR,EAAa,EAAC,YAAa,EACtCO,IACFA,EAAkB,KAAOA,EAAkB,KAAK,QAAQ,SAAUC,CAAM,EACxED,EAAkB,aAAa,SAAU,QAAQ,GAChC,MAAM,MAAMA,EAAkB,IAAI,GACtC,SAAW,MAEtBA,EAAkB,KAAO,kGAGjC,CACA,CAEe,eAAeE,EAASJ,EAAO,CAC5C,KAAM,CACJ,QAAAK,EAAS,SAAAC,CACV,EAAGN,EAAM,QAAQ,UAAU,EAAE,QAE9B,IAAIO,EAAcC,EAAeC,EAC7BJ,IACF,CAACE,EAAUC,EAAWC,CAAS,EAAIJ,EAAQ,MAAM,GAAG,GAEtDL,EAAM,aAAa,qBAAsB,EAAE,EAC3CA,EAAM,aAAa,gBAAiBO,CAAQ,EAC5CP,EAAM,aAAa,oBAAqB,GAAGQ,CAAS,IAAIC,CAAS,EAAE,EACnET,EAAM,aAAa,wBAAyB,UAAU,EACtDA,EAAM,aAAa,mBAAoB,gBAAgB,EAEvCA,EAAM,cAAc,qBAAqB,GAChD,aAAa,sBAAuB,EAAE,EAE/C,CAAC,GAAGA,EAAM,QAAQ,EAAE,QAASU,GAAU,CACjCA,EAAM,YAAY,SAAS,aAAa,GAAKL,IAC/CK,EAAM,UAAYA,EAAM,UAAU,QAAQ,cAAe,wCAAwC,EACjGA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA,6HAIqGJ,GAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,eAOnII,EAAM,YAAY,SAAS,oBAAoB,IAEjDA,EAAM,cAAc,GAAG,GAAG,OAAQ,EAElCA,EAAM,UAAU,IAAI,kBAAkB,GAGpCA,EAAM,YAAY,SAAS,uBAAuB,IAEpDA,EAAM,cAAc,GAAG,GAAG,OAAQ,EAElCA,EAAM,UAAU,IAAI,qBAAqB,EAE/C,CAAG,EAED,MAAMC,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EACpCA,EAAI,aAAa,IAAI,OAAO,GAAKA,EAAI,aAAa,IAAI,OAAO,IAAM,QACrEX,EAAM,cAAc,UAAU,IAAI,WAAW,EAG/C,MAAMD,EAAiCC,CAAK,EAG5C,MAAMY,EAAcZ,EAAM,cAAc,qBAAqB,EAC7D,GAAIY,EAAa,CAEf,MAAMC,EAAa,IAAI,IAAI,OAAO,SAAS,IAAI,EAC/CA,EAAW,aAAa,IAAI,UAAW,SAAS,EAChDD,EAAY,KAAOC,EAAW,SAAU,CAC5C,CACA"}