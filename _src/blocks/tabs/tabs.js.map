{"version":3,"file":"tabs.js","sources":["../../../src/blocks/tabs/tabs.js"],"sourcesContent":["/**\n * @typedef TabInfo\n * @property {string} name\n * @property {HTMLElement} $tab\n * @property {HTMLElement} $content\n */\n\nimport {\n  readBlockConfig,\n} from '../../scripts/lib-franklin.js';\n\nfunction isMobileScreenSize() {\n  return !window.matchMedia('(min-width: 900px)').matches;\n}\n\nfunction showMenuItems(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  const transitionEndCallback = () => {\n    content.removeEventListener('transitionend', transitionEndCallback);\n    content.style.height = 'auto';\n  };\n  content.addEventListener('transitionend', transitionEndCallback);\n  content.classList.add('expanded');\n}\n\nfunction hideMenuItems(content) {\n  content.style.height = `${content.scrollHeight}px`;\n  requestAnimationFrame(() => {\n    content.classList.remove('expanded');\n    content.style.height = 0;\n  });\n}\n\nfunction toggleMenu(dropDownMenu) {\n  const $ul = dropDownMenu.nextElementSibling;\n\n  if (dropDownMenu.classList.contains('opened')) {\n    hideMenuItems($ul);\n    dropDownMenu.classList.remove('opened');\n  } else {\n    showMenuItems($ul);\n    dropDownMenu.classList.add('opened');\n  }\n}\n\nfunction createTabsNavigation(block) {\n  const tabsNavigation = document.createElement('div');\n  tabsNavigation.classList.add('tabs-navigation');\n  block.appendChild(tabsNavigation);\n\n  const dropDownMenu = document.createElement('div');\n  dropDownMenu.classList.add('dropdown-menu');\n  tabsNavigation.appendChild(dropDownMenu);\n\n  const $ul = document.createElement('ul');\n  $ul.setAttribute('role', 'tablist');\n  if (!isMobileScreenSize()) {\n    $ul.classList.add('expanded');\n  }\n  tabsNavigation.appendChild($ul);\n\n  dropDownMenu.addEventListener('click', (event) => {\n    event.preventDefault();\n    toggleMenu(dropDownMenu);\n  });\n\n  return {\n    dropDownMenu, $ul,\n  };\n}\n\n/**\n * @param {HTMLElement} block\n * @return {TabInfo[]}\n */\nexport function createTabs(block) {\n  const config = readBlockConfig(block);\n  block.innerHTML = '';\n\n  const tabsSelector = config['tab-group']\n    ? `[data-tab-group=\"${config['tab-group']}\"][data-tab]`\n    : '[data-tab]';\n\n  /** @type TabInfo[] */\n  const tabs = [];\n  const {\n    dropDownMenu, $ul,\n  } = createTabsNavigation(block);\n\n  const $sections = document.querySelectorAll(tabsSelector);\n\n  [...$sections].forEach(($tabContent, index) => {\n    const title = $tabContent.dataset.tab;\n    const name = title.toLowerCase().trim();\n\n    const $li = document.createElement('li');\n    $li.classList.add('tab');\n    $li.setAttribute('role', 'tab');\n    $li.setAttribute('tabindex', index === 0 ? '0' : '-1');\n    $li.setAttribute('aria-selected', index === 0 ? 'true' : 'false');\n    $li.setAttribute('id', `tab-${index}`);\n    $li.innerText = title;\n\n    $ul.appendChild($li);\n\n    const tabContentDiv = document.createElement('div');\n    tabContentDiv.classList.add('tab-item');\n    tabContentDiv.classList.add('hidden');\n    tabContentDiv.setAttribute('role', 'tabpanel');\n    tabContentDiv.setAttribute('aria-labelledby', `tab-${index}`);\n    tabContentDiv.append(...$tabContent.children);\n\n    block.appendChild(tabContentDiv);\n    $tabContent.remove();\n\n    if (index === 0) {\n      $li.classList.add('active');\n      tabContentDiv.classList.remove('hidden');\n      dropDownMenu.innerText = title;\n    }\n\n    tabs.push({\n      name,\n      $tab: $li,\n      $content: tabContentDiv,\n    });\n  });\n\n  return tabs;\n}\n\n/**\n * @param {HTMLElement} block\n */\nexport default function decorate(block) {\n  const tabs = createTabs(block);\n  const dropDownMenu = block.querySelector('.dropdown-menu');\n\n  /**\n   * Activează un tab\n   * @param {number} index\n   * @param {{ toggleDropdown?: boolean }} options\n   */\n  function activateTab(index, { toggleDropdown = true } = {}) {\n    tabs.forEach((t, i) => {\n      const isActive = i === index;\n\n      t.$tab.setAttribute('aria-selected', isActive ? 'true' : 'false');\n      t.$tab.setAttribute('tabindex', isActive ? '0' : '-1');\n      t.$tab.classList.toggle('active', isActive);\n      t.$content.classList.toggle('hidden', !isActive);\n    });\n\n    tabs[index].$tab.focus();\n    dropDownMenu.innerText = tabs[index].$tab.innerText;\n\n    if (isMobileScreenSize() && toggleDropdown) {\n      toggleMenu(dropDownMenu);\n    }\n  }\n\n  tabs.forEach((tab, index) => {\n    tab.$tab.addEventListener('click', () => {\n      if (tab.$tab.getAttribute('aria-selected') !== 'true') {\n        activateTab(index); // toggleDropdown = true (default)\n      }\n    });\n\n    tab.$tab.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        activateTab(index); // suport și pentru Enter / Space\n      }\n    });\n  });\n\n  block.addEventListener('keydown', (e) => {\n    const focusedTab = document.activeElement;\n    if (focusedTab.getAttribute('role') !== 'tab') return;\n\n    const currentIndex = tabs.findIndex((t) => t.$tab === focusedTab);\n    let newIndex = currentIndex;\n\n    switch (e.key) {\n      case 'ArrowRight':\n        newIndex = (currentIndex + 1) % tabs.length;\n        break;\n      case 'ArrowLeft':\n        newIndex = (currentIndex - 1 + tabs.length) % tabs.length;\n        break;\n      case 'Home':\n        newIndex = 0;\n        break;\n      case 'End':\n        newIndex = tabs.length - 1;\n        break;\n      default:\n        return;\n    }\n\n    e.preventDefault();\n    activateTab(newIndex, { toggleDropdown: false });\n  });\n}\n"],"names":["isMobileScreenSize","showMenuItems","content","transitionEndCallback","hideMenuItems","toggleMenu","dropDownMenu","$ul","createTabsNavigation","block","tabsNavigation","event","createTabs","config","readBlockConfig","tabsSelector","tabs","$tabContent","index","title","name","$li","tabContentDiv","decorate","activateTab","toggleDropdown","t","i","isActive","tab","e","focusedTab","currentIndex","newIndex"],"mappings":"gEAWA,SAASA,GAAqB,CAC5B,MAAO,CAAC,OAAO,WAAW,oBAAoB,EAAE,OAClD,CAEA,SAASC,EAAcC,EAAS,CAC9BA,EAAQ,MAAM,OAAS,GAAGA,EAAQ,YAAY,KAC9C,MAAMC,EAAwB,IAAM,CAClCD,EAAQ,oBAAoB,gBAAiBC,CAAqB,EAClED,EAAQ,MAAM,OAAS,MACxB,EACDA,EAAQ,iBAAiB,gBAAiBC,CAAqB,EAC/DD,EAAQ,UAAU,IAAI,UAAU,CAClC,CAEA,SAASE,EAAcF,EAAS,CAC9BA,EAAQ,MAAM,OAAS,GAAGA,EAAQ,YAAY,KAC9C,sBAAsB,IAAM,CAC1BA,EAAQ,UAAU,OAAO,UAAU,EACnCA,EAAQ,MAAM,OAAS,CAC3B,CAAG,CACH,CAEA,SAASG,EAAWC,EAAc,CAChC,MAAMC,EAAMD,EAAa,mBAErBA,EAAa,UAAU,SAAS,QAAQ,GAC1CF,EAAcG,CAAG,EACjBD,EAAa,UAAU,OAAO,QAAQ,IAEtCL,EAAcM,CAAG,EACjBD,EAAa,UAAU,IAAI,QAAQ,EAEvC,CAEA,SAASE,EAAqBC,EAAO,CACnC,MAAMC,EAAiB,SAAS,cAAc,KAAK,EACnDA,EAAe,UAAU,IAAI,iBAAiB,EAC9CD,EAAM,YAAYC,CAAc,EAEhC,MAAMJ,EAAe,SAAS,cAAc,KAAK,EACjDA,EAAa,UAAU,IAAI,eAAe,EAC1CI,EAAe,YAAYJ,CAAY,EAEvC,MAAMC,EAAM,SAAS,cAAc,IAAI,EACvC,OAAAA,EAAI,aAAa,OAAQ,SAAS,EAC7BP,EAAkB,GACrBO,EAAI,UAAU,IAAI,UAAU,EAE9BG,EAAe,YAAYH,CAAG,EAE9BD,EAAa,iBAAiB,QAAUK,GAAU,CAChDA,EAAM,eAAgB,EACtBN,EAAWC,CAAY,CAC3B,CAAG,EAEM,CACL,aAAAA,EAAc,IAAAC,CACf,CACH,CAMO,SAASK,EAAWH,EAAO,CAChC,MAAMI,EAASC,EAAgBL,CAAK,EACpCA,EAAM,UAAY,GAElB,MAAMM,EAAeF,EAAO,WAAW,EACnC,oBAAoBA,EAAO,WAAW,CAAC,eACvC,aAGEG,EAAO,CAAE,EACT,CACJ,aAAAV,EAAc,IAAAC,CAClB,EAAMC,EAAqBC,CAAK,EAI9B,OAAC,GAFiB,SAAS,iBAAiBM,CAAY,CAE3C,EAAE,QAAQ,CAACE,EAAaC,IAAU,CAC7C,MAAMC,EAAQF,EAAY,QAAQ,IAC5BG,EAAOD,EAAM,YAAW,EAAG,KAAM,EAEjCE,EAAM,SAAS,cAAc,IAAI,EACvCA,EAAI,UAAU,IAAI,KAAK,EACvBA,EAAI,aAAa,OAAQ,KAAK,EAC9BA,EAAI,aAAa,WAAYH,IAAU,EAAI,IAAM,IAAI,EACrDG,EAAI,aAAa,gBAAiBH,IAAU,EAAI,OAAS,OAAO,EAChEG,EAAI,aAAa,KAAM,OAAOH,CAAK,EAAE,EACrCG,EAAI,UAAYF,EAEhBZ,EAAI,YAAYc,CAAG,EAEnB,MAAMC,EAAgB,SAAS,cAAc,KAAK,EAClDA,EAAc,UAAU,IAAI,UAAU,EACtCA,EAAc,UAAU,IAAI,QAAQ,EACpCA,EAAc,aAAa,OAAQ,UAAU,EAC7CA,EAAc,aAAa,kBAAmB,OAAOJ,CAAK,EAAE,EAC5DI,EAAc,OAAO,GAAGL,EAAY,QAAQ,EAE5CR,EAAM,YAAYa,CAAa,EAC/BL,EAAY,OAAQ,EAEhBC,IAAU,IACZG,EAAI,UAAU,IAAI,QAAQ,EAC1BC,EAAc,UAAU,OAAO,QAAQ,EACvChB,EAAa,UAAYa,GAG3BH,EAAK,KAAK,CACR,KAAAI,EACA,KAAMC,EACN,SAAUC,CAChB,CAAK,CACL,CAAG,EAEMN,CACT,CAKe,SAASO,EAASd,EAAO,CACtC,MAAMO,EAAOJ,EAAWH,CAAK,EACvBH,EAAeG,EAAM,cAAc,gBAAgB,EAOzD,SAASe,EAAYN,EAAO,CAAE,eAAAO,EAAiB,EAAI,EAAK,CAAA,EAAI,CAC1DT,EAAK,QAAQ,CAACU,EAAGC,IAAM,CACrB,MAAMC,EAAWD,IAAMT,EAEvBQ,EAAE,KAAK,aAAa,gBAAiBE,EAAW,OAAS,OAAO,EAChEF,EAAE,KAAK,aAAa,WAAYE,EAAW,IAAM,IAAI,EACrDF,EAAE,KAAK,UAAU,OAAO,SAAUE,CAAQ,EAC1CF,EAAE,SAAS,UAAU,OAAO,SAAU,CAACE,CAAQ,CACrD,CAAK,EAEDZ,EAAKE,CAAK,EAAE,KAAK,MAAO,EACxBZ,EAAa,UAAYU,EAAKE,CAAK,EAAE,KAAK,UAEtClB,EAAoB,GAAIyB,GAC1BpB,EAAWC,CAAY,CAE7B,CAEEU,EAAK,QAAQ,CAACa,EAAKX,IAAU,CAC3BW,EAAI,KAAK,iBAAiB,QAAS,IAAM,CACnCA,EAAI,KAAK,aAAa,eAAe,IAAM,QAC7CL,EAAYN,CAAK,CAEzB,CAAK,EAEDW,EAAI,KAAK,iBAAiB,UAAYC,GAAM,EACtCA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,OACjCA,EAAE,eAAgB,EAClBN,EAAYN,CAAK,EAEzB,CAAK,CACL,CAAG,EAEDT,EAAM,iBAAiB,UAAYqB,GAAM,CACvC,MAAMC,EAAa,SAAS,cAC5B,GAAIA,EAAW,aAAa,MAAM,IAAM,MAAO,OAE/C,MAAMC,EAAehB,EAAK,UAAWU,GAAMA,EAAE,OAASK,CAAU,EAChE,IAAIE,EAAWD,EAEf,OAAQF,EAAE,IAAG,CACX,IAAK,aACHG,GAAYD,EAAe,GAAKhB,EAAK,OACrC,MACF,IAAK,YACHiB,GAAYD,EAAe,EAAIhB,EAAK,QAAUA,EAAK,OACnD,MACF,IAAK,OACHiB,EAAW,EACX,MACF,IAAK,MACHA,EAAWjB,EAAK,OAAS,EACzB,MACF,QACE,MACR,CAEIc,EAAE,eAAgB,EAClBN,EAAYS,EAAU,CAAE,eAAgB,EAAK,CAAE,CACnD,CAAG,CACH"}