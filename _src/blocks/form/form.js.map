{"version":3,"file":"form.js","sources":["../../../src/blocks/form/form.js"],"sourcesContent":["import { debounce } from '@repobit/dex-utils';\n\nasync function fetchData(url) {\n  const resp = await fetch(url);\n  const json = await resp.json();\n  return json.data;\n}\n\n/**\n *\n * @param {String} email\n * @returns {Boolean} wether the email passed is valid or not\n */\nconst validateEmail = (email) => {\n  const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(email.toLowerCase());\n};\n\n/**\n *\n * @param {HTMLInputElement} inputElement\n * @returns {Boolean} validation status of the field\n */\nconst checkInputValue = (inputElement) => {\n  // real time field validation for the email field (For DIP only)\n  switch (inputElement.type) {\n    case 'email':\n      // validate the email inputs using the validation function if there are error fields\n      if (!validateEmail(inputElement.value)) {\n        return false;\n      }\n\n      break;\n    case 'checkbox':\n      if (!inputElement.checked && inputElement.required) {\n        return false;\n      }\n\n      break;\n    default:\n      break;\n  }\n\n  return true;\n};\n\n/**\n *\n * @param {HTMLInputElement} inputElement\n */\nconst displayInputError = (inputElement) => {\n  const inputElementError = inputElement.parentElement.querySelector('.input-error-field');\n  if (inputElementError) {\n    inputElementError.classList.remove('global-display-none');\n  }\n};\n\n/**\n *\n * @param {HTMLInputElement} inputElement\n */\nconst hideInputError = (inputElement) => {\n  const inputElementError = inputElement.parentElement.querySelector('.input-error-field');\n  if (inputElementError) {\n    inputElementError.classList.add('global-display-none');\n  }\n};\n\n/**\n *\n * @param {HTMLFormElement} form\n * set the onChange function for all the form inputs\n */\nfunction checkFormValues(form) {\n  const submitButton = form.querySelector('input[type=\"submit\"]');\n\n  // Targeting the anchor inside .button-container\n  const allInputFields = form.querySelectorAll('input:not([type=\"hidden\"])');\n  let disabledStatus = false;\n  allInputFields.forEach((inputField) => {\n    if (!disabledStatus && !checkInputValue(inputField)) {\n      disabledStatus = true;\n    }\n  });\n\n  submitButton.disabled = disabledStatus;\n}\n\nasync function handleSubmit(e, handler) {\n  e.preventDefault();\n  try {\n    const mod = await import(handler);\n    if (mod.default) await mod.default(e);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.log('failed to load module for lib-identity-exposed-onsubmit', error);\n  }\n}\n\n/**\n *\n * @param {HTMLInputElement} input the input to be adde inside the div wrapper\n * @param {HTMLDivElement} newDivParent the div wrapper to hold the input\n */\nconst wrapInputInsideDiv = (input, newDivParent) => {\n  const label = input.nextElementSibling;\n\n  // if the input has a label, also add it inside the wrapper\n  if (label && label.tagName === 'LABEL') {\n    input.before(newDivParent);\n    newDivParent.append(input, label);\n  } else {\n    input.after(newDivParent);\n    newDivParent.append(input);\n  }\n};\n\n/**\n *\n * @param {HTMLInputElement} input\n * @param {HTMLFormElement} form\n * add the validations which get triggered whenever an input is filled with data\n */\nconst addInputValidation = (input, form) => {\n  if (input.dataset.containsErrorField && checkInputValue(input)) {\n    hideInputError(input);\n  } else if (input.dataset.containsErrorField) {\n    displayInputError(input);\n  }\n\n  checkFormValues(form);\n};\n\n/**\n *\n * @param {string} formURL url to form html\n * @returns {Promise<HTMLFormElement>} returns the form\n */\nexport async function createForm(formURL) {\n  const { pathname, search } = new URL(formURL);\n  const data = await fetchData(`${pathname}${search}`);\n  const form = document.createElement('form');\n\n  form.setAttribute('method', 'post');\n\n  data.forEach((field, index) => {\n    const input = document.createElement('input');\n    input.id = `form-${index}-${field.Field}`;\n    input.setAttribute('type', field.Type);\n    input.setAttribute('name', field.Field);\n    input.setAttribute('placeholder', field.Default);\n    input.setAttribute('value', field.Value);\n    input.setAttribute('data-contains-error-field', Boolean(field.Error));\n\n    // add event listeners to the fields\n    input.addEventListener('input', debounce(() => addInputValidation(input, form), 100, false));\n\n    if (field.Required && field.Required.toLowerCase() === 'true') {\n      input.setAttribute('required', '');\n      input.setAttribute('aria-required', 'true');\n    }\n\n    form.append(input);\n\n    // Only create a label if the field.Label is not null\n    if (field.Label) {\n      const label = document.createElement('label');\n      label.setAttribute('for', input.id);\n      label.textContent = field.Label;\n      form.append(label);\n    }\n\n    if (field.Type === 'submit') {\n      input.classList.add('disabled');\n      input.disabled = true;\n    }\n\n    if (field.Field === 'handler') {\n      form.addEventListener('submit', (e) => handleSubmit(e, field.Value));\n    }\n\n    if (field.Type === 'checkbox') {\n      const newDivWrapper = document.createElement('div');\n      newDivWrapper.classList.add('checkbox');\n\n      wrapInputInsideDiv(input, newDivWrapper);\n    }\n\n    if (field.Error) {\n      const newDivWrapper = document.createElement('div');\n      newDivWrapper.classList.add('input-container-with-error');\n\n      // add the error field\n      const errorField = document.createElement('p');\n      errorField.classList.add('input-error-field', 'global-display-none');\n      errorField.textContent = field.Error;\n      newDivWrapper.appendChild(errorField);\n      input.classList.add('input-with-error-field');\n\n      wrapInputInsideDiv(input, newDivWrapper);\n    }\n  });\n  return form;\n}\n\nexport default async function decorate(block) {\n  const form = await createForm(block.textContent.trim());\n  if (form) block.append(form);\n}\n"],"names":[],"mappings":"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"}