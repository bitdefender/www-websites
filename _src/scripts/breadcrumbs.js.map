{"version":3,"file":"breadcrumbs.js","sources":["../../src/scripts/breadcrumbs.js"],"sourcesContent":["import {\n  createTag,\n  fetchIndex,\n  fixExcelFilterZeroes,\n  getDomain,\n  decorateBlockWithRegionId,\n} from './utils/utils.js';\n\nfunction prependSlash(path) {\n  return path.startsWith('/') ? path : `/${path}`;\n}\n\nfunction getName(pageIndex, path, part, current) {\n  const pg = pageIndex.find((page) => page.path.replace(/^\\/[^/]+/, '') === path.replace(/^\\/[^/]+/, ''));\n  if (pg && pg.breadcrumbtitle && pg.breadcrumbtitle !== '0') {\n    return pg.breadcrumbtitle;\n  }\n\n  if (pg && pg.title && pg.title !== '0') {\n    return pg.title;\n  }\n\n  if (current) {\n    return document.title;\n  }\n\n  return part;\n}\n\nfunction renderBreadcrumb(breadcrumbs) {\n  return createTag(\n    'a',\n    { href: breadcrumbs.url_path ? breadcrumbs.url_path : '#' },\n    breadcrumbs.name,\n  );\n}\n\nasync function createBreadcrumbs(container) {\n  const { pathname } = window.location;\n  const pathSeparator = '/';\n  // split pathname into parts add / at the end and remove empty parts\n  const domain = getDomain();\n  const pathSplit = pathname.split('/').filter((item) => item !== domain).reduce((acc, curr, index, array) => {\n    if (index < array.length - 1) {\n      acc.push(`${curr}/`);\n    } else if (curr !== '') {\n      acc.push(curr);\n    }\n    return acc;\n  }, []);\n\n  const pageIndex = (await fetchIndex('query-index')).data;\n  fixExcelFilterZeroes(pageIndex);\n  // eslint-disable-next-line max-len\n  const urlForIndex = (index) => prependSlash(pathSplit.slice(1, index + 2).join(pathSeparator));\n\n  const breadcrumbs = [\n    {\n      name: 'Home',\n      url_path: `/${domain}/`,\n    },\n    ...pathSplit.slice(1, -1).map((part, index) => {\n      const url = urlForIndex(index);\n      return {\n        name: getName(pageIndex, `/${domain}${url}`, part, false, domain),\n        url_path: `/${domain}${url}`,\n      };\n    }),\n    {\n      // get the breadcrumb title from the metadata; if the metadata does not contain it,\n      // the last part of the path is used as the breadcrumb title\n      name: getName(pageIndex, pathname, pathSplit[pathSplit.length - 1], true, domain),\n    },\n  ];\n\n  breadcrumbs.forEach((crumb) => {\n    if (crumb.name) {\n      container.append(renderBreadcrumb(crumb));\n    }\n  });\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function loadBreadcrumbs() {\n  const breadcrumb = document.querySelector('.breadcrumb');\n  decorateBlockWithRegionId(breadcrumb, 'Hero|Breadcrumb');\n\n  // check if breadcrumb div exists\n  if (breadcrumb) {\n    await createBreadcrumbs(breadcrumb);\n  }\n}\n"],"names":["prependSlash","path","getName","pageIndex","part","current","pg","page","renderBreadcrumb","breadcrumbs","createTag","createBreadcrumbs","container","pathname","pathSeparator","domain","getDomain","pathSplit","item","acc","curr","index","array","fetchIndex","fixExcelFilterZeroes","urlForIndex","url","crumb","loadBreadcrumbs","breadcrumb","decorateBlockWithRegionId"],"mappings":"qIAQA,SAASA,EAAaC,EAAM,CAC1B,OAAOA,EAAK,WAAW,GAAG,EAAIA,EAAO,IAAIA,CAAI,EAC/C,CAEA,SAASC,EAAQC,EAAWF,EAAMG,EAAMC,EAAS,CAC/C,MAAMC,EAAKH,EAAU,KAAMI,GAASA,EAAK,KAAK,QAAQ,WAAY,EAAE,IAAMN,EAAK,QAAQ,WAAY,EAAE,CAAC,EACtG,OAAIK,GAAMA,EAAG,iBAAmBA,EAAG,kBAAoB,IAC9CA,EAAG,gBAGRA,GAAMA,EAAG,OAASA,EAAG,QAAU,IAC1BA,EAAG,MAGRD,EACK,SAAS,MAGXD,CACT,CAEA,SAASI,EAAiBC,EAAa,CACrC,OAAOC,EACL,IACA,CAAE,KAAMD,EAAY,SAAWA,EAAY,SAAW,GAAK,EAC3DA,EAAY,IACb,CACH,CAEA,eAAeE,EAAkBC,EAAW,CAC1C,KAAM,CAAE,SAAAC,GAAa,OAAO,SACtBC,EAAgB,IAEhBC,EAASC,EAAW,EACpBC,EAAYJ,EAAS,MAAM,GAAG,EAAE,OAAQK,GAASA,IAASH,CAAM,EAAE,OAAO,CAACI,EAAKC,EAAMC,EAAOC,KAC5FD,EAAQC,EAAM,OAAS,EACzBH,EAAI,KAAK,GAAGC,CAAI,GAAG,EACVA,IAAS,IAClBD,EAAI,KAAKC,CAAI,EAERD,GACN,EAAE,EAEChB,GAAa,MAAMoB,EAAW,aAAa,GAAG,KACpDC,EAAqBrB,CAAS,EAE9B,MAAMsB,EAAeJ,GAAUrB,EAAaiB,EAAU,MAAM,EAAGI,EAAQ,CAAC,EAAE,KAAKP,CAAa,CAAC,EAEzE,CAClB,CACE,KAAM,OACN,SAAU,IAAIC,CAAM,GACrB,EACD,GAAGE,EAAU,MAAM,EAAG,EAAE,EAAE,IAAI,CAACb,EAAMiB,IAAU,CAC7C,MAAMK,EAAMD,EAAYJ,CAAK,EAC7B,MAAO,CACL,KAAMnB,EAAQC,EAAW,IAAIY,CAAM,GAAGW,CAAG,GAAItB,EAAM,EAAa,EAChE,SAAU,IAAIW,CAAM,GAAGW,CAAG,EAC3B,CACP,CAAK,EACD,CAGE,KAAMxB,EAAQC,EAAWU,EAAUI,EAAUA,EAAU,OAAS,CAAC,EAAG,EAAY,CACjF,CACF,EAEW,QAASU,GAAU,CACzBA,EAAM,MACRf,EAAU,OAAOJ,EAAiBmB,CAAK,CAAC,CAE9C,CAAG,CACH,CAGO,eAAeC,GAAkB,CACtC,MAAMC,EAAa,SAAS,cAAc,aAAa,EACvDC,EAA0BD,EAAY,iBAAiB,EAGnDA,GACF,MAAMlB,EAAkBkB,CAAU,CAEtC"}