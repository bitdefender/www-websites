const b=(e,{option:r})=>{if(!e)return!1;switch(e){case"no-price":return!r.getPrice();case"no-price-discounted":return!r.getDiscountedPrice();default:return!0}},g=(e,r,a,i)=>{let c=!1;for(const n of a){switch(n){case"DEVICES":e=e.replaceAll(i,r.option.getDevices()),c=!0;break;case"YEARS":e=e.replaceAll(i,r.option.getSubscription("years")),c=!0;break;case"PRICE_FULL":if(!r.option.getPrice("valueWithCurrency"))break;e=e.replaceAll(i,r.option.getPrice("valueWithCurrency")),c=!0;break;case"PRICE_DISCOUNTED":if(!r.option.getDiscountedPrice("valueWithCurrency"))break;e=e.replaceAll(i,r.option.getDiscountedPrice("valueWithCurrency")),c=!0;break;case"PRICE_FULL_MONTHLY":if(!r.option.getPrice("monthlyWithCurrency"))break;e=e.replaceAll(i,r.option.getPrice("monthlyWithCurrency")),c=!0;break;case"PRICE_DISCOUNTED_MONTHLY":if(!r.option.getDiscountedPrice("monthlyWithCurrency"))break;e=e.replaceAll(i,r.option.getDiscountedPrice("monthlyWithCurrency")),c=!0;break;case"DISCOUNT_PERCENTAGE":if(!r.option.getDiscount("percentageWithProcent"))break;e=e.replaceAll(i,r.option.getDiscount("percentageWithProcent")),c=!0;break;case"DISCOUNT_VALUE":if(!r.option.getDiscount("valueWithCurrency"))break;e=e.replaceAll(i,r.option.getDiscount("valueWithCurrency")),c=!0;break;case"SMALLEST_PRICE":{let o=Number.MAX_SAFE_INTEGER,s="";if(r.contexts.length===0)break;for(const{product:d}of r.contexts){const t=d.getSmallestPrice("value");t&&t<o&&(o=t,s=d.getCurrency())}if(o===Number.MAX_SAFE_INTEGER)break;e=e.replaceAll(i,Store.placeSymbol(o,s)),c=!0;break}case"SMALLEST_PRICE_PER_MONTH":let l=Number.MAX_SAFE_INTEGER,p="";if(r.contextProducts.length===0)break;for(const o of r.contextProducts){const s=o.getSmallestPrice("monthly");s&&s<l&&(l=s,p=o.getCurrency())}if(l===Number.MAX_SAFE_INTEGER)break;e=e.replaceAll(i,Store.placeSymbol(l,p)),c=!0;break;case"SERVER_NUMBER":case"MAIL_BOX_NUMBER":const u=a.find(o=>o.includes("DISCOUNT="))?.split("=")[1];if(!u&&!Number(u))break;e=e.replaceAll(i,Math.ceil(r.option.getDevices()*Number(u)/100)),c=!0;break;case"MINIMUM_DEVICES_NUMBER":e=e.replaceAll(i,r.product.getMinMaxDeviceNumbers()[0]),c=!0;break;case"MAXIMUM_DEVICES_NUMBER":e=e.replaceAll(i,r.product.getMinMaxDeviceNumbers()[1]),c=!0;break}if(r.devicePropertiesVariables.includes(n)&&r.option.deviceMapping&&(e=e.replaceAll(i,r.option.deviceMapping[n])),c)break}return e},f=(e,r)=>{const a=[...new Set(e.match(/{.*?}/ig))];for(const i of a){const c=i.split(/{|}|\|\||;/).filter(Boolean),n=c.find(l=>l.includes("hide="))?.split("=")[1];if(b(n,r)){e=e.replaceAll(i,"");continue}e=g(e,r,c,i)}return e},E=(e,r)=>{for(const a of Object.keys(e))typeof e[a]=="string"&&(e[a]=f(e[a],r)),typeof e[a]=="object"&&E(e[a],r)},y=(e,r)=>{if(e.dataset.storeTextVariable===void 0||!r.option)return;const a=[...e.childNodes];for(const i of a){if(i.dataset&&i.dataset.cmpDataLayer&&!i.dataset.parsedDataLayer){const c=JSON.parse(i.dataset.cmpDataLayer);E(c,r),i.setAttribute("data-cmp-data-layer",JSON.stringify(c)),i.setAttribute("data-parsed-data-layer",!0)}i.nodeType===Node.TEXT_NODE&&(i.initialContent||(i.initialContent=i.textContent),i.textContent=f(i.initialContent,r)),a.push(...i.childNodes)}};export{y as resolve};
//# sourceMappingURL=textVariable.js.map
