{"version":3,"file":"resolver.js","sources":["../../../../../src/scripts/libs/store/resolver/resolver.js"],"sourcesContent":["import { AdobeDataLayerService } from \"@repobit/dex-data-layer\";\nimport { Store, ProductInfo, ProductOption } from \"../store.js\";\nimport { FranklinProductsLoadedEvent } from \"../../data-layer.js\";\nimport { staticAttributesResolvers, staticAttributes } from \"./staticAttributes/index.js\";\nimport { clickAttributeResolvers, clickAttributes } from \"./clickAttributes/index.js\";\nimport { staticGlobalAttributesResolvers } from \"./staticGlobalAttributes/index.js\";\n\nexport class GlobalContext {\n\t/**\n\t * @type {import(\"../index.js\").ProductOption[]}\n\t */\n\tstatic variations = [];\n\n\tstatic solveStaticAttributes() {\n\t\tStoreResolver.resolveStaticGlobalAttributes(document.querySelector(\"main\") || document.querySelector(\"body\"));\n\t}\n}\n\nexport class Context {\n\tconstructor(product, devices, years, staticAttributes, clickAttributes, contexts, contextProducts, products, devicePropertiesMapping) {\n\t\t/**\n\t\t * @type {import(\"../index.js\").Product}\n\t\t */\n\t\tthis.products = products;\n\t\t/**\n\t\t * @type {import(\"../index.js\").Product}\n\t\t*/\n\t\tthis._product = product;\n\t\t/**\n\t\t * @type {HTMLElement[]}\n\t\t */\n\t\tthis.staticAttributes = staticAttributes;\n\t\t/**\n\t\t * @type {HTMLElement[]}\n\t\t */\n\t\tthis.clickAttributes = clickAttributes;\n\t\t/**\n\t\t * @type {Context[]}\n\t\t */\n\t\tthis.contexts = contexts;\n\t\t/**\n\t\t * @type {import(\"../index.js\").Product[]}\n\t\t*/\n\t\tthis.contextProducts = contextProducts;\n\t\t/**\n\t\t * @type {import(\"../index.js\").ProductOption}\n\t\t */\n\t\tthis.bundle = null;\n\t\tthis._devices = devices;\n\t\tthis._years = years;\n\t\t/**\n\t\t * @type {import(\"../index.js\").ProductOption}\n\t\t */\n\t\tthis._option = product.getOption(devices, years);\n\n\t\t/**\n\t\t * transform the Content fragment variables object from\n\t\t * {\"3\": {\n\t\t * \t\t\"servers\": 1\n\t\t * \t}\n\t\t * }\n\t\t * into\n\t\t * {\"3\": {\n\t\t * \t\t\"CFV_SERVERS\": 1\n\t\t * \t}\n\t\t * }\n\t\t */\n\t\tthis.devicePropertiesMapping = Object.entries(devicePropertiesMapping).reduce((agregator, [key, value]) => {\n\t\t\tagregator[key] = Object.entries(value).reduce((agregator, [key, value]) => {\n\t\t\t\tagregator[`CFV_${key.toUpperCase()}`] = value;\n\t\t\t\treturn agregator;\n\t\t\t}, {});\n\t\t\treturn agregator;\n\t\t}, {});\n\n\t\tthis.devicePropertiesVariables = Object.keys(Object.values(this.devicePropertiesMapping)[0] || {});\n\t\tthis._option.deviceMapping = this.devicePropertiesMapping[this.devices];\n\t}\n\n\t/**\n\t * @type {number}\n\t*/\n\tget years() {\n\t\treturn this._years;\n\t}\n\n\t/**\n\t * @param {number} value\n\t */\n\tset years(value) {\n\t\t/**\n\t\t * @type {import(\"../index.js\").ProductOption}\n\t\t */\n\t\tconst option = this.product.getOption(this._devices, Number(value)) ||\n\t\t\tthis.product.getOption(this.product.getSubscriptions(\"years\", Number(value))[0], Number(value));\n\t\tif (!option) { return; }\n\t\tthis._years = Number(value);\n\t\tthis._option = option;\n\t\tthis.solveStaticAttributes();\n\t}\n\n\t/**\n\t * @type {number}\n\t*/\n\tget devices() {\n\t\treturn this._devices;\n\t}\n\n\t/**\n\t * @param {number} value\n\t */\n\tset devices(value) {\n\t\t/**\n\t\t * @type {import(\"../index.js\").ProductOption}\n\t\t */\n\t\tconst option = this.product.getOption(Number(value), this._years) ||\n\t\t\tthis.product.getOption(Number(value), this.product.getSubscriptions(\"years\", Number(value))[0]);\n\t\tif (!option) { return; }\n\t\tthis._devices = Number(value);\n\t\tthis._option = option;\n\t\tthis._option.deviceMapping = this.devicePropertiesMapping[this.devices];\n\t\tthis.solveStaticAttributes();\n\t}\n\n\t/**\n\t * @type {import(\"../index.js\").ProductOption}\n\t */\n\tget option() {\n\t\tif (this.bundle) {\n\t\t\tconst variation = this.product.getOption(this.devices, this.years, this.bundle);\n\t\t\tvariation.deviceMapping = this.devicePropertiesMapping[this.devices];\n\n\t\t\treturn variation;\n\t\t}\n\t\treturn this._option;\n\t}\n\n\t/**\n\t * @param {string} value\n\t */\n\tset option(value) {\n\t\tconst [devices, years] = parseKey(value);\n\t\t/**\n\t\t * @type {import(\"../index.js\").ProductOption}\n\t\t */\n\t\tconst option = this.product.getOption(devices, years);\n\t\tif (!option) { return; }\n\t\tthis._devices = devices;\n\t\tthis._years = years;\n\t\tthis._option = option;\n\t\tthis._option.deviceMapping = this.devicePropertiesMapping[this.devices];\n\t\tthis.solveStaticAttributes();\n\t}\n\n\t/**\n\t * @type {import(\"../index.js\").Product}\n\t*/\n\tget product() {\n\t\treturn this._product;\n\t}\n\n\t/**\n\t * @param {string} value\n\t */\n\tset product(value) {\n\t\tif (this.products[value]) {\n\t\t\tthis._product = this.products[value];\n\t\t}\n\t}\n\n\tsolveStaticAttributes() {\n\t\tthis.staticAttributes.forEach(attribute => StoreResolver.resolveStaticAttributes(attribute, this));\n\t}\n\n\tsetBundle(id, option) {\n\t\tif (!id) {\n\t\t\tthis.bundle = null;\n\t\t\tthis.solveStaticAttributes();\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.products[id];\n\t\tconst bundle = product?.getOption(\n\t\t\t...parseKey(option)\n\t\t);\n\t\tif (!bundle) { return; }\n\n\t\tthis.bundle = bundle;\n\t\tthis.solveStaticAttributes();\n\t}\n}\n\n/**\n * @param {HTMLElement} element\n * @param {number|string} value\n */\nexport const writeValue = (element, value) => {\n\tswitch (element.nodeName) {\n\t\tcase \"INPUT\":\n\t\t\telement.value = value\n\t\t\tbreak;\n\t\tdefault:\n\t\t\telement.innerHTML = value\n\t\t\tbreak;\n\t}\n}\n\n/**\n *\n * @param {string} key\n * @returns {number[]}\n */\nexport const parseKey = (key) => {\n\tconst keys = key.split('-');\n\tif (keys.length < 2) { return [1, 1] };\n\n\tlet index = keys.length > 2 ? 1 : 0;\n\tconst nrDevices = keys[index++].replace(/\\D/g, \"\");\n\tconst [nrYears] = keys[index].split(/[ym]/);\n\treturn [Number(nrDevices), Number(nrYears)];\n}\n\nwindow.parseKey = parseKey;\n\nexport class StoreResolver {\n\tstatic contextAttributes = {\n\t\tstoreId: \"[data-store-id]\",\n\t\tstoreDepartment: \"[data-store-department]\",\n\t\tstoreOption: \"[data-store-option]\",\n\t\tstorePromotion: \"[data-store-promotion]\",\n\t\tstoreEvent: \"[data-store-event]\",\n\t\tstoreKey: \"[data-store-key]\",\n\t\tstoreContext: \"[data-store-context]\",\n\t\tstoreDevicePropertiesMapping: \"[data-store-device-properties-mapping]\"\n\t}\n\n\tstatic staticAttributes = staticAttributes;\n\tstatic clickAttributes = clickAttributes;\n\n\tstatic async resolve(root = document) {\n\t\tawait Promise.allSettled([\n\t\t\tthis.#resolveRootElement(root),\n\t\t\t...[...root.querySelectorAll(\"[data-shadow-dom]\")].map(element => this.#resolveRootElement(element.shadowRoot))\n\t\t]);\n\t}\n\n\tstatic async #resolveRootElement(root) {\n\t\tconst products = root.querySelectorAll(`${this.contextAttributes.storeId}${this.contextAttributes.storeDepartment}`);\n\t\tif (products.length === 0) { return; }\n\n\t\tconst productsInfo = [...products, ...this.getAdditionalProducts(root)].map(element => {\n\t\t\ttry {\n\t\t\t\treturn new ProductInfo(\n\t\t\t\t\telement.dataset.storeId,\n\t\t\t\t\telement.dataset.storeDepartment,\n\t\t\t\t\telement.dataset.storePromotion,\n\t\t\t\t)\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(error.message)\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}).filter(element => !!element);\n\n\t\tconst storeProducts = await Store.getProducts(productsInfo);\n\t\tconst contexts = root.querySelectorAll(`${this.contextAttributes.storeContext}`);\n\n\t\tfor (const context of contexts) {\n\t\t\tconst products = this.getAllProducts(context);\n\t\t\tconst globalStaticAttributes = context.dataset.storeId ? [] : this.getAllAttributes(context, this.staticAttributes);\n\t\t\tconst globalClickAttributes = context.dataset.storeId ? [] : this.getAllAttributes(context, this.clickAttributes);\n\n\t\t\tconst pageContexts = [];\n\t\t\tconst contextProducts = [...products, ...this.getAdditionalProducts(context)].map(product =>storeProducts[product.dataset.storeId])\n\t\t\tfor (const product of products) {\n\t\t\t\tconst storeProduct = storeProducts[product.dataset.storeId];\n\t\t\t\tconst productDataMapping = JSON.parse(product.dataset?.storeDevicePropertiesMapping || '{}');\n\t\t\t\tif (!storeProduct) { continue; }\n\n\t\t\t\tconst options = this.getAllOptions(product);\n\t\t\t\tconst productStaticAttributes = product.dataset.storeOption ? [] : this.getAllAttributes(product, this.staticAttributes);\n\t\t\t\tconst productClickAttributes = product.dataset.storeOption ? [] : this.getAllAttributes(product, this.clickAttributes);\n\n\t\t\t\tfor (const option of options) {\n\t\t\t\t\tconst optionStaticAttributes = [...this.getAllAttributes(option, this.staticAttributes), ...productStaticAttributes, ...globalStaticAttributes];\n\t\t\t\t\tconst optionClickAttributes = [...this.getAllAttributes(option, this.clickAttributes), ...productClickAttributes, ...globalClickAttributes];\n\t\t\t\t\tconst [devices, years] = parseKey(option.dataset.storeOption);\n\t\t\t\t\tconst storeOption = storeProduct.getOption(devices, years);\n\t\t\t\t\tif (!storeOption) { continue; }\n\n\t\t\t\t\tconst context = new Context(\n\t\t\t\t\t\tstoreProduct,\n\t\t\t\t\t\tdevices,\n\t\t\t\t\t\tyears,\n\t\t\t\t\t\toptionStaticAttributes,\n\t\t\t\t\t\toptionClickAttributes,\n\t\t\t\t\t\tpageContexts,\n\t\t\t\t\t\tcontextProducts,\n\t\t\t\t\t\tstoreProducts,\n\t\t\t\t\t\tproductDataMapping\n\t\t\t\t\t);\n\n\t\t\t\t\tpageContexts.push(context);\n\t\t\t\t\tGlobalContext.variations.push(...this.getAllVariationsFromContext(context));\n\t\t\t\t\toptionStaticAttributes.forEach(staticAttribute => this.resolveStaticAttributes(staticAttribute, context));\n\t\t\t\t\toptionClickAttributes.forEach(clickAttribute => this.resolveClickAttributes(clickAttribute, context));\n\n\t\t\t\t\tswitch(option.dataset.storeEvent) {\n\t\t\t\t\t\tcase \"product-loaded\":\n\t\t\t\t\t\t\tAdobeDataLayerService.push(new FranklinProductsLoadedEvent(storeOption, 'all'));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"main-product-loaded\":\n\t\t\t\t\t\t\tAdobeDataLayerService.push(new FranklinProductsLoadedEvent(storeOption, 'info'));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"product-comparison\":\n\t\t\t\t\t\t\tAdobeDataLayerService.push(new FranklinProductsLoadedEvent(storeOption, 'comparison'));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tGlobalContext.solveStaticAttributes();\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} element\n\t * @param {Context} context\n\t */\n\tstatic resolveStaticAttributes(element, context) {\n\t\tstaticAttributesResolvers.forEach(attribute => {\n\t\t\ttry {\n\t\t\t\tattribute(element, context);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} button\n\t * @param {Context} context\n\t */\n\tstatic resolveClickAttributes(button, context) {\n\t\tclickAttributeResolvers.forEach(attribute => {\n\t\t\ttry {\n\t\t\t\tattribute(button, context);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} element\n\t */\n\tstatic resolveStaticGlobalAttributes(element) {\n\t\tstaticGlobalAttributesResolvers.forEach(attribute => {\n\t\t\ttry {\n\t\t\t\tattribute(element);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @param {Context} context\n\t * @return {import(\"../index.js\").ProductOption}\n\t */\n\tstatic getAllVariationsFromContext(context) {\n\t\t/**\n\t\t * @param {HTMLElement} attribute\n\t\t * @returns {import(\"../index.js\").ProductOption[]}\n\t\t */\n\t\tconst parseNodeName = (attribute) => {\n\t\t\tconst options = [];\n\n\t\t\tswitch (attribute.nodeName) {\n\t\t\t\tcase \"INPUT\":\n\t\t\t\t\tif (attribute.dataset.storeClickSetDevices !== undefined) {\n\t\t\t\t\t\tconst [min, max] = context.product.getMinMaxDeviceNumbers();\n\n\t\t\t\t\t\tfor (let devices = min; devices <= max; devices++) {\n\t\t\t\t\t\t\toptions.push(context.product.getOption(devices, context.years));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SELECT\":\n\t\t\t\t\tif (attribute.dataset.storeClickSetDevices !== undefined) {\n\t\t\t\t\t\t[...attribute.options].forEach(option => options.push(\n\t\t\t\t\t\t\tcontext.product.getOption(Number(option.value), context.years)\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickSetYears !== undefined) {\n\t\t\t\t\t\t[...attribute.options].forEach(option => options.push(\n\t\t\t\t\t\t\tcontext.product.getOption(context.devices, Number(option.value))\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickSetProduct !== undefined) {\n\t\t\t\t\t\t[...attribute.options].forEach(option => {\n\t\t\t\t\t\t\tconst [devices, years] = parseKey(option.dataset.storeProductOption || `${context.devices}-${context.years}` );\n\t\t\t\t\t\t\toptions.push(context\n\t\t\t\t\t\t\t\t.products[option.dataset.storeProductId]\n\t\t\t\t\t\t\t\t?.getOption(devices, years)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (attribute.dataset.storeClickSetDevices !== undefined) {\n\t\t\t\t\t\toptions.push(context.product.getOption(Number(attribute.dataset.storeClickSetDevices), context.years));\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickSetYears !== undefined) {\n\t\t\t\t\t\toptions.push(context.product.getOption(context.devices, Number(attribute.dataset.storeClickSetYears)));\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickSetOption) {\n\t\t\t\t\t\tconst [devices, years] = parseKey(attribute.dataset.storeClickSetOption);\n\t\t\t\t\t\toptions.push(context.product.getOption(devices, years));\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickSetProduct !== undefined) {\n\t\t\t\t\t\tconst [devices, years] = parseKey(attribute.dataset.storeProductOption || `${context.devices}-${context.years}`);\n\t\t\t\t\t\toptions.push(context\n\t\t\t\t\t\t\t.products[attribute.dataset.storeProductId]\n\t\t\t\t\t\t\t?.getOption(devices, years)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\tif (attribute.dataset.storeClickToggleBundle !== undefined) {\n\t\t\t\t\t\tconst [devices, years] = parseKey(attribute.dataset.storeBundleOption);\n\t\t\t\t\t\toptions.push(context\n\t\t\t\t\t\t\t.products[attribute.dataset.storeBundleId]\n\t\t\t\t\t\t\t?.getOption(devices, years)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn options.filter(option => Boolean(option));\n\t\t}\n\n\t\t/**\n\t\t * @param {import(\"../index.js\").ProductOption} baseOption\n\t\t * @param {import(\"../index.js\").ProductOption} varyToOption\n\t\t * @param {\"devices\"|\"subscription\"|\"all\"|\"bundle\"} modfier\n\t\t * @returns {import(\"../index.js\").ProductOption|null}\n\t\t */\n\t\tconst vary = (baseOption, varyToOption, modfier) => {\n\t\t\tlet devices;\n\t\t\tlet subscription;\n\n\t\t\tswitch (modfier) {\n\t\t\t\tcase \"devices\":\n\t\t\t\t\tdevices = varyToOption.getDevices();\n\t\t\t\t\tsubscription = baseOption.getSubscription(\"years\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"subscription\":\n\t\t\t\t\tdevices = baseOption.getDevices();\n\t\t\t\t\tsubscription = varyToOption.getSubscription(\"years\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"all\":\n\t\t\t\t\tdevices = varyToOption.getDevices();\n\t\t\t\t\tsubscription = varyToOption.getSubscription(\"years\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"none\":\n\t\t\t\t\tdevices = baseOption.getDevices();\n\t\t\t\t\tsubscription = baseOption.getSubscription(\"years\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn context.products[baseOption.getId()].getOption(\n\t\t\t\tdevices,\n\t\t\t\tsubscription,\n\t\t\t\tmodfier === \"bundle\" ? varyToOption : null\n\t\t\t);\n\t\t}\n\n\t\tconst setDevices = context.clickAttributes\n\t\t\t.filter(attribute => attribute.dataset.storeClickSetDevices !== undefined)\n\t\t\t.reduce((acc, attribute) => acc.concat(parseNodeName(attribute)), []);\n\n\t\tconst setYears = context.clickAttributes\n\t\t\t.filter(attribute => attribute.dataset.storeClickSetYears !== undefined)\n\t\t\t.reduce((acc, attribute) => acc.concat(parseNodeName(attribute)), []);\n\n\t\tconst setOption = context.clickAttributes\n\t\t\t.filter(attribute => attribute.dataset.storeClickSetOption)\n\t\t\t.reduce((acc, attribute) => acc.concat(parseNodeName(attribute)), []);\n\n\t\tconst setProduct = context.clickAttributes\n\t\t\t.filter(attribute => attribute.dataset.storeClickSetProduct !== undefined)\n\t\t\t.reduce((acc, attribute) => acc.concat(parseNodeName(attribute)), []);\n\n\t\tconst setBundle = context.clickAttributes\n\t\t\t.filter(attribute => attribute.dataset.storeClickToggleBundle !== undefined)\n\t\t\t.reduce((acc, attribute) => acc.concat(parseNodeName(attribute)), []);\n\n\t\tconst devicesAndYearVariations = setYears\n\t\t\t.reduce((acc, baseOption) => acc.concat(\n\t\t\t\tsetDevices.map(varyToOption => vary(baseOption, varyToOption, \"devices\")),\n\t\t\t), [])\n\t\t\t.concat(setYears.length === 0 ? setDevices : [], setOption, [context.option])\n\t\t\t.filter(option => Boolean(option));\n\n\t\tconst [selectDevices, selectYears] = context.clickAttributes\n\t\t\t.filter(attribute => attribute.nodeName === \"SELECT\"\n\t\t\t\t&& (attribute.dataset.storeClickSetYears !== undefined || attribute.dataset.storeClickSetDevices !== undefined)\n\t\t\t)\n\t\t\t.sort((a,) => a.dataset.storeClickSetDevices !== undefined ? -1 : 1)\n\n\t\tconst generateDynamicVariationsAfterProductSelect = (baseOption) => {\n\t\t\tconst product = context.products[baseOption.getId()];\n\n\t\t\tif (selectDevices && selectYears) {\n\t\t\t\treturn product.getAllOptions();\n\t\t\t}\n\n\t\t\tif (selectDevices) {\n\t\t\t\treturn product\n\t\t\t\t\t.getSubscriptions(\"years\", baseOption.getDevices())\n\t\t\t\t\t.map(years => product.getOption(baseOption.getDevices(), years))\n\t\t\t}\n\n\t\t\tif (selectYears) {\n\t\t\t\treturn product\n\t\t\t\t\t.getDevices(baseOption.getSubscription(\"years\"))\n\t\t\t\t\t.map(devices => product.getOption(devices, baseOption.getSubscription(\"years\")))\n\t\t\t}\n\t\t}\n\n\t\tconst productVariations = setProduct\n\t\t\t.filter(product => product.getId() !== context.product.getId())\n\t\t\t.reduce((acc, baseOption) => acc.concat(\n\t\t\t\tdevicesAndYearVariations.map(varyToOption => vary(baseOption, varyToOption, \"all\")),\n\t\t\t\tgenerateDynamicVariationsAfterProductSelect(baseOption)\n\t\t\t), [])\n\t\t\t.filter(option => Boolean(option));\n\n\t\tconst bundleVariations = [\n\t\t\t...devicesAndYearVariations,\n\t\t\t...productVariations\n\t\t]\n\t\t\t.reduce((acc, baseOption) => acc.concat(\n\t\t\t\tsetBundle.map(bundle => vary(baseOption, bundle, \"bundle\")),\n\t\t\t), [])\n\t\t\t.filter(option => Boolean(option));\n\n\t\treturn [\n\t\t\t...devicesAndYearVariations,\n\t\t\t...productVariations,\n\t\t\t...bundleVariations\n\t\t].filter(option => option instanceof ProductOption);\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} context\n\t */\n\tstatic getAllProducts(context) {\n\t\t/**\n\t\t * @type {HTMLElement[]}\n\t\t */\n\t\tconst children = [...context.children];\n\t\tconst products = [];\n\n\t\tfor (const child of children) {\n\t\t\tif (child.dataset.storeContext) { continue };\n\n\t\t\tif (child.dataset.storeId && child.dataset.storeDepartment) {\n\t\t\t\tproducts.push(child);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tchildren.push(...child.children);\n\t\t}\n\n\t\tif (context.dataset.storeId && context.dataset.storeDepartment) {\n\t\t\tproducts.push(context);\n\t\t}\n\n\t\treturn products;\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} product\n\t */\n\tstatic getAllOptions(product) {\n\t\t/**\n\t\t * @type {HTMLElement[]}\n\t\t */\n\t\tconst children = [...product.children];\n\t\tconst options = [];\n\n\t\tfor (const child of children) {\n\t\t\tif (child.dataset.storeId) { continue };\n\n\t\t\tif (child.dataset.storeOption) {\n\t\t\t\toptions.push(child);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tchildren.push(...child.children);\n\t\t}\n\n\t\tif (product.dataset.storeOption) {\n\t\t\toptions.push(product);\n\t\t}\n\n\t\treturn options;\n\t}\n\n\t/**\n\t *\n\t * @param {HTMLElement} product\n\t */\n\tstatic getAllAttributes(product, attributes) {\n\t\t/**\n\t\t * @type {HTMLElement[]}\n\t\t */\n\t\tconst children = [...product.children];\n\t\tconst attributesInOption = [];\n\n\t\tfor (const child of children) {\n\t\t\tif (child.dataset.storeId || child.dataset.storeOption || child.dataset.storeContext) { continue };\n\n\t\t\tfor (const attribute of Object.keys(child.dataset)) {\n\t\t\t\tif (Object.keys(attributes).includes(attribute)) {\n\t\t\t\t\tattributesInOption.push(child)\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tchildren.push(...child.children);\n\t\t}\n\n\t\tfor (const attribute of Object.keys(product.dataset)) {\n\t\t\tif (Object.keys(attributes).includes(attribute)) {\n\t\t\t\tattributesInOption.push(product)\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn attributesInOption;\n\t}\n\n\tstatic getAdditionalProducts(root) {\n\t\treturn [...root.querySelectorAll(`[data-store-product-id], [data-store-bundle-id]`)]\n\t\t\t.map(button => {\n\t\t\t\tconst newButton = document.createElement(\"div\");\n\t\t\t\tnewButton.setAttribute(\"data-store-id\", button.dataset.storeProductId || button.dataset.storeBundleId);\n\t\t\t\tnewButton.setAttribute(\"data-store-option\", button.dataset.storeProductOption || button.dataset.storeBundleOption || \"\");\n\t\t\t\tnewButton.setAttribute(\"data-store-department\", button.dataset.storeProductDepartment || button.dataset.storeBundleDepartment);\n\t\t\t\tnewButton.setAttribute(\"data-store-promotion\", button.dataset.storeProductPromotion || button.dataset.storeBundlePromotion || \"\");\n\t\t\t\tnewButton.setAttribute(\"data-store-region\", button.dataset.storeProductRegion || button.dataset.storeBundleRegion || 0);\n\t\t\t\tnewButton.setAttribute(\"data-store-platform\", button.dataset.storeProductPlatform || button.dataset.storeBundlePlatform || 0);\n\t\t\t\treturn newButton;\n\t\t\t});\n\t}\n}\n\nwindow.StoreResolverWebsites = StoreResolver;"],"names":["GlobalContext","StoreResolver","Context","product","devices","years","staticAttributes","clickAttributes","contexts","contextProducts","products","devicePropertiesMapping","agregator","key","value","option","variation","parseKey","attribute","id","bundle","writeValue","element","keys","index","nrDevices","nrYears","root","#resolveRootElement","productsInfo","ProductInfo","error","storeProducts","Store","context","globalStaticAttributes","globalClickAttributes","pageContexts","storeProduct","productDataMapping","options","productStaticAttributes","productClickAttributes","optionStaticAttributes","optionClickAttributes","storeOption","staticAttribute","clickAttribute","AdobeDataLayerService","FranklinProductsLoadedEvent","staticAttributesResolvers","button","clickAttributeResolvers","staticGlobalAttributesResolvers","parseNodeName","min","max","vary","baseOption","varyToOption","modfier","subscription","setDevices","acc","setYears","setOption","setProduct","setBundle","devicesAndYearVariations","selectDevices","selectYears","a","generateDynamicVariationsAfterProductSelect","productVariations","bundleVariations","ProductOption","children","child","attributes","attributesInOption","newButton"],"mappings":"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"}