import d from"../node_modules/@repobit/dex-target/dist/src/index.js";import"../node_modules/@repobit/dex-data-layer/dist/src/adobe-data-layer-service/index.js";import{PageLoadStartedEvent as p}from"../node_modules/@repobit/dex-data-layer/dist/src/events/page-load-started-event/index.js";import"../node_modules/@repobit/dex-utils/dist/src/index.js";import{sampleRUM as f}from"./lib-franklin.js";import h from"./page.js";import{generatePageLoadStartedName as u,GLOBAL_EVENTS as g,getMetadata as s,shouldABTestsBeDisabled as w}from"./utils/utils.js";import E from"../node_modules/@repobit/dex-utils/dist/src/user.js";const m=new d({pageLoadStartedEvent:new p(h,{name:u(),geoRegion:await E.country,serverName:"hlx.live"})});function D(e){const{pathname:t,search:n,hash:a}=new URL(e,window.location.href);return`${t.endsWith("/")?`${t}index.plain.html`:`${t}.plain.html`}${n}${a}`}async function y(e){const t=D(e),n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch challenger page: ${n.status}`);const a=document.querySelector("main");if(!a)throw new Error("Main element not found");a.innerHTML=await n.text()}async function L(e,t){if(!e)return null;try{return await y(e),f("target-experiment",{source:`target:${t}`,target:e}),{experimentId:t,experimentVariant:e}}catch{return null}}function l(e){try{(typeof e=="string"?document.querySelector(e):e).querySelectorAll('[href*=".bitdefender."]').forEach(async a=>{const r=await m.appendVisitorIDsTo(a.href);a.href=r.replace(/MCAID%3D.*%7CMCORGID/,"MCAID%3D%7CMCORGID")})}catch(t){console.error(t)}}const O=async()=>{let e=null;async function t(r){return new Promise((c,o)=>{if(document.querySelector(`head > link[href="${r}"]`))c();else{const i=document.createElement("link");i.rel="stylesheet",i.href=r,i.onload=c,i.onerror=o,document.head.append(i)}})}const n=s("target-experiment-location"),a=s("target-experiment");if(n&&a&&!w()){const r=await m.getOffers({mboxNames:n}),{url:c,template:o}=r||{};o&&(t(`${window.hlx.codeBasePath}/scripts/template-factories/${o}.css`),document.body.classList.add(o)),e=await L(c,a)}return e};function I(e){window.ADOBE_MC_EVENT_LOADED?l(e):document.addEventListener(g.ADOBE_MC_LOADED,()=>{l(e)})}export{I as adobeMcAppendVisitorId,l as appendAdobeMcLinks,O as getTargetExperimentDetails,L as runTargetExperiment,m as target};
//# sourceMappingURL=target.js.map
