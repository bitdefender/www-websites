{"version":3,"file":"lib-identity-exposed-onsubmit.js","sources":["../../src/scripts/lib-identity-exposed-onsubmit.js"],"sourcesContent":["import { ALL_FRANKLIN_DEV_SUBDOMAINS } from './lib-franklin.js';\n\nasync function sleep(ms) {\n  // eslint-disable-next-line no-promise-executor-return\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nasync function fetchData(url, body) {\n  const resp = await fetch(url, { method: 'POST', body: JSON.stringify(body) });\n  const json = await resp.json();\n  return json.result || json;\n}\n\nexport default async function onSubmit(e) {\n  try {\n    const campaign = e.target.querySelector('input[name=\"campaign\"]')?.value;\n    const email = e.target.querySelector('input[type=email]')?.value;\n\n    document.querySelector('.scan-error').classList.remove('show');\n    document.querySelector('.form-container').classList.add('hide');\n    document.querySelector('.scan-loading').classList.add('show');\n    document.querySelector('.scan-loading h3:nth-child(1)').classList.add('show');\n\n    await sleep(1000);\n\n    document.querySelector('.scan-loading h3:nth-child(1)').classList.remove('show');\n    document.querySelector('.scan-loading h3:nth-child(2)').classList.add('show');\n\n    const firstRequest = await fetchData('https://nimbus.bitdefender.net/lid/privacy_check', {\n      id: 1,\n      jsonrpc: '2.0',\n      method: 'on_demand_scan',\n      params: {\n        app_id: 'com.bitdefender.vpn',\n        type: 'emails',\n        value: email,\n      },\n    });\n\n    if (firstRequest.error) {\n      throw new Error('Scan error');\n    }\n\n    await sleep(1000);\n\n    const secondRequest = await fetchData('https://nimbus.bitdefender.net/lid/privacy_check', {\n      id: 2,\n      jsonrpc: '2.0',\n      method: 'get_on_demand_issues',\n      params: { scan_id: firstRequest.scan_id },\n    });\n\n    document.querySelector('.scan-loading h3:nth-child(2)').classList.remove('show');\n    document.querySelector('.scan-loading h3:nth-child(3)').classList.add('show');\n\n    if (secondRequest.error) {\n      throw new Error('Scan error');\n    }\n\n    await sleep(1000);\n\n    const domain = ALL_FRANKLIN_DEV_SUBDOMAINS.some(\n      (subdomain) => window.location.hostname.includes(subdomain),\n    ) ? 'https://www.bitdefender.com' : '';\n\n    const emarsysRequest = await fetchData(`${domain}/site/Store/offerSubscribe`, {\n      email,\n      flow: campaign,\n    });\n\n    document.querySelector('.scan-loading h3:nth-child(3)').classList.remove('show');\n    document.querySelector('.scan-loading').classList.remove('show');\n\n    if (!emarsysRequest.success) {\n      throw new Error('Scan error');\n    }\n\n    document.querySelectorAll('.scan-results').forEach((el) => el.classList.add('show'));\n\n    if (secondRequest.total_count === 0) {\n      document.querySelector('.scan-result-leaks').classList.remove('show');\n      document.querySelector('.scan-result-zero').classList.add('show');\n    } else {\n      document.querySelector('.scan-result-leaks').classList.add('show');\n      document.querySelector('.scan-result-zero').classList.remove('show');\n      document.querySelector('.scan-result-leaks h3').textContent = document.querySelector('.scan-result-leaks h3').textContent.replace('{numberOfLeaks}', secondRequest.total_count);\n    }\n\n    // add smooth scrolling functionality to ToS area\n    const tosButton = document.querySelector('.modal-container.has-your-identity-been-exposed .product-card p:nth-of-type(2) a');\n    const tosArea = document.querySelector('.section.accordion-container:has(.accordion.terms-of-use)');\n    if (tosButton && tosArea) {\n      tosButton.addEventListener('click', (clickEvent) => {\n        clickEvent.preventDefault();\n        tosArea.scrollIntoView({\n          behavior: 'smooth',\n        });\n      });\n    }\n  } catch (error) {\n    document.querySelector('.form-container').classList.remove('hide');\n    document.querySelector('.scan-error').classList.add('show');\n    document.querySelectorAll('.scan-loading, .scan-results').forEach((el) => el.classList.remove('show'));\n  }\n}\n"],"names":["sleep","ms","resolve","fetchData","url","body","json","onSubmit","campaign","email","firstRequest","secondRequest","domain","ALL_FRANKLIN_DEV_SUBDOMAINS","subdomain","emarsysRequest","el","tosButton","tosArea","clickEvent"],"mappings":"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"}