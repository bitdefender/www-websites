{"version":3,"file":"lib-identity-exposed-onsubmit.js","sources":["../../src/scripts/lib-identity-exposed-onsubmit.js"],"sourcesContent":["import { ALL_FRANKLIN_DEV_SUBDOMAINS } from './lib-franklin.js';\n\nasync function sleep(ms) {\n  // eslint-disable-next-line no-promise-executor-return\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nasync function fetchData(url, body) {\n  const resp = await fetch(url, { method: 'POST', body: JSON.stringify(body) });\n  const json = await resp.json();\n  return json.result || json;\n}\n\nexport default async function onSubmit(e) {\n  try {\n    const campaign = e.target.querySelector('input[name=\"campaign\"]')?.value;\n    const email = e.target.querySelector('input[type=email]')?.value;\n\n    document.querySelector('.scan-error').classList.remove('show');\n    document.querySelector('.form-container').classList.add('hide');\n    document.querySelector('.scan-loading').classList.add('show');\n    document.querySelector('.scan-loading h3:nth-child(1)').classList.add('show');\n\n    await sleep(1000);\n\n    document.querySelector('.scan-loading h3:nth-child(1)').classList.remove('show');\n    document.querySelector('.scan-loading h3:nth-child(2)').classList.add('show');\n\n    const firstRequest = await fetchData('https://nimbus.bitdefender.net/lid/privacy_check', {\n      id: 1,\n      jsonrpc: '2.0',\n      method: 'on_demand_scan',\n      params: {\n        app_id: 'com.bitdefender.vpn',\n        type: 'emails',\n        value: email,\n      },\n    });\n\n    if (firstRequest.error) {\n      throw new Error('Scan error');\n    }\n\n    await sleep(1000);\n\n    const secondRequest = await fetchData('https://nimbus.bitdefender.net/lid/privacy_check', {\n      id: 2,\n      jsonrpc: '2.0',\n      method: 'get_on_demand_issues',\n      params: { scan_id: firstRequest.scan_id },\n    });\n\n    document.querySelector('.scan-loading h3:nth-child(2)').classList.remove('show');\n    document.querySelector('.scan-loading h3:nth-child(3)').classList.add('show');\n\n    if (secondRequest.error) {\n      throw new Error('Scan error');\n    }\n\n    await sleep(1000);\n\n    const domain = ALL_FRANKLIN_DEV_SUBDOMAINS.some(\n      (subdomain) => window.location.hostname.includes(subdomain),\n    ) ? 'https://www.bitdefender.com' : '';\n\n    const emarsysRequest = await fetchData(`${domain}/site/Store/offerSubscribe`, {\n      email,\n      flow: campaign,\n    });\n\n    document.querySelector('.scan-loading h3:nth-child(3)').classList.remove('show');\n    document.querySelector('.scan-loading').classList.remove('show');\n\n    if (!emarsysRequest.success) {\n      throw new Error('Scan error');\n    }\n\n    document.querySelectorAll('.scan-results').forEach((el) => el.classList.add('show'));\n\n    if (secondRequest.total_count === 0) {\n      document.querySelector('.scan-result-leaks').classList.remove('show');\n      document.querySelector('.scan-result-zero').classList.add('show');\n    } else {\n      document.querySelector('.scan-result-leaks').classList.add('show');\n      document.querySelector('.scan-result-zero').classList.remove('show');\n      document.querySelector('.scan-result-leaks h3').textContent = document.querySelector('.scan-result-leaks h3').textContent.replace('{numberOfLeaks}', secondRequest.total_count);\n    }\n\n    // add smooth scrolling functionality to ToS area\n    const tosButton = document.querySelector('.modal-container.has-your-identity-been-exposed .product-card p:nth-of-type(2) a');\n    const tosArea = document.querySelector('.section.accordion-container:has(.accordion.terms-of-use)');\n    if (tosButton && tosArea) {\n      tosButton.addEventListener('click', (clickEvent) => {\n        clickEvent.preventDefault();\n        tosArea.scrollIntoView({\n          behavior: 'smooth',\n        });\n      });\n    }\n  } catch (error) {\n    document.querySelector('.form-container').classList.remove('hide');\n    document.querySelector('.scan-error').classList.add('show');\n    document.querySelectorAll('.scan-loading, .scan-results').forEach((el) => el.classList.remove('show'));\n  }\n}\n"],"names":[],"mappings":"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"}