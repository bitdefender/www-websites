import{ALL_FRANKLIN_DEV_SUBDOMAINS as m}from"./lib-franklin.js";async function n(e){return new Promise(t=>setTimeout(t,e))}async function a(e,t){const s=await(await fetch(e,{method:"POST",body:JSON.stringify(t)})).json();return s.result||s}async function w(e){try{const t=e.target.querySelector('input[name="campaign"]')?.value,o=e.target.querySelector("input[type=email]")?.value;document.querySelector(".scan-error").classList.remove("show"),document.querySelector(".form-container").classList.add("hide"),document.querySelector(".scan-loading").classList.add("show"),document.querySelector(".scan-loading h3:nth-child(1)").classList.add("show"),await n(1e3),document.querySelector(".scan-loading h3:nth-child(1)").classList.remove("show"),document.querySelector(".scan-loading h3:nth-child(2)").classList.add("show");const s=await a("https://nimbus.bitdefender.net/lid/privacy_check",{id:1,jsonrpc:"2.0",method:"on_demand_scan",params:{app_id:"com.bitdefender.vpn",type:"emails",value:o}});if(s.error)throw new Error("Scan error");await n(1e3);const c=await a("https://nimbus.bitdefender.net/lid/privacy_check",{id:2,jsonrpc:"2.0",method:"get_on_demand_issues",params:{scan_id:s.scan_id}});if(document.querySelector(".scan-loading h3:nth-child(2)").classList.remove("show"),document.querySelector(".scan-loading h3:nth-child(3)").classList.add("show"),c.error)throw new Error("Scan error");await n(1e3);const d=m.some(r=>window.location.hostname.includes(r))?"https://www.bitdefender.com":"",u=await a(`${d}/site/Store/offerSubscribe`,{email:o,flow:t});if(document.querySelector(".scan-loading h3:nth-child(3)").classList.remove("show"),document.querySelector(".scan-loading").classList.remove("show"),!u.success)throw new Error("Scan error");document.querySelectorAll(".scan-results").forEach(r=>r.classList.add("show")),c.total_count===0?(document.querySelector(".scan-result-leaks").classList.remove("show"),document.querySelector(".scan-result-zero").classList.add("show")):(document.querySelector(".scan-result-leaks").classList.add("show"),document.querySelector(".scan-result-zero").classList.remove("show"),document.querySelector(".scan-result-leaks h3").textContent=document.querySelector(".scan-result-leaks h3").textContent.replace("{numberOfLeaks}",c.total_count));const i=document.querySelector(".modal-container.has-your-identity-been-exposed .product-card p:nth-of-type(2) a"),l=document.querySelector(".section.accordion-container:has(.accordion.terms-of-use)");i&&l&&i.addEventListener("click",r=>{r.preventDefault(),l.scrollIntoView({behavior:"smooth"})})}catch{document.querySelector(".form-container").classList.remove("hide"),document.querySelector(".scan-error").classList.add("show"),document.querySelectorAll(".scan-loading, .scan-results").forEach(o=>o.classList.remove("show"))}}export{w as default};
//# sourceMappingURL=lib-identity-exposed-onsubmit.js.map
