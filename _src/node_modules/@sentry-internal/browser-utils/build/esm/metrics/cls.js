import{DEBUG_BUILD as c}from"../debug-build.js";import{addClsInstrumentationHandler as S}from"./instrument.js";import{msToSec as T,startStandaloneWebVitalSpan as u}from"./utils.js";import{onHidden as m}from"./web-vitals/lib/onHidden.js";import{getClient as f,getCurrentScope as E}from"../../../../../@sentry/core/build/esm/currentScopes.js";import{getActiveSpan as d,getRootSpan as N,spanToJSON as _}from"../../../../../@sentry/core/build/esm/utils/spanUtils.js";import{logger as I}from"../../../../../@sentry/core/build/esm/utils-hoist/logger.js";import{browserPerformanceTimeOrigin as g}from"../../../../../@sentry/core/build/esm/utils-hoist/time.js";import{SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_VALUE as C,SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_UNIT as A,SEMANTIC_ATTRIBUTE_EXCLUSIVE_TIME as R,SEMANTIC_ATTRIBUTE_SENTRY_OP as U,SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN as M}from"../../../../../@sentry/core/build/esm/semanticAttributes.js";import{htmlTreeAsString as b}from"../../../../../@sentry/core/build/esm/utils-hoist/browser.js";function x(){let o=0,e,a;if(!O())return;let r=!1;function s(){r||(r=!0,a&&v(o,e,a),i())}const i=S(({metric:t})=>{const n=t.entries[t.entries.length-1];n&&(o=t.value,e=n)},!0);m(()=>{s()}),setTimeout(()=>{const t=f();if(!t)return;const n=t.on("startNavigationSpan",()=>{s(),n?.()}),p=d();if(p){const l=N(p);_(l).op==="pageload"&&(a=l.spanContext().spanId)}},0)}function v(o,e,a){c&&I.log(`Sending CLS span (${o})`);const r=T((g()||0)+(e?.startTime||0)),s=E().getScopeData().transactionName,i=e?b(e.sources[0]?.node):"Layout shift",t={[M]:"auto.http.browser.cls",[U]:"ui.webvital.cls",[R]:e?.duration||0,"sentry.pageload.span_id":a},n=u({name:i,transaction:s,attributes:t,startTime:r});n&&(n.addEvent("cls",{[A]:"",[C]:o}),n.end(r))}function O(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}export{x as trackClsAsStandaloneSpan};
//# sourceMappingURL=cls.js.map
