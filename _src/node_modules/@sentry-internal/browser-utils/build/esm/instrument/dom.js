import{WINDOW as o}from"../types.js";import{addHandler as g,maybeInstrument as T,triggerHandlers as b}from"../../../../../@sentry/core/build/esm/utils-hoist/instrument/handlers.js";import{fill as _,addNonEnumerableProperty as y}from"../../../../../@sentry/core/build/esm/utils-hoist/object.js";import{uuid4 as k}from"../../../../../@sentry/core/build/esm/utils-hoist/misc.js";const C=1e3;let p,f,h;function P(t){const e="dom";g(e,t),T(e,O)}function O(){if(!o.document)return;const t=b.bind(null,"dom"),e=E(t,!0);o.document.addEventListener("click",e,!1),o.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const l=o[n]?.prototype;l?.hasOwnProperty?.("addEventListener")&&(_(l,"addEventListener",function(u){return function(r,c,d){if(r==="click"||r=="keypress")try{const s=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},a=s[r]=s[r]||{refCount:0};if(!a.handler){const m=E(t);a.handler=m,u.call(this,r,m,d)}a.refCount++}catch{}return u.call(this,r,c,d)}}),_(l,"removeEventListener",function(u){return function(r,c,d){if(r==="click"||r=="keypress")try{const s=this.__sentry_instrumentation_handlers__||{},a=s[r];a&&(a.refCount--,a.refCount<=0&&(u.call(this,r,a.handler,d),a.handler=void 0,delete s[r]),Object.keys(s).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return u.call(this,r,c,d)}}))})}function D(t){if(t.type!==f)return!1;try{if(!t.target||t.target._sentryId!==h)return!1}catch{}return!0}function I(t,e){return t!=="keypress"?!1:e?.tagName?!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable):!0}function E(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const i=N(n);if(I(n.type,i))return;y(n,"_sentryCaptured",!0),i&&!i._sentryId&&y(i,"_sentryId",k());const l=n.type==="keypress"?"input":n.type;D(n)||(t({event:n,name:l,global:e}),f=n.type,h=i?i._sentryId:void 0),clearTimeout(p),p=o.setTimeout(()=>{h=void 0,f=void 0},C)}}function N(t){try{return t.target}catch{return null}}export{P as addClickKeypressInstrumentationHandler,O as instrumentDOM};
//# sourceMappingURL=dom.js.map
