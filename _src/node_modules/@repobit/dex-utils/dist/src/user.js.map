{"version":3,"file":"user.js","sources":["../../../../../../node_modules/@repobit/dex-utils/dist/src/user.js"],"sourcesContent":["import { Constants } from '@repobit/dex-constants';\nimport Cookies from './cookies.js';\nimport UserAgent from './user-agent/index.js';\nexport default class User {\n    static _info = this.staticInitialise();\n    static _fingerprint = this.getFingerprint();\n    static _country = this.getGeolocation();\n    static _locale = this.getUserLocale();\n    static async staticInitialise() {\n        if (!Cookies.has(Constants.LOGIN_LOGGED_USER_EXPIRY_COOKIE_NAME)) {\n            return null;\n        }\n        try {\n            const userDataResponse = await fetch(`${Constants.PUBLIC_URL_ORIGIN}/bin/login/userInfo.json`);\n            return userDataResponse.ok ? (await userDataResponse.json()).result : null;\n        }\n        catch {\n            return null;\n        }\n    }\n    static async getFingerprint() {\n        // Try to grab the fingeprint from localstoraage\n        const storageFingerprint = localStorage.getItem(Constants.FINGERPRINT_LOCAL_STORAGE_NAME);\n        if (storageFingerprint) {\n            return storageFingerprint;\n        }\n        // Try to grab fingerprint from login data\n        const userInfo = await this._info;\n        if (userInfo) {\n            localStorage.setItem(Constants.FINGERPRINT_LOCAL_STORAGE_NAME, userInfo.fingerprint);\n            return userInfo.fingerprint;\n        }\n        // Try to grab fingerprint from dummyPost (from user local antivirus instance)\n        const fingerprintNotExist = Cookies.has(Constants.NO_FINGERPRINT_COOKIE_NAME);\n        if (!fingerprintNotExist && UserAgent.isWindows) {\n            try {\n                const fingerprintReq = await fetch(`${Constants.WWW_ONLY_ORIGIN}/site/Main/dummyPost?${Math.random()}`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-type': 'application/x-www-form-urlencoded',\n                        'Pragma': 'no-cache',\n                        'Cache-Control': 'no-store, no-cache, must-revalidate, max-age=0',\n                        'Expires': 'Tue, 01 Jan 1971 02:00:00 GMT',\n                        'BDUS_A312C09A2666456D9F2B2AA5D6B463D6': 'check.bitdefender'\n                    }\n                });\n                if (fingerprintReq.ok && fingerprintReq.headers.has(Constants.FINGERPRINT_HEADER)) {\n                    const fingerprint = fingerprintReq.headers.get(Constants.FINGERPRINT_HEADER);\n                    localStorage.setItem(Constants.FINGERPRINT_LOCAL_STORAGE_NAME, fingerprint);\n                    return fingerprint;\n                }\n                else {\n                    Cookies.set(Constants.NO_FINGERPRINT_COOKIE_NAME, 'true', { expires: 1 });\n                }\n            }\n            catch { /* empty */ }\n        }\n        return null;\n    }\n    /**\n     * Handling User Geolocation\n     * This wil fetch the user's country\n    */\n    static async getGeolocation() {\n        try {\n            const response = await fetch(`${Constants.PUBLIC_URL_ORIGIN}/geoip`);\n            if (!response.ok) {\n                return 'us';\n            }\n            const country = await response.json();\n            if (country.error_code) {\n                return 'us';\n            }\n            return country['country'].toLowerCase();\n        }\n        catch {\n            return 'us';\n        }\n    }\n    /** Getting the User's Locale */\n    static async getUserLocale() {\n        const userCountry = await this._country;\n        try {\n            const userGeoIpCall = await fetch(`${Constants.WWW_ONLY_ORIGIN}/p-api/v1/countries/${userCountry.toUpperCase()}/locales`);\n            const userGeoIpData = await userGeoIpCall.json();\n            return userGeoIpData[0].locale.toLowerCase();\n        }\n        catch {\n            return 'en-us';\n        }\n    }\n    /** attempt to log the user in.\n     * You can access it from the mega menu if it is imported.\n     * If the login fails, this operation will not be permited in the same tab session. */\n    static async login() {\n        const loginAttempt = sessionStorage.getItem(Constants.LOGIN_ATTEMPT_SESSION_STORAGE_KEY);\n        const userData = await this._info;\n        const userLoggedInExpirationDate = Number(Cookies.get(Constants.LOGIN_LOGGED_USER_EXPIRY_COOKIE_NAME)) || 0;\n        if (!loginAttempt && !userData\n            && userLoggedInExpirationDate > Date.now()) {\n            sessionStorage.setItem(Constants.LOGIN_ATTEMPT_SESSION_STORAGE_KEY, 'true');\n            const loginEndpointUrl = new URL(`${Constants.PUBLIC_URL_ORIGIN}${Constants.LOGIN_ENDPOINT}`);\n            loginEndpointUrl.searchParams.set('origin', `${window.location.pathname}${window.location.search}`);\n            window.location.href = loginEndpointUrl.href;\n        }\n    }\n    static get info() {\n        return this._info;\n    }\n    static get fingerprint() {\n        return this._fingerprint;\n    }\n    static get country() {\n        return this._country;\n    }\n    static get locale() {\n        return this._locale;\n    }\n}\n//# sourceMappingURL=user.js.map"],"names":[],"mappings":"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","x_google_ignoreList":[0]}