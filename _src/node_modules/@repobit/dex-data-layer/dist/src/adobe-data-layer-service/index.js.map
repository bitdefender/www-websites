{"version":3,"file":"index.js","sources":["../../../../../../../node_modules/@repobit/dex-data-layer/dist/src/adobe-data-layer-service/index.js"],"sourcesContent":["import { PageLoadedEvent, ProductLoadedEvent } from \"../events/index.js\";\nimport merge from 'deepmerge';\nexport class AdobeDataLayerService {\n    static _dataLayer = {};\n    static {\n        window.adobeDataLayer = window.adobeDataLayer || [];\n    }\n    static combineMerge(target, source) {\n        const mergeResult = new Set();\n        if (source.length) {\n            source.forEach(sourceElement => {\n                mergeResult.add(JSON.stringify(sourceElement));\n            });\n        }\n        if (target.length) {\n            target.forEach(targetElement => {\n                mergeResult.add(JSON.stringify(targetElement));\n            });\n        }\n        return [...mergeResult].map(value => JSON.parse(value));\n    }\n    /**\n     * add the values from the local object to adobeDataLayer\n     */\n    static pushEventsToDataLayer() {\n        const productLoadedObject = this._dataLayer['product loaded'];\n        if (productLoadedObject) {\n            const productObject = productLoadedObject['product'];\n            productObject.all = productObject.all?.filter(product => !productObject.info?.some(mainProduct => JSON.stringify(product) === JSON.stringify(mainProduct)));\n            Object.keys(productObject).forEach(key => {\n                if (!productObject[key] || !productObject[key].length) {\n                    delete productObject[key];\n                }\n            });\n        }\n        Object.keys(this._dataLayer).forEach(dataLayerKey => {\n            window.adobeDataLayer.push({ ...this._dataLayer[dataLayerKey] });\n            delete this._dataLayer[dataLayerKey];\n        });\n    }\n    // getter for funcionality checks\n    static get dataLayer() {\n        return this._dataLayer;\n    }\n    static push(event) {\n        /**\n         * keep adding values to the already existing event\n         */\n        if (event instanceof ProductLoadedEvent) {\n            /**\n             * start constructing an object for the local _dataLayer where the event name is the key\n             * Example: {\n             *  \"product loaded\": new ProductsLoadedEvent\n             * }\n             */\n            const eventObject = {\n                [event.event]: event\n            };\n            this._dataLayer = merge(this._dataLayer, eventObject, { arrayMerge: this.combineMerge });\n            return;\n        }\n        else if (event instanceof PageLoadedEvent) {\n            this.pushEventsToDataLayer();\n        }\n        window.adobeDataLayer.push({ ...event });\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["AdobeDataLayerService","target","source","mergeResult","sourceElement","targetElement","value","productLoadedObject","productObject","product","mainProduct","key","dataLayerKey","event","ProductLoadedEvent","eventObject","merge","PageLoadedEvent"],"mappings":"qPAEO,MAAMA,CAAsB,CAC/B,OAAO,WAAa,CAAE,EACtB,MAAA,CACI,OAAO,eAAiB,OAAO,gBAAkB,CAAE,CAC3D,CACI,OAAO,aAAaC,EAAQC,EAAQ,CAChC,MAAMC,EAAc,IAAI,IACxB,OAAID,EAAO,QACPA,EAAO,QAAQE,GAAiB,CAC5BD,EAAY,IAAI,KAAK,UAAUC,CAAa,CAAC,CAC7D,CAAa,EAEDH,EAAO,QACPA,EAAO,QAAQI,GAAiB,CAC5BF,EAAY,IAAI,KAAK,UAAUE,CAAa,CAAC,CAC7D,CAAa,EAEE,CAAC,GAAGF,CAAW,EAAE,IAAIG,GAAS,KAAK,MAAMA,CAAK,CAAC,CAC9D,CAII,OAAO,uBAAwB,CAC3B,MAAMC,EAAsB,KAAK,WAAW,gBAAgB,EAC5D,GAAIA,EAAqB,CACrB,MAAMC,EAAgBD,EAAoB,QAC1CC,EAAc,IAAMA,EAAc,KAAK,OAAOC,GAAW,CAACD,EAAc,MAAM,KAAKE,GAAe,KAAK,UAAUD,CAAO,IAAM,KAAK,UAAUC,CAAW,CAAC,CAAC,EAC1J,OAAO,KAAKF,CAAa,EAAE,QAAQG,GAAO,EAClC,CAACH,EAAcG,CAAG,GAAK,CAACH,EAAcG,CAAG,EAAE,SAC3C,OAAOH,EAAcG,CAAG,CAE5C,CAAa,CACb,CACQ,OAAO,KAAK,KAAK,UAAU,EAAE,QAAQC,GAAgB,CACjD,OAAO,eAAe,KAAK,CAAE,GAAG,KAAK,WAAWA,CAAY,EAAG,EAC/D,OAAO,KAAK,WAAWA,CAAY,CAC/C,CAAS,CACT,CAEI,WAAW,WAAY,CACnB,OAAO,KAAK,UACpB,CACI,OAAO,KAAKC,EAAO,CAIf,GAAIA,aAAiBC,EAAoB,CAOrC,MAAMC,EAAc,CAChB,CAACF,EAAM,KAAK,EAAGA,CAClB,EACD,KAAK,WAAaG,EAAM,KAAK,WAAYD,EAAa,CAAE,WAAY,KAAK,aAAc,EACvF,MACZ,MACiBF,aAAiBI,GACtB,KAAK,sBAAuB,EAEhC,OAAO,eAAe,KAAK,CAAE,GAAGJ,CAAK,CAAE,CAC/C,CACA","x_google_ignoreList":[0]}