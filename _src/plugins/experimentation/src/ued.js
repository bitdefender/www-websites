var d=window.sessionStorage;function g(e,a){for(var r=e.length&3,n=e.length-r,i=3432918353,o=461845907,f=a,t,s,c=0;c<n;)t=e.charCodeAt(c)&255|(e.charCodeAt(++c)&255)<<8|(e.charCodeAt(++c)&255)<<16|(e.charCodeAt(++c)&255)<<24,++c,t=(t&65535)*i+(((t>>>16)*i&65535)<<16)&4294967295,t=t<<15|t>>>17,t=(t&65535)*o+(((t>>>16)*o&65535)<<16)&4294967295,f^=t,f=f<<13|f>>>19,s=(f&65535)*5+(((f>>>16)*5&65535)<<16)&4294967295,f=(s&65535)+27492+(((s>>>16)+58964&65535)<<16);switch(t=0,r){case 3:t^=(e.charCodeAt(c+2)&255)<<16;case 2:t^=(e.charCodeAt(c+1)&255)<<8;case 1:t^=e.charCodeAt(c)&255,t=(t&65535)*i+(((t>>>16)*i&65535)<<16)&4294967295,t=t<<15|t>>>17,t=(t&65535)*o+(((t>>>16)*o&65535)<<16)&4294967295,f^=t}return f^=e.length,f^=f>>>16,f=(f&65535)*2246822507+(((f>>>16)*2246822507&65535)<<16)&4294967295,f^=f>>>13,f=(f&65535)*3266489909+(((f>>>16)*3266489909&65535)<<16)&4294967295,f^=f>>>16,f>>>0}var m=1e4;function l(e){var a=g(e,0),r=Math.abs(a)%m,n=r/m;return n}function p(e,a,r){for(var n=e.reduce(function(f,t){return f+t},0),i=0,o=0;o<a.length;o++)if(i+=Number(e[o].toFixed(2))/n,!(r>i))return a[o]}function b(e,a,r,n){var i=e+"."+a,o=l(i),f=p(r,n,o);return{treatmentId:f,bucketId:o}}var x="unified-decisioning-experiments";function T(e,a){for(var r=Math.random()*100,n=a.length;r>0&&n>0;)n-=1,r-=+e[n];return a[n]}function E(e){var a=d.getItem(x);if(a){var r=JSON.parse(a);if(r[e])return r[e].treatment}return null}function S(e,a){var r=d.getItem(x),n=r?JSON.parse(r):{},i=new Date,o=Object.keys(n);o.forEach(function(t){var s=new Date(n[t].date);i.getTime()-s.getTime()>1e3*86400*30&&delete n[t]});var f=i.toISOString().split("T")[0];n[e]={treatment:a,date:f},d.setItem(x,JSON.stringify(n))}function O(e,a,r){var n=E(e),i;if(!n||!r.includes(n)){var o=T(a,r);S(e,o),i=o}else i=n;return{treatmentId:i}}var v={VISITOR:"VISITOR",DEVICE:"DEVICE"};function w(e,a){var r=a.id,n=a.identityNamespace,i=a.randomizationUnit,o=i===void 0?v.VISITOR:i,f=e.identityMap,t=a.treatments.map(function(u){return u.id}),s=a.treatments.map(function(u){return u.allocationPercentage}),c=null;switch(o){case v.VISITOR:{var h=f[n][0].id;c=b(r,h,s,t);break}case v.DEVICE:{c=O(r,s,t);break}default:throw new Error("Unknow randomization unit")}var I={experimentId:r,hashedBucket:c.bucketId,treatment:{id:c.treatmentId}};return I}function A(e,a,r){var n=e[r],i=n.experiment,o=n.type;if(o==="EXPERIMENTATION"){var f=w(a,i).treatment;return[f]}}function C(e,a){a.storage&&a.storage instanceof Storage&&(d=a.storage);var r={};e.decisionNodes.forEach(function(i){r[i.id]=i});var n=A(r,a,e.rootDecisionNodeId);return{items:n}}const N={evaluateDecisionPolicy:C};export{N as ued};
//# sourceMappingURL=ued.js.map
